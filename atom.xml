<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Welcome to XHao&#39;s Home</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://xhao.io/"/>
  <updated>2020-07-23T15:25:07.501Z</updated>
  <id>https://xhao.io/</id>
  
  <author>
    <name>Xie Hao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>javaagentçš„ä½¿ç”¨</title>
    <link href="https://xhao.io/2019/05/javaagent/"/>
    <id>https://xhao.io/2019/05/javaagent/</id>
    <published>2019-05-04T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨Javaä¸­ï¼Œjava agentå’Œjavaåå°„è°ƒç”¨ä¸€æ ·ï¼Œéƒ½æ˜¯éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œåˆ©ç”¨è¿™ç§è¯­è¨€ç‰¹æ€§ï¼Œå¯ä»¥åšä¸€äº›æœ‰æ„æ€çš„å·¥ä½œã€‚æ¯”å¦‚è¯´<a href="https://github.com/alibaba/transmittable-thread-local" target="_blank" rel="noopener">çº¿ç¨‹é—´ä¼ é€’threadlocal</a>ï¼Œåˆæˆ–è€…<a href="https://github.com/alibaba/jvm-sandbox" target="_blank" rel="noopener">è¿è¡Œæ—¶AOP</a>ã€‚é™¤äº†åŠŸèƒ½ä»¥å¤–ï¼Œå¦ä¸€ç‚¹ä¹Ÿå¾ˆé‡è¦ï¼šjava agentæ˜¯ä½¿ç”¨javaè¯­è¨€å¼€å‘ã€‚å¯¹äºjavaç¨‹åºå‘˜æ¥è®²ï¼Œé—¨æ§›å¹¶ä¸é«˜ã€‚<br><a id="more"></a><br>java agentçš„åŸç†ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šä»‹ç»ï¼Œä¸»è¦æ˜¯åˆ©ç”¨äº†<a href="https://www.ibm.com/developerworks/cn/java/j-lo-jpda2/index.html" target="_blank" rel="noopener">JVMTI</a>çš„ä¸€ä¸ªagentåº“ï¼š<strong>libinstrument</strong>ã€‚åœ¨ä½¿ç”¨ä¸Šï¼Œä¸€èˆ¬æœ‰2ç§æ–¹å¼ï¼š</p><ul><li>å¯åŠ¨æ—¶è¿›è¡ŒåŠ è½½ï¼š-javaagent:myagent.jar</li><li>æˆ–è€…åŠ¨æ€attach</li></ul><p>å¦‚æœæ˜¯åŠ¨æ€attachçš„è¯ï¼Œ<a href="#jattach">ä¸€èˆ¬</a>è¿˜éœ€è¦ä¾èµ–jdkç›®å½•ä¸‹çš„<code>/lib/tools.jar</code>ï¼Œåšæ³•æ˜¯æ‰¾åˆ°java homeå˜é‡ï¼Œç„¶åå»åŠ è½½tools.jarã€‚</p><p>é’ˆå¯¹2ç§ä¸åŒåœºæ™¯ï¼Œjava agentçš„è§¦å‘ç‚¹ç•¥æœ‰ä¸åŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯åŠ¨æ—¶</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String args, Instrumentation instrumentation)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="comment">// åŠ¨æ€attach</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">agentmain</span><span class="params">(String args, Instrumentation instrumentation)</span> </span>&#123;&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦åšçš„å·¥ä½œå°±æ˜¯åˆ©ç”¨è¿™ä¸ª<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/instrument/Instrumentation.html" target="_blank" rel="noopener"><code>Instrumentation</code></a>å¯¹è±¡ä¸Šæä¾›çš„æ–¹æ³•ã€‚</p><p>æ¯”å¦‚ä½¿ç”¨<code>addTransformer</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªä¿®æ”¹å­—èŠ‚ç çš„å¯¹è±¡ä¸Šå»</p><ul><li>å½“åŠ è½½ä¸€ä¸ªclassæ–‡ä»¶æ—¶ï¼Œä¼šè¿›è¡Œæ‹¦æˆªï¼Œå¯¹å­—èŠ‚ç åšä¿®æ”¹ã€‚</li><li>è¿˜å¯ä»¥åœ¨è¿è¡ŒæœŸå¯¹å·²åŠ è½½ç±»çš„å­—èŠ‚ç åšå˜æ›´</li></ul><p>å› ä¸ºJavaé‡Œé¢çš„ç±»ã€å¯¹è±¡é€šå¸¸å’Œclassloaderæœ‰å…³ç³»ï¼Œä¸åŒçš„classloaderå¯ä»¥åŠ è½½åŒä¸€ä¸ªç±»ï¼Œæ‰€ä»¥ä¼šå¯¹<code>ClassFileTransformer</code>çš„å½’å±æœ‰ç–‘é—®ï¼Ÿå®é™…ä¸Šå‘¢ï¼Œjava agentæ€»æ˜¯ç”±AppClassLoaderè¿›è¡ŒåŠ è½½çš„ï¼Œ<code>premain</code>å’Œ<code>agentmain</code>ä¹Ÿéƒ½æ˜¯åœ¨AppClassLoaderé‡Œè§¦å‘çš„ï¼Œä½†æ˜¯å®ƒä¿®æ”¹ç±»çš„æ•ˆæœå¯ä»¥è¶…å‡ºå½“å‰çš„classloaderã€‚æˆ‘çš„ç†è§£æ˜¯ï¼Œè¿™ä¸ª<code>ClassFileTransformer</code>åªæ˜¯è¾“å‡ºä¸€å †å­—èŠ‚ç ã€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸æ¶‰åŠåˆ°ç±»åŠ è½½çš„é—®é¢˜ï¼Œæ‰€ä»¥2è€…ä¸å†²çªã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè°ƒç”¨<code>retransformClasses(Class&lt;?&gt;... classes)</code>ä¿®æ”¹å·²ç»åŠ è½½è¿‡çš„ç±»ï¼Œè¿™ä¸ª<code>class</code>å¯¹è±¡ä¸è¦ç”¨<code>Class.forname(&quot;A&quot;)</code>ï¼Œå› ä¸º<code>Class</code>å¯¹è±¡æ˜¯åœ¨å½“å‰AppClassLoaderé‡Œåˆ›å»ºçš„ï¼Œæ‰€ä»¥<code>ClassFileTransformer</code>åªä¼šå½±å“AppClassLoaderé‡Œçš„<code>A</code>ï¼Œå¯¹äºå…¶ä»–ClassLoaderåŠ è½½çš„<code>A</code>ï¼Œå¹¶ä¸èµ·ä½œç”¨ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦åˆ©ç”¨<code>Instrumentation</code>å¯¹è±¡ï¼Œç®€å•ç‚¹å¯ä»¥å…ˆ<code>getAllLoadedClasses()</code>è·å¾—æ‰€æœ‰ç±»é›†åˆï¼Œå†é€šè¿‡æ¯”è¾ƒclass nameçš„æ–¹å¼è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå†retransformã€‚åˆæˆ–è€…ä½ å°†<code>Instrumentation</code>å¯¹è±¡ä¿å­˜èµ·æ¥ï¼Œå°†æ¥éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œå†æ‹¿å‡ºæ¥ä½¿ç”¨ç­‰ç­‰ã€‚èŠ±æ ·å¾ˆå¤šï¼Œå¯ä»¥è‡ªç”±ç»„åˆï¼</p><p>è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯<a href="http://openjdk.java.net/jeps/159" target="_blank" rel="noopener">JEP 159: Enhanced Class Redefinition</a>ã€‚ä¿®æ”¹å·²ç»åŠ è½½è¿‡çš„ç±»æ˜¯æœ‰é™åˆ¶æ¡ä»¶çš„ï¼Œè™½ç„¶æœ‰jepåœ¨è¿½è¸ªè¿™ä¸ªé—®é¢˜ï¼Œä½†æ„Ÿè§‰openjdkå¯¹è¿™ä¸ªéœ€æ±‚çƒ­æƒ…ä¸é«˜ï¼ŒçŸ­æ—¶é—´å†…æ€•æ˜¯ä¸ä¼šæœ‰è¿›å±•ï¼ˆå®ƒä¸åœ¨ä»»ä½•å·²ç»è§„åˆ’çš„å‘è¡Œç‰ˆfeatureä¸­ï¼‰</p><p>å¦å¤–æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯å…³äºretransformï¼ˆè¿˜æœ‰ä¸€ä¸ªredefineClassesï¼Œè¿™ä¸ªç”¨çš„å€’æ˜¯ä¸å¤šï¼‰ã€‚å…³äºå®ƒçš„ç»†èŠ‚å¯ä»¥è‡ªè¡Œgoogleï¼Œinfoqä¸Šä¹Ÿæœ‰ä¸€ç¯‡<a href="https://www.infoq.cn/article/javaagent-illustrated" target="_blank" rel="noopener">è§£é‡Š</a>ä»…ä¾›å‚è€ƒã€‚</p><p>æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„<a href="https://github.com/XHao/java-agent-test/tree/master/javaagent" target="_blank" rel="noopener">Repo</a>ï¼Œå¸Œæœ›èƒ½å¸®åŠ©ç†è§£ã€‚</p><p>æ¯”å¦‚ç°åœ¨æœ‰1ä¸ªClassFileTransformer <code>A</code>ï¼Œå®ƒä¼šç»™ä¸€ä¸ªç±»å¢åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆ</p><ul><li>å¦‚æœAæ˜¯åœ¨premainé‡ŒåŠ å…¥åˆ°listé‡Œå»çš„ï¼Œåˆ™å¯ä»¥<code>canRetransform=true</code></li><li>å¦‚æœæ˜¯åœ¨agentmainé‡Œï¼Œä¸è¡Œï¼</li></ul><p>å¯ä»¥ç†è§£ä¸ºç¬¬ä¸€æ¬¡åŠ è½½ç±»Cçš„æ—¶å€™ï¼Œå·²ç»è¿›è¡Œè¿‡Açš„transformå˜ä¸ºCâ€˜ï¼›è¿›è¡ŒAçš„retransformçš„æ—¶å€™ï¼Œå‡ºå»çš„è¿˜æ˜¯Câ€˜ï¼›è¿™2ä¸ªCâ€™å¯¹æ¯”å‘ç°å¹¶æ²¡æœ‰ç ´åjep159é‡Œçš„å†…å®¹ï¼Œæ‰€ä»¥okï¼›ä½†æ˜¯agentmainé‡Œå°±ä¸ä¸€æ ·äº†ï¼Œç¬¬ä¸€æ¬¡åŠ è½½çš„å°±æ˜¯Cæœ¬èº«ï¼Œåšå®Œretransformå˜æˆCâ€˜ï¼ŒCâ€™å¯¹æ¯”Cæ˜¯æœ‰ç ´åæ€§çš„æ”¹å˜çš„ã€‚</p><p>ç¬¬2ä¸ªä¾‹å­ï¼Œæ˜¯æœ‰1ä¸ªClassFileTransformer <code>A</code>ï¼Œåœ¨ç±»Cå·²ç»è¢«åŠ è½½è¿‡ä¹‹åï¼Œå…ˆé€šè¿‡Aè¿›è¡Œä¸€æ¬¡retransformï¼Œå¢åŠ ä¸€è¡Œæ‰“å°</p><ol><li>å¦‚æœå†è¿›è¡Œä¸€æ¬¡ï¼Œæ‰“å°åªä¼šæœ‰ä¸€è¡Œï¼Œä¸ä¼šæœ‰2è¡Œ</li><li>å¦‚æœåˆ æ‰Aä¹‹åå†è¿›è¡Œä¸€æ¬¡retransformï¼Œåˆ™æ‰“å°ä¼šæ¶ˆå¤±</li></ol><p>è¿™ä¸ªä¾‹å­è¯´çš„å…¶å®æ˜¯ï¼Œæ¯æ¬¡retransformè¿›æ¥çš„ä»£ç éƒ½æ˜¯ä¼šå›åˆ°åŸå§‹çš„å­—èŠ‚ç ï¼Œåœ¨åŸå§‹å­—èŠ‚ç ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p><p>é’ˆå¯¹ä¸Šé¢è¿™ä¸ªä¾‹å­æ‰©å±•ä¸€ä¸‹ï¼Œå¦‚æœæœ‰2ä¸ªClassFileTransformer <code>A</code>å’Œ<code>B</code>ï¼Œå¯¹ç±»Cè¿›è¡Œretransformï¼Œåˆ™Aå’ŒBçš„æ”¹åŠ¨éƒ½ä¼šä¿ç•™ï¼è¯´æ˜ä¸€ä¸ªtransformeræ‹¿åˆ°çš„æ˜¯ä¸Šä¸€ä¸ªtransformerä¿®æ”¹ä¹‹åçš„ä»£ç ã€‚æ‰€ä»¥å‰ä¸€ä¸ªä¾‹å­ä¹Ÿèƒ½è¯´é€šäº†ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªtransformerã€‚</p><p>é™¤äº†è¿™ä¸ªå­—èŠ‚ç è¿™ä¸ªåŠŸèƒ½ç»å¸¸è¢«æåŠä¹‹å¤–ï¼Œ<code>Instrumentation</code>è¿˜æœ‰å…¶ä»–ä¸€äº›æˆ‘è§‰å¾—ä¸é”™çš„åŠŸèƒ½</p><ul><li>è·å–æ‰€æœ‰å·²ç»åŠ è½½è¿‡çš„ç±»</li><li>è·å–æ‰€æœ‰å·²ç»åˆå§‹åŒ–è¿‡çš„ç±»ï¼ˆæ‰§è¡Œè¿‡ clinit æ–¹æ³•ï¼Œæ˜¯ä¸Šé¢çš„ä¸€ä¸ªå­é›†ï¼‰</li><li>å°†æŸä¸ªjaråŠ å…¥åˆ°bootstrap classpathé‡Œä½œä¸ºé«˜ä¼˜å…ˆçº§è¢«bootstrapClassloaderåŠ è½½</li><li>å°†æŸä¸ªjaråŠ å…¥åˆ°classpathé‡Œä¾›AppClassloaderå»åŠ è½½</li></ul><hr><p><a name="jattach" href="https://github.com/apangin/jattach" target="_blank" rel="noopener">apangin/jattach</a>å¯ä»¥ä¸ä¾èµ–jdkå®Œæˆload agentåŠŸèƒ½</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨Javaä¸­ï¼Œjava agentå’Œjavaåå°„è°ƒç”¨ä¸€æ ·ï¼Œéƒ½æ˜¯éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œåˆ©ç”¨è¿™ç§è¯­è¨€ç‰¹æ€§ï¼Œå¯ä»¥åšä¸€äº›æœ‰æ„æ€çš„å·¥ä½œã€‚æ¯”å¦‚è¯´&lt;a href=&quot;https://github.com/alibaba/transmittable-thread-local&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;çº¿ç¨‹é—´ä¼ é€’threadlocal&lt;/a&gt;ï¼Œåˆæˆ–è€…&lt;a href=&quot;https://github.com/alibaba/jvm-sandbox&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿è¡Œæ—¶AOP&lt;/a&gt;ã€‚é™¤äº†åŠŸèƒ½ä»¥å¤–ï¼Œå¦ä¸€ç‚¹ä¹Ÿå¾ˆé‡è¦ï¼šjava agentæ˜¯ä½¿ç”¨javaè¯­è¨€å¼€å‘ã€‚å¯¹äºjavaç¨‹åºå‘˜æ¥è®²ï¼Œé—¨æ§›å¹¶ä¸é«˜ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>getaddrinfoæ¢ç§˜</title>
    <link href="https://xhao.io/2018/09/getaddrinfo/"/>
    <id>https://xhao.io/2018/09/getaddrinfo/</id>
    <published>2018-09-26T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç°åœ¨æµè¡Œçš„æœåŠ¡åŒ–è°ƒç”¨åœºæ™¯ä¸­ï¼Œä¸ºäº†é¿å…æœåŠ¡çš„å•ç‚¹é—®é¢˜ï¼Œä¼šå°†æœåŠ¡éƒ¨ç½²æˆä¸€ä¸ªé›†ç¾¤ï¼Œç„¶ååˆ©ç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥è§£å†³æœåŠ¡å‘ç°é—®é¢˜ã€‚</p><p>ä¸ºäº†è§£å†³æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„å•ç‚¹é—®é¢˜ï¼Œæœ‰æ—¶å€™ä¼šé€‰æ‹©å¤è€çš„dnsè½®è¯¢ã€‚</p><p>é€šè¿‡å°†ä¸€ä¸ªåŸŸåå…³è”å¤šæ¡Aè®°å½•ï¼Œåˆ©ç”¨åŸŸåæœåŠ¡å™¨æ¯æ¬¡çš„ä¸åŒè¿”å›ï¼Œè¾¾åˆ°è½¯è´Ÿè½½çš„æ•ˆæœã€‚</p><p>å…³äºjdkçš„dnsè§£æï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»ï¼Œæœ‰å¯¹çš„åœ°æ–¹ä¹Ÿæœ‰é”™çš„ã€‚<br><a id="more"></a><br>é¦–å…ˆçœ‹çœ‹å¸¸ç”¨çš„jdkæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// netty Bootstrap Line 97</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">connect</span><span class="params">(String inetHost, <span class="keyword">int</span> inetPort)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> connect(<span class="keyword">new</span> InetSocketAddress(inetHost, inetPort));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å…¥å‚æ˜¯hostnameï¼Œè·å¾—socketè¿æ¥ï¼Œåœ¨<code>InetSocketAddress</code>ä¸­è‡ªåŠ¨å®Œæˆäº†dnsçš„å·¥ä½œâ€”â€”<code>InetAddress.getByName(hostname)</code></p><p>jdkä¸­dnsæŸ¥è¯¢åˆ†2æ­¥å®Œæˆï¼Œé¦–å…ˆæ˜¯æ£€æŸ¥addressCacheï¼›å¦‚æœæ²¡æœ‰å‘ç°ï¼Œåˆ™è§¦å‘ä¸€æ¬¡ç½‘ç»œdnsæŸ¥è¯¢ã€‚</p><p><code>InetAddressCachePolicy</code>æ˜¯addressçš„ç¼“å­˜ï¼Œé»˜è®¤æ˜¯30sçš„ç¼“å­˜æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡<code>networkaddress.cache.ttl</code>æ¥ä¿®æ”¹ã€‚è¿™ä¸ªcacheæœ‰è¿™æ ·å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>å¦‚æœä½ é€šè¿‡security propertyçš„æ–¹å¼è®¾äº†å€¼ï¼Œåˆ™åœ¨è¿è¡ŒæœŸä¸å¯ä»¥ä¿®æ”¹</li><li>å¦‚æœè¿è¡ŒæœŸä¿®æ”¹ttlï¼Œä¸èƒ½æ¯”ä»¥å‰å°</li></ol><p>ä»ä»£ç ä¸ŠçŒœæµ‹ï¼Œä¸»è¦æ˜¯å› ä¸ºdnsæŸ¥è¯¢æœ¬èº«æŸè€—æ€§èƒ½ï¼ŒåŠ å…¥è¿™ç§å®‰å…¨é™åˆ¶ï¼Œèƒ½é¿å…ä¸‰æ–¹åº“éšæ„è®¾ç½®ï¼Œå¯¼è‡´åº”ç”¨å‡ºç°ç“¶é¢ˆã€‚</p><p>å¦‚æœæƒ³åœ¨è¿è¡ŒæœŸè‡ªç”±æ§åˆ¶dnsç¼“å­˜æ—¶é—´ï¼Œå°±åªèƒ½é€šè¿‡åå°„è¿™ç§æ–¹å¼äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field f = sun.net.InetAddressCachePolicy.class.getDeclaredField("cachePolicy");</span><br><span class="line">            f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">int</span> cache = (<span class="keyword">int</span>) f.get(sun.net.InetAddressCachePolicy<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            System.err.println(<span class="string">"before ttl is "</span>+cache);</span><br><span class="line">            f.set(sun.net.InetAddressCachePolicy<span class="class">.<span class="keyword">class</span>, 0)</span>;</span><br><span class="line">            cache = (<span class="keyword">int</span>) f.get(sun.net.InetAddressCachePolicy<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            System.err.println(<span class="string">"after ttl is "</span>+cache);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException | SecurityException | IllegalArgumentException | IllegalAccessException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            Arrays.asList(InetAddress.getAllByName(<span class="string">"xhao.io"</span>)).forEach(System.out::println);</span><br><span class="line">            System.out.println(<span class="string">"-------------"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">5000L</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>okï¼Œå½“æˆ‘ä»¬å°†ttlæ¢æˆ0ä¹‹åï¼Œè·‘è·‘çœ‹ï¼Œä¼šå‘ç°åœ¨ä¸åŒçš„æœºå™¨ä¸Šç»“æœä¸ä¸€æ ·ã€‚</p><p>macos high sierra</p><p><img src="/img/dns-mac.jpg" alt="mac dns æŸ¥è¯¢"></p><p>CentOS Linux release 7.5.1804</p><p><img src="/img/dns-centos.jpg" alt="centos dns æŸ¥è¯¢"></p><p>å› ä¸ºæˆ‘ä»¬å·²ç»è°ƒæ•´äº†dnsç¼“å­˜çš„æ—¶é—´ï¼Œæ‰€ä»¥æ¯æ¬¡æ‰“å°çš„ç»“æœéƒ½æ˜¯é€šè¿‡dnsæŸ¥è¯¢å¾—æ¥çš„ã€‚</p><p>ä½†æ˜¯åœ¨macä¸Šæ„Ÿè§‰ipé¡ºåºæ˜¯å›ºå®šçš„ï¼Œè€Œcentosä¸Šå´æ˜¯æ— åºçš„ï¼›æ¢å¥è¯è¯´ï¼Œåœ¨macä¸Šæ— æ³•å®ç°dnsè½®è¯¢ï¼Œè€Œcentosä¸Šè¿˜å¯ä»¥ã€‚å…·ä½“åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…³äºè¿™ä¸ªï¼ŒæŸ¥é˜…äº†ä¸€äº›èµ„æ–™ï¼Œä½†éƒ½è¯´çš„ä¸æ¸…æ¥šï¼Œæœ‰ä¸€ä¸ªå¯èƒ½æ€§æ˜¯å…³äºRFC 3484</p><blockquote><p><a href="https://www.systutorials.com/docs/linux/man/3-getaddrinfo/" target="_blank" rel="noopener">getaddrinfo</a>: The sorting function used within getaddrinfo() is defined in RFC 3484; the order can be tweaked for a particular system by editing /etc/gai.conf (available since glibc 2.5).</p></blockquote><p>ç½‘ä¸Šä¸€äº›å…³äºRFC 3484çš„è¯´æ˜æ˜¯ï¼š</p><ol><li>ç»™ipæ’åºçš„ç›®çš„æ˜¯æƒ³å°½é‡ä½¿ç”¨ipv6ï¼Œæ–¹ä¾¿ipv6è®¾å¤‡çš„æ¨å¹¿</li><li>åº”è¯¥å°‘ä¾èµ–dnsè½®è¯¢ï¼Œè¿™ä¸å¯é </li><li>ipæ’åºæœ‰ä¸€å®šçš„è§„åˆ™ï¼Œä¼šå®ç°ä¸å¦è¦çœ‹æœ¬åœ°åº“ï¼ˆè¿™åªæ˜¯å»ºè®®ï¼Œä¸å¼ºåˆ¶ï¼‰</li></ol><p>åœ¨macä¸Šå¹¶ä¸æ‰“ç®—ç»§ç»­è¿½æŸ¥è¿™ä¸ªé—®é¢˜äº†ï¼Œå·æ‡’è®¤ä¸ºå®ƒæ˜¯æŒ‰ç…§æ ‡å‡†å®ç°çš„ã€‚ä½†æ˜¯linuxä¸Šï¼Œå¯ä»¥ç”¨traceå·¥å…·çœ‹çœ‹<code>getaddrinfo</code>çš„é€»è¾‘ã€‚æ‰€ä»¥æ‰¾äº†å°æœºå™¨è·‘ä¸€è·‘ä¸‹é¢çš„ç¨‹åºï¼š<code>strace ./a.out</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netdb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ===  FUNCTION</span></span><br><span class="line"><span class="comment"> * ====================================================================== Name:</span></span><br><span class="line"><span class="comment"> * main Description:</span></span><br><span class="line"><span class="comment"> * =====================================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">addrinfo</span> <span class="title">hints</span>, *<span class="title">res</span> = <span class="title">NULL</span>;</span></span><br><span class="line">  <span class="keyword">char</span> *host = <span class="string">"xhao.io"</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;hints, <span class="number">0</span>, <span class="keyword">sizeof</span>(hints));</span><br><span class="line">  hints.ai_flags = AI_CANONNAME;</span><br><span class="line">  hints.ai_family = AF_UNSPEC;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> getaddrinfo_error = getaddrinfo(host, <span class="literal">NULL</span>, &amp;hints, &amp;res);</span><br><span class="line">  <span class="keyword">if</span> (getaddrinfo_error)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"fail %s"</span>, gai_strerror(getaddrinfo_error));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    struct addrinfo *iterator = res;</span><br><span class="line">    <span class="keyword">char</span> prev[<span class="number">100</span>], addrstr[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">void</span> *ptr;</span><br><span class="line">    <span class="keyword">while</span> (iterator != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (iterator-&gt;ai_family == AF_INET)</span><br><span class="line">      &#123; <span class="comment">/* AF_INET */</span></span><br><span class="line">        ptr = &amp;((struct sockaddr_in *)iterator-&gt;ai_addr)-&gt;sin_addr;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        ptr = &amp;((struct sockaddr_in6 *)iterator-&gt;ai_addr)-&gt;sin6_addr;</span><br><span class="line">      &#125;</span><br><span class="line">      inet_ntop(iterator-&gt;ai_family, ptr, addrstr, <span class="number">100</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">strcmp</span>(prev, addrstr) != <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Ipv%d is %s\n"</span>, iterator-&gt;ai_family == AF_INET ? <span class="number">4</span> : <span class="number">6</span>,</span><br><span class="line">               addrstr);</span><br><span class="line">        <span class="built_in">strncpy</span>(prev, addrstr, <span class="number">100</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      iterator = iterator-&gt;ai_next;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125; <span class="comment">/* ----------  end of function main  ---------- */</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°ç»“æœå’Œjdkä¸­çš„ç»“æœç›¸åŒï¼ŒåŸºæœ¬å¯ä»¥åˆ¤æ–­å¹¶æ²¡æœ‰ä¹‹å‰æ‰€è¯´çš„æ’åºè¿‡ç¨‹ã€‚</p><p>åŒæ—¶æˆ‘ä»¬è¿˜å‘ç°ï¼Œjdkæ˜¯è°ƒç”¨äº†ç³»ç»Ÿå‘½ä»¤æ¥æŸ¥è¯¢dnsï¼Œè¿™å’Œæˆ‘ä»¬åœ¨jdkæºç ä¸­çœ‹åˆ°çš„å·®ä¸å¤š(jdkè¿™éƒ¨åˆ†ä»£ç æœ‰ä¸€å¤§å¨ï¼Œçœ‹èµ·æ¥åªæ˜¯åœ¨æ•´ç†å’Œæ’åº)</p><p>æˆ‘ä»¬è¿˜å‘ç°getaddrinfoæ˜¯ä¸€ä¸ªå¾ˆé‡çš„å‘½ä»¤ï¼Œå› ä¸ºå®ƒæ¯æ¬¡éƒ½ä¼šå»å‘è¯·æ±‚åˆ°dnsæœåŠ¡å™¨ä¸Šï¼Œå¹¶æ²¡æœ‰ä»»ä½•ç¼“å­˜ã€‚è¿™åº”è¯¥å°±æ˜¯jdkè‡ªå·±åšäº†ç¼“å­˜çš„åŸå› ï¼Œæ¯•ç«Ÿæ¯æ¬¡éƒ½æŸ¥è¯¢dnsæœåŠ¡å™¨ï¼Œå¯¹æ€§èƒ½æ˜¯æœ‰å½±å“çš„ã€‚</p><p>å…³äºjava dnsç›¸å…³çš„ï¼Œå¤§æ¦‚å°±æ˜¯è¿™äº›å†…å®¹äº†ã€‚æ€»ä¹‹dnsè½®è¯¢ä¸ä¸€å®šå¯é ï¼Œéœ€è¦æ…é‡å¯¹å¾…ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ç°åœ¨æµè¡Œçš„æœåŠ¡åŒ–è°ƒç”¨åœºæ™¯ä¸­ï¼Œä¸ºäº†é¿å…æœåŠ¡çš„å•ç‚¹é—®é¢˜ï¼Œä¼šå°†æœåŠ¡éƒ¨ç½²æˆä¸€ä¸ªé›†ç¾¤ï¼Œç„¶ååˆ©ç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥è§£å†³æœåŠ¡å‘ç°é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„å•ç‚¹é—®é¢˜ï¼Œæœ‰æ—¶å€™ä¼šé€‰æ‹©å¤è€çš„dnsè½®è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å°†ä¸€ä¸ªåŸŸåå…³è”å¤šæ¡Aè®°å½•ï¼Œåˆ©ç”¨åŸŸåæœåŠ¡å™¨æ¯æ¬¡çš„ä¸åŒè¿”å›ï¼Œè¾¾åˆ°è½¯è´Ÿè½½çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;å…³äºjdkçš„dnsè§£æï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»ï¼Œæœ‰å¯¹çš„åœ°æ–¹ä¹Ÿæœ‰é”™çš„ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="linux" scheme="https://xhao.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ¬¡StringInternå’ŒParNew GC</title>
    <link href="https://xhao.io/2018/06/stringintern/"/>
    <id>https://xhao.io/2018/06/stringintern/</id>
    <published>2018-06-17T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.505Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´ï¼ŒåŒäº‹é‡åˆ°Javaçš„GCé—®é¢˜ï¼Œç°è±¡è¡¨ç°ä¸ºï¼šgcæ—¶é—´è¶Šæ¥è¶Šé•¿ï¼ˆä¹ŸåŒ…æ‹¬young gcï¼‰ï¼›è§¦å‘ä¸€æ¬¡full gcä¹‹åï¼Œä¼šå˜å¾—å¥½ç‚¹ï¼Œä½†æ˜¯è¿™æ¬¡full gcé•¿çš„ä¸èƒ½å¿å—ã€‚ä»–ä»¬ä½¿ç”¨çš„jdk 8ï¼Œåº”ç”¨å†…å­˜8Gï¼Œå°è¯•è°ƒæ•´äº†å¾ˆå¤šå‚æ•°ï¼Œç”¨äº†ParNewç®—æ³•ï¼Œä¹Ÿè¯•è¿‡G1ç®—æ³•ï¼Œéƒ½æ²¡æœ‰å¤ªå¤§å¥½è½¬ã€‚å›°æ‰°å¾ˆä¹…ä¹‹åæ‰¾æˆ‘å¸®å¿™çœ‹ä¸€ä¸‹ï¼Œæ‰€ä»¥ä¹Ÿå°±æœ‰äº†è¿™ç¯‡æ–‡ç« ^_^</p><p>GCå¯¹äºæˆ‘ä»¬æ¥è¯´ç›¸å¯¹é»‘ç›’ï¼Œå°¤å…¶æ˜¯young gcçš„é—®é¢˜ï¼Œå¹¸è¿çš„æ˜¯è¿™æ¬¡è§£å†³éå¸¸å¿«ä¸”æ²¡ä¾èµ–Googleã€‚å¯¹æˆ‘è€Œè¨€ï¼Œä¸»è¦æ˜¯è§£å†³é—®é¢˜è¿‡ç¨‹ä¸­çš„æ€è·¯ï¼Œå€¼å¾—è®°å½•ä¸‹æ¥ã€‚è‡³äºgcçš„æ ¹æœ¬åŸå› ï¼Œäº‹åæˆ‘æ‰¾åˆ°äº†<a href="http://lovestblog.cn/blog/2016/11/06/string-intern/" target="_blank" rel="noopener">ç¬¨ç¥çš„åšå®¢</a><br><a id="more"></a></p><h3 id="å…ˆç®€å•åˆ†æåˆ†æ"><a href="#å…ˆç®€å•åˆ†æåˆ†æ" class="headerlink" title="å…ˆç®€å•åˆ†æåˆ†æ"></a>å…ˆç®€å•åˆ†æåˆ†æ</h3><p>ä»gcçš„ç°è±¡æ¥çœ‹ï¼Œå¯ä»¥æœ‰ä¸€äº›ç®€å•çš„åˆ†æï¼š</p><ul><li>ç¨‹åºè·‘äº†å¾ˆä¹…ä¹‹åï¼Œå¼€å§‹young gcå˜é•¿ã€full gcå˜é•¿</li><li>æ„Ÿè§‰æ˜¯æ¯æ¬¡full gcå®Œæˆä¹‹åï¼Œyoung gcæ€§èƒ½ä¼šçŸ­æš‚å˜å¥½</li><li>full gcè‡ªèº«ä¹Ÿå¾ˆæ…¢</li><li>full gcä¹‹åï¼Œä¼šå›æ”¶å¾ˆå¤šå†…å­˜ï¼Œæœ‰ä¸€ä¸ªæ–­å´–å¼åœ°ä¸‹é™ï¼Œæ„Ÿè§‰æœ‰å¤§é‡å†…å­˜å¹¶ä¸æ˜¯ç¨‹åºæ‰€éœ€è¦çš„</li><li>young gcé—®é¢˜åº”è¯¥å’ŒoldåŒºç›¸å…³</li></ul><p>ç»“åˆè¿™äº›åˆ†æï¼Œç¬¬ä¸€ååº”æ˜¯ï¼šè¿›è¡Œrootæ‰«æçš„æ—¶å€™æœ‰ç‚¹æ…¢ã€‚ç”±äºå¹¶ä¸ç†Ÿæ‚‰ä¸šåŠ¡ä»£ç ï¼Œæ‰€ä»¥å¾ˆéš¾è¯´æ˜¯ä¸æ˜¯ç”±äºä¸šåŠ¡ä»£ç å†™çš„ä¸å¥½å¯¼è‡´ã€‚ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæˆ‘è¿˜æ˜¯æ‰“ç®—å…ˆçœ‹çœ‹gcæ—¥å¿—ã€‚</p><h3 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h3><p>æ‹¿åˆ°gcçš„æ—¥å¿—ä¹‹åï¼Œå‘ç°æ—¥å¿—å¤ªå¤šäº†ï¼Œä¸€è¡Œè¡Œçœ‹æ˜¯ä¸ç°å®çš„ï¼Œå¿…é¡»è¦æœ‰ç›®çš„æ€§æ‰è¡Œã€‚ç”±äºCMSçš„æ—¥å¿—æ¯ä¸ªé˜¶æ®µéƒ½æŒºè¯¦ç»†çš„ï¼Œå¯ä»¥é‡ç‚¹å…³æ³¨ã€‚æˆ‘åˆå›åˆ°å¼€å§‹çš„åˆ†æä¸Šå»ï¼Œæ—¢ç„¶æ„Ÿè§‰full gcä¹‹åï¼ŒParNew GCä¼šå˜å¿«ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æ¯æ¬¡éƒ½è¿™æ ·å‘¢ï¼Ÿæˆ‘å¼€å§‹å…ˆè¿‡æ»¤full gcè§¦å‘çš„æ—¶é—´ç‚¹ï¼Œå¾—åˆ°ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯ï¼šç¨‹åºåˆšå¼€å§‹çš„æ—¶å€™ï¼Œfull gcå‰åParNew GCæ²¡æœ‰å¤ªå¤§æ—¶é—´ä¸Šçš„åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºä¸€å¼€å§‹æ˜¯æ­£å¸¸çš„ã€‚æˆ‘ç»§ç»­å¾€ä¸‹ç¿»ï¼Œç›´åˆ°æ‰¾åˆ°full gcæˆä¸ºåˆ†æ°´å²­â€”â€”â€”â€”å‰åçš„gcæ—¶é—´æ˜¾è‘—ä¸ä¸€æ ·ã€‚</p><p>æˆ‘åœ¨2ä¸ªfull gcå‘¨å›´è¿›è¡Œå¯¹æ¯”ï¼Œå‘ç°äº†ä¸€äº›å¼‚å¸¸ï¼šåœ¨CMSçš„Final Remarké˜¶æ®µï¼Œå‡ºç°äº†ä¸€ä¸ª<code>scrub string table</code>çš„é¡¹</p><ol><li>æœ‰æ—¶å€™å¾ˆçŸ­<br><img src="/img/stringintern-1.png"></li><li>æœ‰æ—¶å€™å¾ˆé•¿<br><img src="/img/stringintern-2.png"></li></ol><p>ç”±äºè¿™ä¸ªé˜¶æ®µæ˜¯STWçš„ï¼Œæ¢å¥è¯è¯´<code>scrub string table</code>çš„é•¿çŸ­ç›´æ¥å½±å“äº†gcæš‚åœçš„æ—¶é—´ã€‚</p><p>çœ‹åˆ°<code>String Table</code>å°±å¾ˆå¼€å¿ƒäº†ï¼Œå› ä¸ºå®ƒå’Œjdkçš„<code>String.intern</code>æ–¹æ³•æ˜¯æœ‰å…³ç³»çš„ï¼Œè€Œ<code>intern</code>æ–¹æ³•åœ¨å¾ˆå¤šæœ‰å…³æ€§èƒ½çš„åšå®¢é‡Œéƒ½æœ‰æåˆ°ï¼Œæ˜¯ä¸€ä¸ªæœ‰äº‰è®®çš„åŠ¨ä½œï¼ˆæœ‰åˆ©æœ‰å¼Šï¼‰ã€‚è™½ç„¶ä¸çŸ¥é“å’Œgcæœ‰å¤šå¤§å…³ç³»ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬è§£å†³é—®é¢˜ï¼Œæœ‰äº†æ¸…æ™°çš„æ–¹å‘ï¼š<strong>ä¼˜å…ˆæ‰¾åˆ°è°åœ¨ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</strong>ã€‚å› ä¸ºæ˜¯æœåŠ¡å™¨ç¨‹åºï¼Œæ‰€ä»¥ä¸å¯é¿å…ä¼šä½¿ç”¨Jacksonåºåˆ—åŒ–ï¼Œåºåˆ—åŒ–é€šå¸¸éƒ½æ˜¯å’ŒStringæ‰“äº¤é“çš„ï¼Œæ‰€ä»¥æˆ‘ç¬¬ä¸€æ—¶é—´å»çœ‹äº†Jacksonçš„ä»£ç ï¼Œæœç„¶é»˜è®¤Jacksoné»˜è®¤æ˜¯ä½¿ç”¨internæ–¹æ³•çš„ã€‚æœ¬ç€â€œåœ¨ä¸æ‡‚åŸç†çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆå°è¯•çš„åŸåˆ™â€ï¼Œæˆ‘ä»¬ç´§æ€¥å‘äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œé€šè¿‡APIå…³é—­äº†Jacksonçš„è¿™é¡¹åŠŸèƒ½ï¼Œç„¶ååœ¨çº¿ä¸Šç°åº¦æµ‹è¯•ã€‚</p><p>ç»“æœå¾ˆä¸é”™ï¼šä¸ä»…åº”ç”¨å ç”¨çš„å†…å­˜å˜å°‘äº†ï¼Œè€Œä¸”gcå˜å¾—éå¸¸çš„å¿«é€Ÿä¸”ç¨³å®šâ€”â€”â€”â€”é—®é¢˜é¡ºåˆ©è§£å†³ã€‚</p><h3 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h3><p>åˆ°è¿™é‡Œï¼Œæœ¬æ–‡å°±ç»“æŸäº†ï¼Œè‡³äºåç»­åˆ†æäº§ç”Ÿçš„æ ¹æœ¬åŸå› ï¼Œè¿™äº›éƒ½ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚æ€»ç»“ä¸€ä¸‹ï¼šè¿™æ¬¡çš„caseå¹¶ä¸ç®—å¤æ‚ï¼Œè§£å†³çš„æ—¶é—´ä¹Ÿå¾ˆçŸ­ï¼Œä½†å´å…·æœ‰ä»£è¡¨æ€§ã€‚æˆ‘è§‰å¾—è§£å†³é—®é¢˜å°±æ˜¯ï¼šé¦–å…ˆè¦å°½é‡â€œä»ç°è±¡ä¸­åˆ†æå‡ºâ€å¤§è‡´çš„æ–¹å‘ï¼Œâ€œé€šè¿‡æŠ€æœ¯æ‰‹æ®µâ€æ‰¾åˆ°æ€€ç–‘çš„ç‚¹ï¼Œâ€œå¿«é€Ÿå°è¯•â€ï¼ˆä¸»è¦æ˜¯æˆ‘ä»¬æŒæ¡çš„çŸ¥è¯†æœ‰é™ï¼Œæœ‰æ—¶å€™ç¢°ç¢°è¿æ°”æ•ˆæœä¼šæ›´å¥½ï¼‰æ¥è§£å†³é—®é¢˜ï¼Œæœ€åå†è¾…ä»¥â€œåˆ†ææ ¹å› å’Œæ€»ç»“â€å°±å¥½äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰æ®µæ—¶é—´ï¼ŒåŒäº‹é‡åˆ°Javaçš„GCé—®é¢˜ï¼Œç°è±¡è¡¨ç°ä¸ºï¼šgcæ—¶é—´è¶Šæ¥è¶Šé•¿ï¼ˆä¹ŸåŒ…æ‹¬young gcï¼‰ï¼›è§¦å‘ä¸€æ¬¡full gcä¹‹åï¼Œä¼šå˜å¾—å¥½ç‚¹ï¼Œä½†æ˜¯è¿™æ¬¡full gcé•¿çš„ä¸èƒ½å¿å—ã€‚ä»–ä»¬ä½¿ç”¨çš„jdk 8ï¼Œåº”ç”¨å†…å­˜8Gï¼Œå°è¯•è°ƒæ•´äº†å¾ˆå¤šå‚æ•°ï¼Œç”¨äº†ParNewç®—æ³•ï¼Œä¹Ÿè¯•è¿‡G1ç®—æ³•ï¼Œéƒ½æ²¡æœ‰å¤ªå¤§å¥½è½¬ã€‚å›°æ‰°å¾ˆä¹…ä¹‹åæ‰¾æˆ‘å¸®å¿™çœ‹ä¸€ä¸‹ï¼Œæ‰€ä»¥ä¹Ÿå°±æœ‰äº†è¿™ç¯‡æ–‡ç« ^_^&lt;/p&gt;
&lt;p&gt;GCå¯¹äºæˆ‘ä»¬æ¥è¯´ç›¸å¯¹é»‘ç›’ï¼Œå°¤å…¶æ˜¯young gcçš„é—®é¢˜ï¼Œå¹¸è¿çš„æ˜¯è¿™æ¬¡è§£å†³éå¸¸å¿«ä¸”æ²¡ä¾èµ–Googleã€‚å¯¹æˆ‘è€Œè¨€ï¼Œä¸»è¦æ˜¯è§£å†³é—®é¢˜è¿‡ç¨‹ä¸­çš„æ€è·¯ï¼Œå€¼å¾—è®°å½•ä¸‹æ¥ã€‚è‡³äºgcçš„æ ¹æœ¬åŸå› ï¼Œäº‹åæˆ‘æ‰¾åˆ°äº†&lt;a href=&quot;http://lovestblog.cn/blog/2016/11/06/string-intern/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ç¬¨ç¥çš„åšå®¢&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
      <category term="performance" scheme="https://xhao.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>Hotspotçš„safe point</title>
    <link href="https://xhao.io/2018/03/safepoint-2/"/>
    <id>https://xhao.io/2018/03/safepoint-2/</id>
    <published>2018-03-24T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨<a href="/2018/02/safepoint-1">ä¸Šä¸€ç¯‡</a>ä¸­å·²ç»æåˆ°äº†safe pointï¼Œå¿…é¡»å¼ºè°ƒè¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œä¸ä»…å¯¹Jvmï¼Œä¹Ÿå¯¹æ‰€æœ‰è¿è¡Œåœ¨jvmä¸Šçš„Javaåº”ç”¨ã€‚ä»Jvmçš„è§’åº¦æ¥çœ‹ï¼Œåˆ°è¾¾safe pointä¹‹åï¼ŒJvmä¼šå¼€å§‹åšä¸€äº›æœ‰æ„ä¹‰çš„äº‹ï¼ˆæ¯”å¦‚gcï¼‰ï¼›ä»åº”ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œè¾¾åˆ°safe pointæ„å‘³ç€å·¥ä½œçº¿ç¨‹ä¼šäº§ç”Ÿåœé¡¿ï¼Œå³å¸¸è¯´çš„â€œstop the worldâ€ã€‚å½“ä¸‹æ‰€æœ‰Jvmçš„å…·ä½“å®ç°éƒ½æœ‰è¿™æ ·çš„æ¦‚å¿µï¼ˆæ¯”å¦‚Hotspotã€Zingï¼‰ï¼Œäº†è§£ä¸€ç‚¹ç›¸å…³çš„çŸ¥è¯†å¯¹æˆ‘ä»¬çš„ç¼–ç¨‹ä»¥åŠè°ƒä¼˜éƒ½å¾ˆæœ‰å¸®åŠ©ã€‚<br><a id="more"></a></p><h2 id="safe-pointçš„å®šä¹‰"><a href="#safe-pointçš„å®šä¹‰" class="headerlink" title="safe pointçš„å®šä¹‰"></a>safe pointçš„å®šä¹‰</h2><p>åœ¨JavaOneå¤§ä¼šä¸Šï¼Œ<a href="#ps1">Azul</a>çš„ä¸€ä½å·¥ç¨‹å¸ˆæ˜¯è¿™æ ·æè¿°safe pointç›¸å…³æ¦‚å¿µçš„ï¼š</p><blockquote><p>safe point<br>A known point in execution where state is known, can be examined, and updated.</p></blockquote><blockquote><p>safe point operation<br>an operation that can take place when application threads are at a safe point</p></blockquote><blockquote><p>global safe point and local safe point<br>difference: all threads</p></blockquote><blockquote><p>why do we have safe points<br>operations that are atomic to all application threads</p></blockquote><p>ä»äº‹jvmæ€§èƒ½ç ”ç©¶çš„<a href="#ps2">Nitsan</a>è¯´çš„æ›´å…·ä½“ä¸€ç‚¹</p><blockquote><p>A safepoint is a range of execution where the state of the executing thread is well described. Mutator threads are threads which manipulate the JVM heap (all your Java Threads are mutators. Non-Java threads may also be regarded as mutators when they call into JVM APIs which interact with the heap).</p></blockquote><blockquote><p>At a safepoint the mutator thread is at a known and well defined point in itâ€™s interaction with the heap. This means that all the references on the stack are mapped (at known locations) and the JVM can account for all of them. As long as the thread remains at a safepoint we can safely manipulate the heap + stack such that the threadâ€™s view of the world remains consistent when it leaves the safepoint.</p></blockquote><h3 id="æˆ‘è§‰å¾—â€¦"><a href="#æˆ‘è§‰å¾—â€¦" class="headerlink" title="æˆ‘è§‰å¾—â€¦"></a>æˆ‘è§‰å¾—â€¦</h3><p>safe pointæ˜¯ä»jvmçš„è§’åº¦æ¥çœ‹çš„â€œå®‰å…¨â€ï¼š</p><ul><li>Jvmå¯¹è¿›ç¨‹èƒ½å¤Ÿå®Œå…¨çš„â€œæŒæ§â€ï¼Œæ¯”å¦‚å †å†…å­˜ã€è°ƒç”¨æ ˆã€å¯„å­˜å™¨ç­‰ï¼›</li><li>æ‰€æœ‰æ“ä½œjava heapçš„javaçº¿ç¨‹ä»¥åŠ<strong>è°ƒç”¨java APIçš„éjavaçº¿ç¨‹</strong>éƒ½éœ€è¦safe pointï¼›</li><li>è¿›å…¥å’Œç¦»å¼€safe pointï¼Œç¨‹åºåº”è¯¥æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥çº¿ç¨‹ä¼šè¢«é”ä½ï¼›</li><li>Jvmä¼šåšå½±å“æ‰€æœ‰çº¿ç¨‹çš„äº‹ï¼Œæ¯”å¦‚å›æ”¶å†…å­˜ï¼Œæ‰€ä»¥Jvmçš„å®ç°ä¸€å®šæœ‰global safe pointï¼›</li><li>global safe pointä¼šSTWï¼Œlocal safe pointåªå½±å“éƒ¨åˆ†threadsï¼›</li><li>ä¸€äº›gcå¹¶å‘ç®—æ³•ï¼Œthreadsä¼šè¿›å…¥safe pointï¼Œè™½ç„¶è§„èŒƒé‡Œæ²¡æœ‰è¯´ä¸€å®šæ˜¯global safe pointï¼Œä¸è¿‡Hotspotå½“å‰åªæœ‰global safe pointï¼Œæ‰€ä»¥stop threads = STWï¼›å¯¹æ‰€æœ‰çš„jvmå®ç°è€Œè¨€ï¼Œfull gcä¸€å®šæ˜¯è¿›å…¥global safe point</li><li>safe pointå¹¶éåªæ˜¯gcæ—¶å€™æ‰è§¦å‘ï¼Œå®é™…ä¸Šè§¦å‘ç‚¹æŒºå¤šçš„ï¼Œä¸è¿‡å¤§éƒ¨åˆ†éƒ½ä¸éœ€è¦æ‹…å¿ƒ</li><li>éœ€è¦æ‹…å¿ƒçš„æ¯”å¦‚gcï¼Œæ¯”å¦‚<a href="https://blog.csdn.net/hsuxu/article/details/9472381" target="_blank" rel="noopener">åå‘é”é—®é¢˜</a>ï¼Œæ¯”å¦‚JITçš„é€†ä¼˜åŒ–ï¼ˆä»£ç é€†ä¼˜åŒ–æ—¶ï¼Œä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€äº›å°è€ŒçŸ­æš‚çš„å½±å“)ï¼Œæ¯”å¦‚java profileå·¥å…·ï¼ˆå®ƒä»¬é€šå¸¸ä¼šé€šè¿‡è°ƒç”¨jvmtiå¯¼è‡´è§¦å‘safe pointï¼‰â€¦â€¦<code>--XX:+TraceSafepointCleanupTime</code>å¯ä»¥å¸®åŠ©æŸ¥çœ‹safe pointçš„ç»†èŠ‚</li><li><code>-XX:+PrintGCApplicationStoppedTime</code>å’Œ<code>-XX:+PrintGCApplicationConcurrentTime</code>è¿™2ä¸ªå‚æ•°æˆ‘è®¤ä¸ºjavaåº”ç”¨éƒ½åº”è¯¥ä½¿ç”¨</li></ul><h2 id="å¦‚ä½•è¿›å…¥safe-point"><a href="#å¦‚ä½•è¿›å…¥safe-point" class="headerlink" title="å¦‚ä½•è¿›å…¥safe point"></a>å¦‚ä½•è¿›å…¥safe point</h2><p>è¿™ä¸ªæˆ‘å»ºè®®çœ‹çœ‹<a href="http://psy-lob-saw.blogspot.com/2015/12/safepoints.html" target="_blank" rel="noopener">Bringing a Java Thread to a Safepointç« èŠ‚</a></p><p>æ‘˜å½•ä¸€ä¸‹å°±æ˜¯ï¼š</p><ul><li>Between any 2 bytecodes while running in the interpreter (effectively)</li><li>On â€˜non-countedâ€™ loop back edge in C1/C2 compiled code</li><li>Method entry/exit (entry for Zing, exit for OpenJDK) in C1/C2 compiled code. Note that the compiler will remove these safepoint polls when methods are inlined.</li><li>On Oracle/OpenJDK a blind TEST of an address on a special memory page is issued</li></ul><h3 id="æ¢å¥è¯è¯´â€¦â€¦"><a href="#æ¢å¥è¯è¯´â€¦â€¦" class="headerlink" title="æ¢å¥è¯è¯´â€¦â€¦"></a>æ¢å¥è¯è¯´â€¦â€¦</h3><p>ä¸æ˜¯æ¯ä¸€è¡ŒjavaæŒ‡ä»¤åé¢éƒ½ä¼šæœ‰<code>{poll}</code>çš„ï¼Œå¦‚æœæŸä¸€åˆ»Jvmå‘èµ·äº†global safe pointï¼Œå¤§éƒ¨åˆ†çº¿ç¨‹éƒ½è¿›å…¥safe pointï¼ˆblockï¼‰ï¼Œè€ŒæŸä¸ªçº¿ç¨‹è¿Ÿè¿Ÿæ— æ³•è¿›å…¥â€¦â€¦å°´å°¬çš„å¾ˆï¼Œæ­¤æ—¶çš„jvmå°±æ˜¯ä¸å·¥ä½œçŠ¶æ€ï¼ŒåŒ…æ‹¬jstackã€killç­‰å‘½ä»¤éƒ½æ˜¯æ— æ•ˆçš„</p><p>å¯¹äºä¸€ä¸ªçº¿ç¨‹æ¥è¯´ï¼Œé‡åˆ°<code>{poll}</code>ä¹‹å‰æ‰€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ä¸å¯é¢„çŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ—¶é—´æ˜¯ä¸å¯é¢„çŸ¥çš„ï¼Œè¿™æ®µæ—¶é—´æˆ‘ä»¬é€šå¸¸å«åšTime To Safe Point(TTSP)ï¼Œè¿™ä¸ªæ—¶é—´çš„é•¿çŸ­æœ‰æ—¶å€™ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„å½±å“ï¼Œå¯ä»¥å›å¤´å†çœ‹çœ‹æˆ‘ä»¬åœ¨æ–‡ç« å¼€å¤´æåˆ°çš„ç°è±¡â€¦â€¦</p><h2 id="æ›´è¿›ä¸€æ­¥"><a href="#æ›´è¿›ä¸€æ­¥" class="headerlink" title="æ›´è¿›ä¸€æ­¥"></a>æ›´è¿›ä¸€æ­¥</h2><p>å¦‚æœæˆ‘ä»¬çš„javaç¨‹åºé‡åˆ°äº†ä¸€äº›å¾ˆè¯¡å¼‚çš„æš‚åœï¼Œå¯ä»¥è€ƒè™‘åˆ†æçœ‹çœ‹safe pointï¼Œè¿™ä¸ªæ—¶å€™å‚æ•°<code>-XX:+PrintSafepointStatistics â€“XX:PrintSafepointStatisticsCount=X</code>å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚</p><p>ç»éªŒä¸Šæ¥çœ‹ï¼Œâ€œç¦æ­¢åå‘é”â€ã€â€œç¦æ­¢éƒ¨åˆ†ä»£ç å†…è”â€ä¼šå¯¹TTSPæœ‰æ‰€æ”¹å–„ï¼Œå½“ç„¶è¿™äº›ä¸œè¥¿éƒ½ä¸èƒ½ä¸€æ¦‚è€Œè®ºï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æå§ã€‚</p><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p><a name="ps1"><a href="https://www.youtube.com/watch?v=Y39kllzX1P8" target="_blank" rel="noopener">With GC Solved, What Else Makes a JVM Pause?</a></a></p><p><a name="ps2"><a href="http://psy-lob-saw.blogspot.com/Psy-Lob-Saw" target="_blank" rel="noopener">Nitsan Wakart</a></a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨&lt;a href=&quot;/2018/02/safepoint-1&quot;&gt;ä¸Šä¸€ç¯‡&lt;/a&gt;ä¸­å·²ç»æåˆ°äº†safe pointï¼Œå¿…é¡»å¼ºè°ƒè¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œä¸ä»…å¯¹Jvmï¼Œä¹Ÿå¯¹æ‰€æœ‰è¿è¡Œåœ¨jvmä¸Šçš„Javaåº”ç”¨ã€‚ä»Jvmçš„è§’åº¦æ¥çœ‹ï¼Œåˆ°è¾¾safe pointä¹‹åï¼ŒJvmä¼šå¼€å§‹åšä¸€äº›æœ‰æ„ä¹‰çš„äº‹ï¼ˆæ¯”å¦‚gcï¼‰ï¼›ä»åº”ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œè¾¾åˆ°safe pointæ„å‘³ç€å·¥ä½œçº¿ç¨‹ä¼šäº§ç”Ÿåœé¡¿ï¼Œå³å¸¸è¯´çš„â€œstop the worldâ€ã€‚å½“ä¸‹æ‰€æœ‰Jvmçš„å…·ä½“å®ç°éƒ½æœ‰è¿™æ ·çš„æ¦‚å¿µï¼ˆæ¯”å¦‚Hotspotã€Zingï¼‰ï¼Œäº†è§£ä¸€ç‚¹ç›¸å…³çš„çŸ¥è¯†å¯¹æˆ‘ä»¬çš„ç¼–ç¨‹ä»¥åŠè°ƒä¼˜éƒ½å¾ˆæœ‰å¸®åŠ©ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
      <category term="performance" scheme="https://xhao.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>Javaä¸­å’ŒSafePointç›¸å…³çš„æ•…äº‹</title>
    <link href="https://xhao.io/2018/02/safepoint-1/"/>
    <id>https://xhao.io/2018/02/safepoint-1/</id>
    <published>2018-02-13T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>äº‹æƒ…ç¼˜èµ·ä¸€æ®µ<a href="#ps1">æ€§èƒ½æµ‹è¯•ä»£ç </a>ï¼Œä¸»è¦æ˜¯æ¢è®¨åœ¨å¾ªç¯ä¸­ç´¢å¼•é”®ç±»å‹çš„é€‰æ‹©ï¼Œint vs long å“ªä¸ªæ›´å¥½ï¼Ÿæœ¬æ–‡å’Œåº”ç”¨å±‚é¢æ— å…³ï¼Œåªæ˜¯æ¢è®¨2ç§ç±»å‹çš„è¿­ä»£åœ¨æŸäº›åœºæ™¯å¯¹æ€§èƒ½çš„å½±å“ã€‚å¸Œæœ›ç»è¿‡åˆ†æä¹‹åï¼Œèƒ½å¯¹æˆ‘ä»¬å¹³æ—¶çš„ç¼–ç¨‹å¸¦æ¥ä¸€äº›å¸®åŠ©ï¼›æˆ–è€…æä¾›ä¸€äº›å¯¹safe pointçš„è®¤è¯†ã€‚ä¸‹é¢å¼€å§‹è¿›å…¥çœŸæ­£çš„ä¸»é¢˜â€¦â€¦<br><a id="more"></a></p><h4 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>è¿™ä¸ªissueçš„è®¨è®ºå¾ˆé•¿ï¼ŒèƒŒæ™¯çŸ¥è¯†å¾ˆå¤šï¼Œå…³é”®å…¶å®æ˜¯<a href="https://plus.google.com/107269247235043577368" target="_blank" rel="noopener">nitsanw</a>çš„è´¡çŒ®ï¼ˆnitsanwå¯¹jvmã€performanceéƒ½æœ‰å¾ˆæ·±çš„åŠŸåŠ›ï¼Œä»–çš„åšå®¢ä¹Ÿå€¼å¾—æ¨èğŸ‘ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@State</span>(Scope.Thread)</span><br><span class="line"><span class="meta">@BenchmarkMode</span>(Mode.AverageTime)</span><br><span class="line"><span class="meta">@OutputTimeUnit</span>(TimeUnit.NANOSECONDS)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayWrapperInterfaceBenchmark</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Param</span>(&#123; <span class="string">"100"</span>, <span class="string">"1000"</span>, <span class="string">"10000"</span> &#125;)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> size;</span><br><span class="line">  <span class="keyword">private</span> DataSet datasetA;</span><br><span class="line">  <span class="keyword">private</span> DataSet datasetB;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataSet</span><span class="params">(DataSet ds)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.data = Arrays.copyOf(ds.data, ds.data.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataSet</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">      Random r = <span class="keyword">new</span> Random();</span><br><span class="line">      data = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">        data[i] = r.nextInt();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">intSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> data.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">intGet</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> data[index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">intSet</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">      data[index] = v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">longSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> data.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longGet</span><span class="params">(<span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> data[(<span class="keyword">int</span>) index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">longSet</span><span class="params">(<span class="keyword">long</span> index, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">      data[(<span class="keyword">int</span>) index] = v;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Setup</span>(Level.Trial)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    datasetA = <span class="keyword">new</span> DataSet(size);</span><br><span class="line">    datasetB = <span class="keyword">new</span> DataSet(datasetA);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; datasetA.intSize(); ++index) &#123;</span><br><span class="line">      sum += datasetA.intGet(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumLong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> index = <span class="number">0</span>; index &lt; datasetA.longSize(); ++index) &#123;</span><br><span class="line">      sum += datasetA.longGet(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equalsInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; datasetA.intSize(); ++index) &#123;</span><br><span class="line">      <span class="keyword">if</span>(datasetA.intGet(index) != datasetB.intGet(index))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equalsLong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> index = <span class="number">0</span>; index &lt; datasetA.longSize(); ++index) &#123;</span><br><span class="line">      <span class="keyword">if</span>(datasetA.longGet(index) != datasetB.longGet(index))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; datasetA.intSize(); ++index) &#123;</span><br><span class="line">      datasetA.intSet(index, size);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillLong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> index = <span class="number">0</span>; index &lt; datasetA.longSize(); ++index) &#123;</span><br><span class="line">      datasetA.longSet(index, size);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copyInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; datasetA.intSize(); ++index) &#123;</span><br><span class="line">      datasetA.intSet(index, datasetB.intGet(index));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Benchmark</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copyLong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> index = <span class="number">0</span>; index &lt; datasetA.longSize(); ++index) &#123;</span><br><span class="line">      datasetA.longSet(index, datasetB.longGet(index));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç çš„å«ä¹‰ï¼š</p><ol><li>ä¸»è¦æ˜¯æ¯”è¾ƒåœ¨å¾ªç¯ä¸­ï¼Œç´¢å¼•ç±»å‹æ˜¯intå’Œlongï¼Œåˆ†åˆ«å¯¹å¾ªç¯è°ƒç”¨äº§ç”Ÿçš„æ€§èƒ½å½±å“ï¼Œæ‰€ä»¥æ¯ä¸ªç±»å‹çš„è°ƒç”¨éƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·</li><li>å¾ªç¯ä½“å†…çš„å®ç°éƒ½å¾ˆç®€å•ï¼ˆåŠ ã€å¤åˆ¶ã€æ¯”è¾ƒã€èµ‹å€¼ï¼‰ï¼Œè¿™äº›æ–¹æ³•è°ƒç”¨ä¼šè¢«JITä¼˜åŒ–æˆå†…è”å‡½æ•°</li><li>åˆ†åˆ«æµ‹è¯•äº†100ã€1000ã€10000æ¬¡å¾ªç¯çš„æ¯”è¾ƒï¼Œå–çš„æ˜¯å•æ¬¡è°ƒç”¨çš„å¹³å‡æ—¶é—´</li><li>å¾ªç¯ä½¿ç”¨çš„æ˜¯forå¾ªç¯ï¼Œåé¢ä¹Ÿä¼šä»‹ç»whileå¾ªç¯ä¹Ÿæœ‰ç±»ä¼¼çš„ç°è±¡</li></ol><p>è¿™æ®µä»£ç å†™èµ·æ¥å¾ˆç®€å•ï¼Œä¸è¿‡æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li>å¿…é¡»ä½¿ç”¨<a href="http://openjdk.java.net/projects/code-tools/jmh" target="_blank" rel="noopener">JMH</a>æ€§èƒ½æµ‹è¯•æ¡†æ¶ï¼š<ul><li>å¯¹Methodçº§åˆ«çš„æµ‹è¯•ï¼Œjmhç²¾åº¦å¯ä»¥è¾¾åˆ°å¾®ç§’çº§ï¼›</li><li>jmhå¯ä»¥å¯¹å±€éƒ¨ä»£ç è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼Œéå¸¸å¯é </li><li>ä¸è¿‡å³ä¾¿ä½¿ç”¨jmhï¼Œåœ¨ç±»ä¼¼å¾®ç§’çº§çš„è§‚å¯Ÿä¸Šï¼Œä¹Ÿä¼šå—åˆ°ç³»ç»Ÿçš„å½±å“ï¼Œè¿™ä¸ªè¦å°å¿ƒã€‚é€šå¸¸æˆ‘ä»¬è¿˜ä¼šæŸ¥çœ‹bytecodeï¼Œç”šè‡³ä½¿ç”¨<code>-XX:+PrintCompilation</code>æ¥æ£€æŸ¥ä¸åŒçš„æ–¹æ³•æ˜¯ç”±é‚£ä¸€å±‚compileræ¥å¤„ç†çš„</li></ul></li><li>åˆç†åœ°è®¾è®¡æµ‹è¯•ç”¨ä¾‹ï¼Œæ¯”å¦‚BlackHoleçš„consumeæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„æ–¹æ³•ï¼Œä¼šå½±å“JITçš„ä¸€äº›ä¼˜åŒ–ï¼Œåœ¨è¿™é‡Œå°±éœ€è¦è€ƒè™‘åˆ°</li><li>éœ€è¦é€‰æ‹©å¥½è¿è¡Œç¯å¢ƒï¼Œæ¯”å¦‚CPUç›¸å¯¹ç©ºé—²çš„ç³»ç»Ÿã€æ ‡æ³¨è¿è¡Œjvmç‰ˆæœ¬ç­‰</li></ol><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><p>æˆ‘åœ¨ä¸€å°24æ ¸56Gçš„centosè™šæ‹Ÿæœºä¸Šè¿›è¡Œæµ‹è¯•ï¼Œå¾—åˆ°äº†ä»¤äººæƒŠè®¶çš„<a href="/data/perf_out">ç»“æœ</a>ã€‚åŒæ ·çš„å¾ªç¯æ¬¡æ•°ï¼ŒåŒæ ·çš„è°ƒç”¨é€»è¾‘ï¼Œlongçš„ç‰ˆæœ¬æ¯”intæ…¢äº†è®¸å¤šã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è¿™é‡Œçš„æ ¸å¿ƒå°±æ˜¯safe pointæ£€æŸ¥ï¼šåœ¨å½“å‰jvmçš„å®ç°ä¸‹ï¼Œæ¯æ¬¡è¿­ä»£ç»“æŸéƒ½ä¼šæœ‰ä¸€ä¸ªsafe pointæ£€æŸ¥ï¼Œä½†æ˜¯åœ¨intç‰ˆæœ¬è¿­ä»£ä¸­ï¼ŒJITä¼˜åŒ–æ‰äº†safe pointçš„è°ƒç”¨ã€‚è¿™æ˜¯å› ä¸ºå½“å¾ªç¯æ¬¡æ•°æœ‰é™æ—¶ï¼ŒJITä¼šè®¤ä¸ºæ²¡æœ‰å¿…è¦æ¯ä¸€æ¬¡è¿­ä»£éƒ½å¢åŠ ä¸€ä¸ªsafe pointæ£€æŸ¥ç‚¹ï¼Œè€Œç­‰æ•´ä¸ªå¾ªç¯ç»“æŸï¼Œæ‰åšä¸€æ¬¡safe pointæ£€æŸ¥ï¼Œåˆ©äºæå‡æ€§èƒ½ï¼›ä½†è¿™æ ·å°±å¯¼è‡´JITåœ¨æœ‰é™å¾ªç¯ä¸­ä¼šåˆ å»safe pointï¼Œè€Œæœ‰é™å¾ªç¯ï¼ˆcounted loopï¼‰æ˜¯æŒ‡ç´¢å¼•ï¼ˆindexï¼‰æ˜¯intç±»å‹çš„forå¾ªç¯ã€‚ç»“æœåœ¨è¿™ç§å¾®å¦™çº§åˆ«çš„benchmarkä¸Šï¼Œä¼šå‡ºç°longå’Œintçš„æ€§èƒ½åŒºåˆ«ã€‚ï¼ˆè¿™é‡Œè¦éå¸¸å°å¿ƒå¾ªç¯ä½“å†…çš„è°ƒç”¨å¼€é”€ï¼Œå› ä¸ºsafe pointæ£€æŸ¥æ˜¯éå¸¸éå¸¸è½»é‡çº§çš„ï¼Œä¸€æ—¦çœŸå®çš„è°ƒç”¨å˜å¾—å¼€é”€å¾ˆå¤§ï¼Œæˆ‘ä»¬å°†å†ä¹Ÿçœ‹ä¸å‡ºä»»ä½•çš„åŒºåˆ«ã€‚ï¼‰</p><p>nitsanwè¿˜ä¸ºæˆ‘ä»¬æ€»ç»“äº†ä¸€äº›å¸¸è§çš„counted loopç¤ºä¾‹ï¼Œè§ä¸‹é¢çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. counted = reps is int/short/byte</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; reps; i++) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Not counted</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; int_reps; i+=<span class="number">2</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Not counted</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">long</span> l = <span class="number">0</span>; l &lt; int_reps; i++) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. Should be counted, but treated as uncounted</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (++i &lt; reps) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. Should be counted, but treated as uncounted</span></span><br><span class="line"><span class="keyword">while</span> (i++ &lt; reps) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. Should be counted, and is!</span></span><br><span class="line"><span class="keyword">while</span> (i &lt; reps) &#123;</span><br><span class="line">  i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h4><p>å…¶å®è¿™ç¯‡æ–‡ç« åªæ˜¯ä¸€ä¸ªå¼•å­ï¼Œå¼•å‡ºæˆ‘ä»¬å¯¹safe pointçš„ä¸€äº›ç®€å•è®¤è¯†ï¼ŒçŸ¥é“å®ƒæ˜¯åˆ°å¤„å­˜åœ¨ã€å½±å“æ€§èƒ½ä¸”æ˜¯å¯èƒ½è¢«ä¼˜åŒ–çš„ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘æ‰ä¼šé‡ç‚¹è®²è¿°ä¸€ä¸‹safe pointã€‚</p><h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><a name="ps1"><a href="https://github.com/netty/netty/pull/3969" target="_blank" rel="noopener">å¾ªç¯ä¸­ä½¿ç”¨longè¿˜æ˜¯intä½œä¸ºindexçš„è®¨è®º</a></a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;äº‹æƒ…ç¼˜èµ·ä¸€æ®µ&lt;a href=&quot;#ps1&quot;&gt;æ€§èƒ½æµ‹è¯•ä»£ç &lt;/a&gt;ï¼Œä¸»è¦æ˜¯æ¢è®¨åœ¨å¾ªç¯ä¸­ç´¢å¼•é”®ç±»å‹çš„é€‰æ‹©ï¼Œint vs long å“ªä¸ªæ›´å¥½ï¼Ÿæœ¬æ–‡å’Œåº”ç”¨å±‚é¢æ— å…³ï¼Œåªæ˜¯æ¢è®¨2ç§ç±»å‹çš„è¿­ä»£åœ¨æŸäº›åœºæ™¯å¯¹æ€§èƒ½çš„å½±å“ã€‚å¸Œæœ›ç»è¿‡åˆ†æä¹‹åï¼Œèƒ½å¯¹æˆ‘ä»¬å¹³æ—¶çš„ç¼–ç¨‹å¸¦æ¥ä¸€äº›å¸®åŠ©ï¼›æˆ–è€…æä¾›ä¸€äº›å¯¹safe pointçš„è®¤è¯†ã€‚ä¸‹é¢å¼€å§‹è¿›å…¥çœŸæ­£çš„ä¸»é¢˜â€¦â€¦&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
      <category term="performance" scheme="https://xhao.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>sneakyThrowå’Œtemplate</title>
    <link href="https://xhao.io/2017/11/sneakyThrow/"/>
    <id>https://xhao.io/2017/11/sneakyThrow/</id>
    <published>2017-11-11T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.505Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ¬¡æ˜¯ä»javaçš„å—æ£€å¼‚å¸¸è¯´èµ·ï¼Œä¸€ç›´ä¼šåˆ†æåˆ°æ³›å‹ã€lambdaä»¥åŠjava8ç±»å‹æ¨æ–­çš„ä¸€äº›é—®é¢˜<br><a id="more"></a><br>æ¯ä¸€ä¸ªå†™javaç¨‹åºçš„æœ‹å‹éƒ½çŸ¥é“ï¼Œjavaè¯­è¨€è§„èŒƒå¯¹å¼‚å¸¸æœ‰ä¸€ä¸ªåˆ†ç±»ï¼šå—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸ï¼›é€šå¸¸åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨æ„ï¼šå—æ£€å¼‚å¸¸éœ€è¦<code>try catch</code>æ¥å¤„ç†ï¼Œéœ€è¦åœ¨æ–¹æ³•å‚æ•°ä¸Šé€šè¿‡<code>throws XXXException</code>æ¥æ ‡ç¤ºã€‚å¯¹äºè¿™2ç§å¼‚å¸¸çš„åŒºåˆ†ï¼Œå¯ä»¥<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-11.html#jls-11.1.1" target="_blank" rel="noopener">å‚è€ƒ</a></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">The</span> unchecked exception classes are the run-time exception classes <span class="keyword">and </span>the error classes.</span><br><span class="line"></span><br><span class="line"><span class="symbol">The</span> checked exception classes are all exception classes other than the unchecked exception classes. That is, the checked exception classes are Throwable <span class="keyword">and </span>all <span class="keyword">its </span><span class="keyword">subclasses </span>other than RuntimeException <span class="keyword">and </span><span class="keyword">its </span><span class="keyword">subclasses </span><span class="keyword">and </span>Error <span class="keyword">and </span><span class="keyword">its </span><span class="keyword">subclasses.</span></span><br></pre></td></tr></table></figure><p>çœ‹çœ‹ä¸‹é¢è¿™ä¸ªå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ExceptionTest().test(); <span class="comment">// éå—æ£€å¼‚å¸¸ã€‚# line 6</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IOException(); <span class="comment">// å—æ£€å¼‚å¸¸</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            close(); <span class="comment">// å—æ£€å¼‚å¸¸  =&gt;  éå—æ£€å¼‚å¸¸ # line 15</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            ExceptionTest.&lt;NullPointerException&gt; sneakyThrow0(e); <span class="comment">// # line 17</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Throwable&gt; <span class="function"><span class="keyword">void</span> <span class="title">sneakyThrow0</span><span class="params">(Throwable t)</span> <span class="keyword">throws</span> T </span>&#123;  <span class="comment">// #line 22</span></span><br><span class="line">        <span class="keyword">throw</span> (T) t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆæ¬¡çœ‹åˆ°ä¼šæœ‰å‡ ä¸ªç–‘é—®ï¼š</p><ol><li>ç¼–è¯‘èƒ½é€šè¿‡ï¼Ÿèƒ½è¿è¡Œï¼Ÿ</li><li>#line 6æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>#line 17ä¼šä¸ä¼šå‡ºç°castå¼‚å¸¸ï¼Ÿ</li></ol><p>å®éªŒä¹‹åï¼Œæˆ‘ä»¬å‘ç°ç¼–è¯‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè¿è¡Œä¼šæŠ›å‡º<code>java.io.IOException</code>å¼‚å¸¸ï¼Œè¡¨æ˜åœ¨#line15æˆåŠŸçš„å°†â€å—æ£€å¼‚å¸¸å˜æˆäº†éå—æ£€å¼‚å¸¸â€ã€‚</p><p>æˆ‘ä»¬é€ä¸ªåˆ†æä¸€ä¸‹ï¼š</p><ul><li>é¦–å…ˆline6è¿™é‡Œä¸å†éœ€è¦<code>try catch</code>ï¼Œå°½ç®¡æœ€ç»ˆæŠ›å‡ºçš„å¼‚å¸¸<code>IOException</code>æ˜¯ä¸€ä¸ªå—æ£€å¼‚å¸¸ã€‚è¿™æ˜¯å› ä¸ºå—æ£€å¼‚å¸¸å¼ºåˆ¶æ£€æŸ¥çš„è§„èŒƒæ˜¯javaè¯­è¨€è§„èŒƒå¹¶ä¸æ˜¯jvmçš„è§„èŒƒï¼Œæ‰€ä»¥å®ƒçš„æ£€æŸ¥æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ç”±javacçš„å®ç°æ¥<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-11.html#jls-11.2" target="_blank" rel="noopener">å†³å®š</a>ã€‚</li><li>å°†å—æ£€å¼‚å¸¸å˜æˆéå—æ£€å¼‚å¸¸ï¼Œæ˜¯é€šè¿‡<code>sneakyThrow0</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”³æ˜æŠ›å‡ºçš„å¼‚å¸¸æ˜¯T(&lt;T extends Throwable&gt;)ï¼Œè€Œåœ¨#line 17å®šä¹‰çš„Tæ˜¯<code>NullPointerException</code>ï¼Œæ‰€ä»¥okï¼Œè¿™æ˜¯ä¸€ä¸ªéå—æ£€å¼‚å¸¸ï¼Œæˆ‘ä»¬ä¸éœ€è¦<code>try catch</code>ã€‚åŒæ ·ï¼Œæˆ‘ä»¬åœ¨#line 23æ˜¯ç›´æ¥<code>throw e</code>ï¼Œæ‰€ä»¥å¼‚å¸¸æ˜¯æ²¡æœ‰ç»è¿‡ä»»ä½•å¤„ç†çš„ï¼ŒåŸæ ·è¾“å‡ºå³<code>IOException</code>ã€‚è‡³äº<code>(T) t</code>è¿™é‡Œçš„Tè™½ç„¶å’Œtçš„å¼‚å¸¸ç±»å‹æ— æ³•åŒ¹é…ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œå› ä¸ºæ ¹æœ¬ä¸ä¼šè§¦å‘è¿™ä¸€å±‚è½¬åŒ–â€¦â€¦æ³›å‹åœ¨ç¼–è¯‘å®Œæˆä¹‹åå°±ä¼šè¢«æ“¦é™¤ã€‚</li><li>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“#line17çš„å¼‚å¸¸å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œåªè¦æ˜¯æ»¡è¶³&lt;T extends Throwable&gt;ã€‚</li></ul><p>å…¶å®è¿™é‡Œæ¶‰åŠå¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼šå¼‚å¸¸ç±»å‹æ£€æŸ¥åœ¨ç¼–è¯‘é˜¶æ®µã€æ³›å‹ä¸­çš„æœ‰ç•Œç±»å‹ã€æ³›å‹æ£€æŸ¥åœ¨ç¼–è¯‘é˜¶æ®µã€‚æˆ‘ä»¬éƒ½çŸ¥é“java8æä¾›äº†å®Œå¤‡çš„ç±»å‹æ¨æ–­å’Œlambdaï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„è¿™ä¸ªä¾‹å­è¿›ä¸€æ­¥æ”¹å†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ExceptionTest().test2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            ExceptionTest.&lt;NullPointerException&gt; sneakyThrow0(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Throwable&gt; <span class="function"><span class="keyword">void</span> <span class="title">sneakyThrow0</span><span class="params">(Throwable t)</span> <span class="keyword">throws</span> T </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> (T) t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &lt;T extends Throwable&gt; <span class="function"><span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Action&lt;T&gt; action)</span> <span class="keyword">throws</span> T </span>&#123;</span><br><span class="line">        action.doIt(); <span class="comment">// throws T</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        invoke(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        invoke(() -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">        invoke(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;);</span><br><span class="line">        invoke(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Action</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Throwable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doIt</span><span class="params">()</span> <span class="keyword">throws</span> T</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ¥å£<code>Action</code>ï¼Œå®ƒå’Œå‰é¢çš„<code>sneakyThrow0</code>ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯ä¸€ä¸ª<code>FunctionInterface</code>ã€‚è¿™é‡Œé™¤äº†ä¸Šé¢è¯´åˆ°çš„å‡ ä¸ªé—®é¢˜ä¹‹å¤–ï¼Œå¤šå¼•å…¥äº†ç±»å‹æ¨æ–­çš„è¯é¢˜ã€‚å› ä¸ºlambdaè¡¨è¾¾å¼éœ€è¦ç¼–è¯‘å™¨æ¨æ–­å‡ºæ­£ç¡®çš„ç±»å‹ã€‚</p><p>è¿™æ®µä»£ç èƒ½å¤Ÿç¼–è¯‘é€šè¿‡ï¼Œè¯´æ˜ä¸ç®¡throwçš„æ˜¯å—æ£€å¼‚å¸¸è¿˜æ˜¯éå—æ£€å¼‚å¸¸ï¼Œjavacéƒ½èƒ½æ­£ç¡®åœ°æ¨æ–­å‡ºæ¥ï¼Œæ ¹æ®å°±æ˜¯<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-18.html#jls-18.4" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™æ¬¡æ˜¯ä»javaçš„å—æ£€å¼‚å¸¸è¯´èµ·ï¼Œä¸€ç›´ä¼šåˆ†æåˆ°æ³›å‹ã€lambdaä»¥åŠjava8ç±»å‹æ¨æ–­çš„ä¸€äº›é—®é¢˜&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨java profile</title>
    <link href="https://xhao.io/2017/11/jvm-profile/"/>
    <id>https://xhao.io/2017/11/jvm-profile/</id>
    <published>2017-11-07T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ¬¡æ˜¯å­¦ä¹ ä½¿ç”¨ä¸€ä¸ªjava sampleå·¥å…·ï¼Œé¡ºä¾¿äº†è§£ä¸€äº›linuxã€jvmçš„çŸ¥è¯†<br><a id="more"></a><br>æµè§ˆgithubçš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªä¸é”™çš„javaå·¥å…·â€”â€”<a href="https://github.com/jvm-profiling-tools/async-profiler" target="_blank" rel="noopener">async-profile</a>ï¼Œè¿™å’Œå¹³æ—¶ä½¿ç”¨çš„JMCå·®ä¸å¤šï¼Œä¸è¿‡å®ƒæ˜¯å¼€æºçš„ï¼Œå¯¹äºæˆ‘ä»¬ä¸ç®—æ˜¯é»‘ç›’ã€‚æ—¶é—´å……è£•çš„è¯ï¼Œè¿˜å¯ä»¥çœ‹çœ‹å®ƒçš„æºç ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†Hotspotçš„ä¸€äº›å›è°ƒï¼Œé¡ºé“è¿˜èƒ½åŠ æ·±å¯¹Hotspotçš„äº†è§£ã€‚æœ¬æ–‡ä¼šä»4ä¸ªæ–¹é¢æ€»ç»“ä¸€ä¸‹å¿ƒå¾—ä½“ä¼šã€‚</p><h2 id="async-profileçš„ä½¿ç”¨"><a href="#async-profileçš„ä½¿ç”¨" class="headerlink" title="async profileçš„ä½¿ç”¨"></a>async profileçš„ä½¿ç”¨</h2><p>å·¥å…·çš„ä½¿ç”¨è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå®˜æ–¹ä¹Ÿæœ‰å¾ˆè¯¦ç»†çš„<a href="https://github.com/jvm-profiling-tools/async-profiler#profiler-options" target="_blank" rel="noopener">è¯´æ˜</a>ï¼ˆæºç ä¸‹è½½åè®°å¾—<code>make</code>ç¼–è¯‘ä¸€ä¸‹ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ jps</span><br><span class="line">9234 Jps</span><br><span class="line">8983 Computey</span><br><span class="line">$ ./profiler.sh start 8983</span><br></pre></td></tr></table></figure><p>å½“ä½ <code>./profiler.sh stop 8983</code>çš„æ—¶å€™ï¼Œä¼šå°†ä¹‹å‰sampleçš„æ•°æ®æ‰“å°åœ¨æ§åˆ¶å°ï¼Œä¸è¿‡é€šå¸¸æ•°æ®éƒ½å¾ˆå¤šï¼Œæˆ‘ä¼šé€‰æ‹©<code>-f /tmp/sample.txt</code>ç”¨æ–‡ä»¶ä¿å­˜èµ·æ¥ï¼Œæ–¹ä¾¿ä½¿ç”¨</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>-e event</code>ä¹Ÿæ¯”è¾ƒæœ‰ç”¨ï¼Œä¸è¿‡ä½¿ç”¨ä¹‹å‰éœ€è¦<code>list pid</code>æ¥çœ‹çœ‹ä½ çš„æœºå™¨ä¸Šæ”¯æŒå“ªäº›eventsï¼Œæ¯”å¦‚æˆ‘çš„æœºå™¨ä¸Šè¿”å›çš„æ˜¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Perf events:</span><br><span class="line">  cpu</span><br><span class="line">Java events:</span><br><span class="line">  alloc</span><br><span class="line">  lock</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨æˆ‘çš„macä¸Šï¼Œæ”¯æŒçš„ç±»å‹æ¯”è¾ƒå°‘ï¼Œä¸»è¦æ˜¯perf_eventsæ˜¯linuxä¸Šçš„å·¥å…·ã€‚</p><p>æˆ‘åœ¨centos7ä¸Šçœ‹åˆ°è¿™æ ·çš„ç»“æœ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Perf events:</span><br><span class="line">  cpu</span><br><span class="line">  page-faults</span><br><span class="line">  context-switches</span><br><span class="line">  cycles</span><br><span class="line">  instructions</span><br><span class="line">  cache-references</span><br><span class="line">  cache-misses</span><br><span class="line">  branches</span><br><span class="line">  branch-misses</span><br><span class="line">  bus-cycles</span><br><span class="line">  L1-dcache-load-misses</span><br><span class="line">  LLC-load-misses</span><br><span class="line">  dTLB-load-misses</span><br><span class="line">Java events:</span><br><span class="line">  alloc</span><br><span class="line">  lock</span><br></pre></td></tr></table></figure><p><code>-t pid</code>ä¹Ÿå¾ˆå¸¸ç”¨ï¼Œå®ƒæ˜¯æ ¹æ®çº¿ç¨‹æ¥sampleçš„ï¼Œè¿™æ ·å¯¹æˆ‘ä»¬åç»­çš„åˆ†æä¼šå¸¦æ¥å¥½å¤„</p><h3 id="é™åˆ¶æ¡ä»¶"><a href="#é™åˆ¶æ¡ä»¶" class="headerlink" title="é™åˆ¶æ¡ä»¶"></a>é™åˆ¶æ¡ä»¶</h3><ol><li><p>å·¥å…·æœ€å¤§çš„é™åˆ¶å¤§éƒ½å’Œ<code>perf</code><a href="https://github.com/jvm-profiling-tools/async-profiler#restrictionslimitations" target="_blank" rel="noopener">ç›¸å…³</a> </p></li><li><p>ä¸èƒ½æ‰“å¼€<code>-XX:+DisableAttachMechanism</code>ï¼Œå› ä¸ºå®ƒä¹Ÿæ˜¯ä½¿ç”¨jvmçš„attach<a href="http://lovestblog.cn/blog/2014/06/18/jvm-attach/" target="_blank" rel="noopener">æœºåˆ¶</a></p></li></ol><h2 id="async-profileç‰¹ç‚¹"><a href="#async-profileç‰¹ç‚¹" class="headerlink" title="async profileç‰¹ç‚¹"></a>async profileç‰¹ç‚¹</h2><p>ä¸€å¥è¯æ¦‚æ‹¬ï¼Œå°±æ˜¯å¾ˆå°çš„é¢å¤–å¼€é”€ï¼Œéå¸¸é€‚åˆäºç”Ÿäº§ç¯å¢ƒã€‚cpu profilingä½¿ç”¨çš„æ˜¯perf_eventså’Œjava code addressçš„matchæ¥è¿½è¸ªï¼›memory allocationä½¿ç”¨çš„æ˜¯Hotspotä¸Šçš„å›è°ƒï¼Œä¸éœ€è¦å­—èŠ‚ç ä¿®æ”¹ç­‰å¤æ‚çš„æŠ€æœ¯ã€‚</p><h2 id="jvm-safePoint-bias"><a href="#jvm-safePoint-bias" class="headerlink" title="jvm safePoint bias"></a>jvm safePoint bias</h2><p>è¿™é‡Œè¦è¯´çš„æ˜¯safePointå’Œjvm profileçš„å…³ç³»</p><p>æˆ‘çœ‹åˆ°æœ‰ä¸€ä½é«˜æ‰‹å†™äº†2ç¯‡æ–‡ç« ï¼Œç®—æ˜¯é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šäº†å…¶ä»–profileçš„é—®é¢˜æ‰€åœ¨</p><p><a href="http://psy-lob-saw.blogspot.ru/2016/02/why-most-sampling-java-profilers-are.html" target="_blank" rel="noopener">why-most-sampling-java-profilers-are</a></p><p><a href="http://psy-lob-saw.blogspot.co.za/2016/06/the-pros-and-cons-of-agct.html" target="_blank" rel="noopener">the-pros-and-cons-of-agct</a></p><h2 id="perfå·¥å…·"><a href="#perfå·¥å…·" class="headerlink" title="perfå·¥å…·"></a>perfå·¥å…·</h2><p>è¿™æ˜¯linuxå†…æ ¸è‡ªå¸¦çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚ä»å‰é¢2æ®µ<code>$ ./profiler.sh list pid</code>ç»“æœä¹Ÿèƒ½çœ‹åˆ°ï¼Œæœ‰äº†perfå·¥å…·ä¹‹åï¼Œå¯ä»¥è¿½è¸ªåˆ°ç¡¬ä»¶æˆ–è€…å†…æ ¸çº§åˆ«çš„è½¯ä»¶äº‹ä»¶ã€‚</p><p>åœ¨centosä¸Šçš„å®‰è£…æ–¹å¼<code>sudo yum install perf</code></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œ<code>perf stat</code>å‘½ä»¤å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…¨å±€çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œèƒ½åœ¨ç¬¬ä¸€æ—¶é—´å¸®åŠ©æˆ‘ä»¬åˆ†æé—®é¢˜</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ perf <span class="built_in">stat</span> <span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br><span class="line">/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.111-1.b15.el7_2.x86_64</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">'echo /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.111-1.b15.el7_2.x86_64'</span>:</span><br><span class="line"></span><br><span class="line">          0,505282      task-clock (msec)         <span class="comment">#    0,195 CPUs utilized          CPU åˆ©ç”¨ç‡ï¼Œè¯¥å€¼é«˜ï¼Œè¯´æ˜ç¨‹åºçš„å¤šæ•°æ—¶é—´èŠ±è´¹åœ¨ CPU è®¡ç®—ä¸Šè€Œé IO</span></span><br><span class="line">                 1      context-switches          <span class="comment">#    0,002 M/sec                  è¿›ç¨‹åˆ‡æ¢æ¬¡æ•°ï¼Œè®°å½•äº†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¤šå°‘æ¬¡è¿›ç¨‹åˆ‡æ¢ï¼Œé¢‘ç¹çš„è¿›ç¨‹åˆ‡æ¢æ˜¯åº”è¯¥é¿å…çš„</span></span><br><span class="line">                 0      cpu-migrations            <span class="comment">#    0,000 K/sec                  è¡¨ç¤ºè¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¤šå°‘æ¬¡ CPU è¿ç§»ï¼Œå³è¢«è°ƒåº¦å™¨ä»ä¸€ä¸ª CPU è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ª CPU ä¸Šè¿è¡Œ</span></span><br><span class="line">               168      page-faults               <span class="comment">#    0,332 M/sec                  </span></span><br><span class="line">   &lt;not supported&gt;      cycles                    <span class="comment">#                                 å¤„ç†å™¨æ—¶é’Ÿï¼Œä¸€æ¡æœºå™¨æŒ‡ä»¤å¯èƒ½éœ€è¦å¤šä¸ª cycles </span></span><br><span class="line">   &lt;not supported&gt;      instructions              <span class="comment">#                                 æœºå™¨æŒ‡ä»¤æ•°ç›® </span></span><br><span class="line">   &lt;not supported&gt;      branches                  <span class="comment">#                                  </span></span><br><span class="line">   &lt;not supported&gt;      branch-misses             <span class="comment">#                                  </span></span><br><span class="line"></span><br><span class="line">       0,002588576 seconds time elapsed</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„å‘½ä»¤åŒ…æ‹¬ï¼š<code>perf top</code>ç”¨äºå®æ—¶æ˜¾ç¤ºå½“å‰ç³»ç»Ÿçš„æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ã€‚è¯¥å‘½ä»¤ä¸»è¦ç”¨æ¥è§‚å¯Ÿæ•´ä¸ªç³»ç»Ÿå½“å‰çš„çŠ¶æ€ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡æŸ¥çœ‹è¯¥å‘½ä»¤çš„è¾“å‡ºæ¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿæœ€è€—æ—¶çš„å†…æ ¸å‡½æ•°æˆ–æŸä¸ªç”¨æˆ·è¿›ç¨‹â€¦â€¦ç­‰ç­‰</p><p>è¯¦ç»†å»æ‰¾æ‰‹å†Œå°±å¥½</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™æ¬¡æ˜¯å­¦ä¹ ä½¿ç”¨ä¸€ä¸ªjava sampleå·¥å…·ï¼Œé¡ºä¾¿äº†è§£ä¸€äº›linuxã€jvmçš„çŸ¥è¯†&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
      <category term="performance" scheme="https://xhao.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu16.04LTSé‡åˆ°çš„dnsè§£æé—®é¢˜</title>
    <link href="https://xhao.io/2017/03/ubuntu-dns-problem/"/>
    <id>https://xhao.io/2017/03/ubuntu-dns-problem/</id>
    <published>2017-03-24T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.505Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªubuntuç³»ç»Ÿçš„é—®é¢˜ï¼šæ— æ³•ä½¿ç”¨dnsè§£ææœåŠ¡ã€‚æ‰¾åˆ°åŸå› ï¼Œå±…ç„¶æ˜¯å’Œ<a href="https://wiki.archlinux.org/index.php/NetworkManager_\(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87\" target="_blank" rel="noopener">NetworkManager</a>)ç›¸å…³<br><a id="more"></a></p><h3 id="æˆ‘é‡åˆ°é—®é¢˜æ—¶çš„åœºæ™¯æ˜¯ï¼š"><a href="#æˆ‘é‡åˆ°é—®é¢˜æ—¶çš„åœºæ™¯æ˜¯ï¼š" class="headerlink" title="æˆ‘é‡åˆ°é—®é¢˜æ—¶çš„åœºæ™¯æ˜¯ï¼š"></a>æˆ‘é‡åˆ°é—®é¢˜æ—¶çš„åœºæ™¯æ˜¯ï¼š</h3><ul><li>æ“ä½œç³»ç»Ÿubuntu 16.04LTS</li><li>è·¯ç”±å™¨æ˜¯æ¢…æ—ç³»ç»Ÿï¼Œä½¿ç”¨äº†shadesocksæ’ä»¶</li><li>è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œdnsæ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæˆ‘çš„è·¯ç”±å™¨ç«¯å¹¶æ²¡æœ‰é—®é¢˜ï¼Œä¾ç„¶å¯ä»¥googleï¼‰</li><li>åŒä¸€æ—¶é—´ï¼Œæˆ‘çš„ubuntuæœåŠ¡å™¨æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®ç½‘ç»œçš„</li></ul><h3 id="è§£å†³é—®é¢˜çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š"><a href="#è§£å†³é—®é¢˜çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š" class="headerlink" title="è§£å†³é—®é¢˜çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š"></a>è§£å†³é—®é¢˜çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š</h3><ul><li><p>sudo vi /etc/NetworkManager/NetworkManager.conf</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line">plugins=ifupdown,keyfile,ofono</span><br><span class="line"><span class="comment">#dns=dnsmasq   æ³¨é‡Šæ‰å®ƒ</span></span><br></pre></td></tr></table></figure></li><li><p>sudo service network-manager restart</p></li></ul><p>é‡å¯networkmanagerä¹‹åï¼Œä¼šå‘ç°<code>/etc/resolv.conf</code>ä¸å†æœ‰127.0.1.1è¿™ä¸ªnameserverï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æˆ‘çš„è·¯ç”±å™¨åœ°å€</p><h3 id="reason"><a href="#reason" class="headerlink" title="reason"></a>reason</h3><p>å…¶å®è¿™æ˜¯ä»120.4ltsä¹‹åï¼Œæ–°åŠ å…¥çš„å®ç°ï¼Œå¯¹äºvpnçš„ç”¨æˆ·æ¥è¯´ï¼Œç¨æœ‰ä¸åŒï¼Œ<a href="https://stgraber.org/2012/02/24/dns-in-ubuntu-12-04/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« åšäº†ä¸€ä¸ªç®€å•åœ°ä»‹ç»</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€ä¸ªubuntuç³»ç»Ÿçš„é—®é¢˜ï¼šæ— æ³•ä½¿ç”¨dnsè§£ææœåŠ¡ã€‚æ‰¾åˆ°åŸå› ï¼Œå±…ç„¶æ˜¯å’Œ&lt;a href=&quot;https://wiki.archlinux.org/index.php/NetworkManager_\(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87\&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;NetworkManager&lt;/a&gt;)ç›¸å…³&lt;br&gt;
    
    </summary>
    
    
      <category term="linux" scheme="https://xhao.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>macä¸ŠfdæŠ¥é”™æœ‰ç‚¹å¥‡æ€ª</title>
    <link href="https://xhao.io/2017/01/nio-open-file/"/>
    <id>https://xhao.io/2017/01/nio-open-file/</id>
    <published>2017-01-10T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ä½¿ç”¨rabbitmq java clientæ—¶ï¼Œæœ‰å°ä¼™ä¼´åœ¨macä¸Šå†™äº†ä¸€æ®µä»£ç ï¼Œå‘ç°å½“åˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°rabbitmq-serveræ—¶å°±ä¼šæŠ¥é”™<code>bad file descriptor</code>ï¼Œè™½ç„¶åœ¨linuxæœåŠ¡å™¨ä¸Šæ²¡æœ‰å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸ºäº†å®‰å…¨ï¼Œè¿˜æ˜¯èŠ±äº†ç‚¹æ—¶é—´è¿›è¡Œè°ƒæŸ¥ã€‚<br><a id="more"></a><br>ä»ç°è±¡æ¥çœ‹æ˜¯rabbitmqè¿æ¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬èµ¶ç´§æ£€æŸ¥rabbitmq-serverçš„æ—¥å¿—ã€‚ä½†ç»“æœå¾ˆå°´å°¬ï¼Œå¹¶æ²¡æœ‰å‘ç°å¼‚å¸¸â€¦â€¦æ—¥å¿—é‡Œè®°è½½çš„æ˜¯ç”±äºå¿ƒè·³å¼‚å¸¸ï¼Œè¿æ¥è¢«å…³é—­ã€‚è¿™è®©äººå¾ˆå›°æƒ‘ï¼Œè¯´æ˜tcpè¿æ¥æ˜¯æˆåŠŸçš„ï¼Œä½†ä¹‹åå¾ˆå¿«ï¼Œå®¢æˆ·ç«¯å°±æŠ¥é”™äº†ã€‚å¼€å§‹æœ‰ç‚¹ä¸ä¿¡ï¼Œç‰¹æ„çœ‹äº†ä¸‹è¿æ¥æ•°ï¼Œç¡®å®å‘ç°äº†ä¸€ä¸ªtcpè¿æ¥ç”±establishedå˜æˆclosedï¼Œé€šè¿‡tcpdumpå‘ç°tcpå››æ¬¡æŒ¥æ‰‹çš„æ—¶å€™ä¹Ÿå¹¶æ²¡æœ‰å‘é€ä»»ä½•å¥‡æ€ªçš„æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®è®¤tcpè¿æ¥æ²¡æœ‰é—®é¢˜ï¼Œæ˜¯å…¶ä»–åŸå› é€ æˆäº†å®¢æˆ·ç«¯çš„æŠ¥é”™ã€‚</p><p>é‡æ–°çœ‹ä¸€ä¸‹javaé‡Œçš„å †æ ˆæ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.net.SocketException: Bad file descriptor</span><br><span class="line">    at java.net.SocketOutputStream.socketWrite0(Native Method)</span><br><span class="line">    at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:<span class="number">109</span>)</span><br><span class="line">    at java.net.SocketOutputStream.write(SocketOutputStream.java:<span class="number">153</span>)</span><br><span class="line">    at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:<span class="number">82</span>)</span><br><span class="line">    at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:<span class="number">140</span>)</span><br><span class="line">    at java.io.DataOutputStream.flush(DataOutputStream.java:<span class="number">123</span>)</span><br><span class="line">    at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:<span class="number">129</span>)</span><br><span class="line">    at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:<span class="number">134</span>)</span><br><span class="line">    at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:<span class="number">277</span>)</span><br><span class="line">    at com.rabbitmq.client.impl.recovery.RecoveryAwareAMQConnectionFactory.newConnection(RecoveryAwareAMQConnectionFactory.java:<span class="number">37</span>)</span><br></pre></td></tr></table></figure><p>é—®é¢˜æ˜¯socket flushçš„æ—¶å€™å‘ç°fd is badï¼Œç”±æ­¤å¯è§åº”è¯¥æ˜¯å’Œfdç›¸å…³ã€‚</p><p>åœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡lsofå‘½ä»¤ï¼Œæˆ‘ä»¬å‘ç°è¿›ç¨‹å ç”¨äº†å¾ˆå¤šçš„fdï¼Œå®ƒä»¬éƒ½æ˜¯nettyçš„eventloopGroupåˆ›å»ºå‡ºæ¥çš„ï¼ˆé¡¹ç›®ä¸­ä½¿ç”¨äº†nettyï¼‰ï¼Œæœ‰ä¸€ç‚¹æ˜¯æ˜ç¡®çš„ï¼Œjava nioçš„selectorä¼šå ç”¨2ä¸ªPIPEï¼Œè€Œä¸”åˆå§‹åŒ–eventloopGroupçš„æ—¶å€™ï¼Œnettyå°±ä¼šæŠŠå®ƒä»¬éƒ½åˆ›å»ºå‡ºæ¥äº†ã€‚æ¯”å¦‚è®¾ç½®nä¸ªçº¿ç¨‹ï¼Œå°±ä¼šæ¶ˆè€—2n+çš„fdï¼ˆ2nä¸ªPIPE+å…¶ä»–ï¼‰ã€‚æˆ‘åˆæŸ¥çœ‹äº†ä¸€ä¸‹ulimitè®¾ç½®ï¼Œè¿˜å‘ç°ä¸€ä¸ªå¥‡æ€ªçš„åœ°æ–¹ï¼Œå°±æ˜¯<code>ulimit -Hn</code>è™½ç„¶æ˜¾ç¤ºçš„<code>unlimited</code>ï¼Œä½†å®é™…ä¸Šè¶…è¿‡4096å°±ä¼šæŠ¥é”™ã€‚è¿™ä¸ªæ˜¯å†™åœ¨jdkçš„nativeé‡Œï¼Œå½“å‘ç°æ˜¯hard limitæ˜¯â€œunlimitedâ€çš„æ—¶å€™ï¼Œä¼šå°†å®ƒè®¾ç½®æˆ4096çš„ä¸Šé™ï¼ˆä¼°è®¡æ˜¯ä¸€ç§ä¿æŠ¤ï¼‰ã€‚</p><p>ä»¥ä¸Šæ˜¯å‘ç°ä»£ç é‡Œæ¶ˆè€—éå¸¸å¤šçš„fdåŸå› ï¼Œè¿™é‡Œè§¦å‘é”™è¯¯çš„æƒ…å½¢çŒœæµ‹åº”è¯¥æ˜¯ï¼šsocketåˆ›å»ºæˆåŠŸï¼Œä½†æ˜¯fdåˆ›å»ºå¤±è´¥ï¼Œç„¶åflushçš„æ—¶å€™æŠ¥é”™ã€‚ä½†æŒ‰ç…§linuxä¸Šçš„æ­£ç¡®æ˜¾ç¤ºï¼Œåº”è¯¥æ˜¯socketæ²¡æœ‰åˆ›å»ºæˆåŠŸï¼Œè€Œä¸æ˜¯ç­‰åˆ°ä½¿ç”¨fdçš„æ—¶å€™æ‰æŠ¥é”™ã€‚ç”¨dtrussæŠ“å–äº†osçš„è°ƒç”¨æƒ…å†µï¼Œå‘ç°è¿™å’Œmacä»¥åŠtimeoutç›¸å…³ã€‚</p><p>å½“socketåˆ›å»ºçš„æ—¶å€™ï¼Œæ²¡æœ‰å¸¦è¶…æ—¶æ—¶é—´ï¼ˆtimeoutï¼‰ï¼Œmacä¸ŠæŠ¥é”™çš„æ–¹å¼å’Œlinuxä¸Šç›¸åŒï¼Œä¹Ÿæ˜¯åœ¨åˆ›å»ºsocketçš„æ—¶å€™å¤±è´¥ï¼ŒæŠ¥é”™å¾ˆæ˜ç¡®ï¼›ä½†å¦‚æœå¸¦äº†è¶…æ—¶æ—¶é—´ï¼ˆtimeoutï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹çš„socketåˆ›å»ºæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸æ˜¯ç«‹å³è¿”å›ï¼Œå®ƒä¼šç­‰å¾…fdçš„è·å–ï¼Œç¥å¥‡çš„æ˜¯è¿™ä¸ªåœ°æ–¹åº”è¯¥æ˜¯æ²¡æœ‰è·å¾—fdï¼Œä½†å±…ç„¶æ²¡æœ‰æŠ¥é”™ï¼Œsocketåˆ›å»ºæˆåŠŸå¹¶ä¸”è¿”å›ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªæ²¡æœ‰å®Œå…¨åˆå§‹åŒ–å¥½çš„socketæ—¶ï¼ŒæŠ¥é”™ä¿¡æ¯å°±å¦‚ä¸Šæ–‡è¿™æ ·ã€‚æˆ‘çœ‹åˆ°äº†è¿™éƒ¨åˆ†ä»£ç ï¼Œä½†ç›®å‰è¿˜æ²¡æœ‰æƒ³æ˜ç™½ä¸ºä»€ä¹ˆæŠ¥é”™ï¼ˆéœ€è¦å¯¹jdkæ›´å¤šçš„äº†è§£ï¼Œè¿™ä¸ªç•™å¾…ä»¥åå†æ¥è§£å†³å§â€¦â€¦ï¼‰</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨ä½¿ç”¨rabbitmq java clientæ—¶ï¼Œæœ‰å°ä¼™ä¼´åœ¨macä¸Šå†™äº†ä¸€æ®µä»£ç ï¼Œå‘ç°å½“åˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°rabbitmq-serveræ—¶å°±ä¼šæŠ¥é”™&lt;code&gt;bad file descriptor&lt;/code&gt;ï¼Œè™½ç„¶åœ¨linuxæœåŠ¡å™¨ä¸Šæ²¡æœ‰å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸ºäº†å®‰å…¨ï¼Œè¿˜æ˜¯èŠ±äº†ç‚¹æ—¶é—´è¿›è¡Œè°ƒæŸ¥ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>hostnameç›¸å…³</title>
    <link href="https://xhao.io/2016/09/hostname/"/>
    <id>https://xhao.io/2016/09/hostname/</id>
    <published>2016-09-10T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æœ‰<a href="/2016/04/host-ip">è®¨è®º</a>hostnameåœ¨jdkä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œè¿™å›æƒ³è¯´çš„æ˜¯ï¼Œåœ¨linuxæœºå™¨ä¸Šï¼Œå…³äºhostnameç›¸å…³çš„ä¸€äº›tipsï¼Œéƒ½æ˜¯å¾ˆç®€å•çš„å¸¸è¯†ï¼Œä½†äº†è§£å®ƒä»¬æœ‰æ—¶å€™ä¼šç»™æˆ‘ä»¬æŸ¥é—®é¢˜å¸¦æ¥å¸®åŠ©ã€‚<br><a id="more"></a></p><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p>nslookupã€digã€hostéƒ½è¢«ç”¨æ¥æŸ¥è¯¢åŸŸåã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯è¿™3ä¸ªå·¥å…·éƒ½æ˜¯å‘DNSæœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„ï¼Œä¹Ÿå°±æ˜¯ä¼šå¿½ç•¥<code>/etc/hosts</code>ä¸‹çš„å†…å®¹ã€‚é‚£ä¹ˆå¦‚æœæƒ³æ›´é€šç”¨ï¼Œå¯ä»¥é€‰æ‹©<code>getent</code>è¿™ä¸ªå‘½ä»¤ï¼ˆè²Œä¼¼æ˜¯linuxä¸‹æœ‰æ•ˆï¼Œosxå¯èƒ½æ¢äº†å‘½ä»¤ï¼‰</p><h3 id="etc-hosts"><a href="#etc-hosts" class="headerlink" title="/etc/hosts"></a>/etc/hosts</h3><p>åˆšåˆšæˆ‘ä»¬æåˆ°çš„hostsï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥è®°å½•ipå’ŒåŸŸåçš„æ˜ å°„å…³ç³»çš„æ–‡ä»¶ï¼Œlinuxç³»ç»Ÿæœ‰æ—¶å€™ä¼šåœ¨å‘DNSå‘å‡ºåŸŸåè§£æè¯·æ±‚ä¹‹å‰å…ˆæŸ¥è¯¢è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœèƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•åˆ™ç›´æ¥ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Do not remove the following line, or various programs</span></span><br><span class="line"><span class="comment"># that require network functionality will fail.</span></span><br><span class="line"><span class="comment"># ipv4å›ç¯</span></span><br><span class="line">127.0.0.1       localhost.localdomain  localhost</span><br><span class="line"><span class="comment"># ipv6å›ç¯</span></span><br><span class="line">::1             localhost6.localdomain6 localhost6</span><br></pre></td></tr></table></figure><p>è¯´æœ‰æ—¶å€™ï¼Œæ˜¯å› ä¸ºlinuxå…ˆæŸ¥è¯¢dnsè¿˜æ˜¯fileä¹Ÿæ˜¯å¯ä»¥é…ç½®çš„ã€‚è¿™å°±æ¶‰åŠåˆ°åé¢çš„å‡ ä¸ªæ–‡ä»¶</p><h3 id="é¦–å…ˆæ˜¯-etc-host-conf"><a href="#é¦–å…ˆæ˜¯-etc-host-conf" class="headerlink" title="é¦–å…ˆæ˜¯/etc/host.conf"></a>é¦–å…ˆæ˜¯/etc/host.conf</h3><p>è€ä¸€ç‚¹çš„linuxç³»ç»Ÿå°±æ˜¯é€šè¿‡è¿™ä¸ªé…ç½®æ–‡ä»¶å†³å®šæŸ¥è¯¢åŸŸåçš„é¡ºåº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/host.conf</span></span><br><span class="line"><span class="comment"># We have named running, but no NIS (yet)</span></span><br><span class="line">order   <span class="built_in">bind</span>,hosts <span class="comment"># bind -&gt; dns</span></span><br><span class="line"><span class="comment"># Allow multiple addrs</span></span><br><span class="line">multi   on</span><br><span class="line"><span class="comment"># Guard against spoof attempts</span></span><br><span class="line">nospoof on</span><br><span class="line"><span class="comment"># Trim local domain (not really necessary).</span></span><br><span class="line">trim    vbrew.com.</span><br></pre></td></tr></table></figure><p>è¯¥æ–‡ä»¶é€šå¸¸ä¼šè¢«ä¸€äº›ç³»ç»Ÿå‚æ•°è¦†ç›–ï¼Œæ¯”å¦‚ä»¥<code>RESOLV_</code>å¼€å¤´çš„ä¸€äº›å‚æ•°</p><h3 id="nsswitch-conf"><a href="#nsswitch-conf" class="headerlink" title="nsswitch.conf"></a>nsswitch.conf</h3><p>åæ¥ï¼ŒGNU standard library 2.xæä¾›äº†å–ä»£host.confæœºåˆ¶çš„libï¼Œé…ç½®æ–‡ä»¶å°±æ˜¯nsswitch.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nsswitch.conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example configuration of GNU Name Service Switch functionality.</span></span><br><span class="line"><span class="comment"># Information about this file is available in the `libc6-doc' package.</span></span><br><span class="line"></span><br><span class="line">hosts:          dns files</span><br><span class="line">networks:       files</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­è¡¨æ˜ï¼šthe system to look up hosts first in the Domain Name System, and then /etc/hosts file, if that canâ€™t find them. Network name lookups would be attempted using only the /etc/networks file</p><p>æœ€åè¦æåˆ°çš„æ˜¯resolv.conf</p><h3 id="resolv-conf"><a href="#resolv-conf" class="headerlink" title="resolv.conf"></a>resolv.conf</h3><p>å¾ˆç®€å•ï¼Œè¿™ä¸ªæ–‡ä»¶é…ç½®äº†dns serverå¯¹åº”çš„ip</p><p>è‡³æ­¤ï¼Œdnsç›¸å…³çš„æµç¨‹å·®ä¸å¤šå°±å®Œäº†ï¼Œ<b><em>æ›´å¤šçš„å†…å®¹å¯ä»¥å‚è€ƒlinuxç›¸å…³<a href="http://www.oreilly.com/openbook/linag2/book/ch06.html" target="_blank" rel="noopener">ä¹¦ç±</a></em></b></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰æœ‰&lt;a href=&quot;/2016/04/host-ip&quot;&gt;è®¨è®º&lt;/a&gt;hostnameåœ¨jdkä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œè¿™å›æƒ³è¯´çš„æ˜¯ï¼Œåœ¨linuxæœºå™¨ä¸Šï¼Œå…³äºhostnameç›¸å…³çš„ä¸€äº›tipsï¼Œéƒ½æ˜¯å¾ˆç®€å•çš„å¸¸è¯†ï¼Œä½†äº†è§£å®ƒä»¬æœ‰æ—¶å€™ä¼šç»™æˆ‘ä»¬æŸ¥é—®é¢˜å¸¦æ¥å¸®åŠ©ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="linux" scheme="https://xhao.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>802.11n-wifiä¿¡é“</title>
    <link href="https://xhao.io/2016/06/802-11/"/>
    <id>https://xhao.io/2016/06/802-11/</id>
    <published>2016-06-17T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«ä¸‹åˆæƒ³ç©xboxï¼Œç»“æœé‡åˆ°äº†å›§äº‹ï¼Œæ— è®ºå¦‚ä½•éƒ½è¿ä¸ä¸Šè‡ªå®¶çš„wifiâ€¦â€¦<br><a id="more"></a><br>æ‰€è°“çš„è¿ä¸ä¸Šï¼Œé¦–å…ˆæ˜¯æœºå™¨æ ¹æœ¬çœ‹ä¸è§wifiä¿¡å·ã€‚ä»¥å‰ä»æ²¡é‡åˆ°è¿‡ç±»ä¼¼é—®é¢˜ï¼Œæˆ‘ä»¥ä¸ºæ˜¯xboxæ²¡æœ‰æ”¶åˆ°è·¯ç”±å™¨çš„ssidå¹¿æ’­ï¼Œé€šè¿‡è¾“å…¥ssidå’Œpasswordçš„æ–¹å¼ï¼Œè¿˜æ˜¯ä¸è¡Œã€‚æˆ‘æ„Ÿè§‰åº”è¯¥æ˜¯æ— çº¿è·¯ç”±å™¨è®¾ç½®å‡ºäº†é—®é¢˜ã€‚</p><p>ç™»é™†tplinkä¹‹åï¼Œæˆ‘çœ‹è§é€‰æ‹©çš„ä¿¡é“å›ºå®šä¸ºäº†13ï¼Œæ¢æˆè‡ªåŠ¨ä¹‹åï¼Œä¸€åˆ‡OKã€‚éš¾é“æ˜¯xboxä¸æ”¯æŒ802.11nçš„13ä¿¡é“å—ï¼Ÿ</p><p>å¸¦ç€ç–‘é—®Googleäº†ä¸€ä¸‹ï¼Œæˆ‘æ“¦â€¦åŸæ¥å¯ç”¨çš„802.11nçš„ä¿¡é“åˆ’åˆ†ï¼Œå…¨ä¸–ç•Œä¸æ˜¯ç»Ÿä¸€çš„ï¼Œå¤©æœå¯ä»¥ä½¿ç”¨12/13ï¼Œä½†åŒ—ç¾å´åªèƒ½1-11ï¼Œè€Œæˆ‘ä¹°çš„xboxæ°å¥½æ˜¯ç¾ç‰ˆã€‚</p><p>è¿™å›è¿˜å‘ç°äº†ä¸€ä¸ªä¸é”™çš„å‘½ä»¤ï¼Œå¯ä»¥æ£€æŸ¥å‘¨å›´çš„ä¿¡é“ä½¿ç”¨æƒ…å†µï¼Œåœ¨macä¸Šæµ‹è¯•æœ‰æ•ˆ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/System/</span>Library<span class="regexp">/PrivateFrameworks/</span>Apple80211.framework<span class="regexp">/Versions/</span>Current<span class="regexp">/Resources/</span>airport -s</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‘¨æœ«ä¸‹åˆæƒ³ç©xboxï¼Œç»“æœé‡åˆ°äº†å›§äº‹ï¼Œæ— è®ºå¦‚ä½•éƒ½è¿ä¸ä¸Šè‡ªå®¶çš„wifiâ€¦â€¦&lt;br&gt;
    
    </summary>
    
    
      <category term="linux" scheme="https://xhao.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>javaä¸­çš„getHostname</title>
    <link href="https://xhao.io/2016/04/host-ip/"/>
    <id>https://xhao.io/2016/04/host-ip/</id>
    <published>2016-04-15T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨linuxæœåŠ¡å™¨ä¸Šï¼Œjavaç¨‹åºæœ‰æ—¶ä¼šé‡åˆ°<code>unknown host name</code>çš„é—®é¢˜ã€‚é€šè¿‡è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘å‘ç°ææ¸…æ¥šjdkè·å–ipå’Œhostnameçš„æ–¹å¼ä»¥åŠlinuxæœºå™¨çš„çœŸå®ipã€hostnameæ˜¯å…³é”®ã€‚</p><p>linuxä¸Šæœ‰å¾ˆå¤šå¸¸ç”¨å‘½ä»¤ä¼šæ¶‰åŠï¼Œè¯¸å¦‚ï¼šhostnamectlã€nslookupã€digã€ifconfigâ€¦â€¦ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹jdkå¦‚ä½•è·å–hostnameçš„<br><a id="more"></a></p><h3 id="é€šè¿‡InetAddress-getLocalHostæ¥è·å¾—Address"><a href="#é€šè¿‡InetAddress-getLocalHostæ¥è·å¾—Address" class="headerlink" title="é€šè¿‡InetAddress.getLocalHostæ¥è·å¾—Address"></a>é€šè¿‡<code>InetAddress.getLocalHost</code>æ¥è·å¾—Address</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Returns the<span class="built_in"> address </span>of the local host. This is achieved by retrieving the name of the host <span class="keyword">from</span> the system, then resolving that name into an InetAddress.</span><br><span class="line"></span><br><span class="line">Note: The resolved<span class="built_in"> address </span>may be cached <span class="keyword">for</span> a short period of time.</span><br></pre></td></tr></table></figure><p>å®ƒçš„å®ç°åˆ†3ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>å…ˆæ˜¯<code>impl.getLocalHostName()</code>å–å¾—hostnameã€‚è¿™æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œåœ¨linuxå†…æ ¸ä¸Šæ˜¯é€šè¿‡è°ƒç”¨å†…æ ¸å‡½æ•°<code>gethostname</code>å®Œæˆã€‚è€Œhostnameæ˜¯å’Œä¸‹é¢æœ‰å…³çš„</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[hao.xie@hao-xie-vm ~]$ hostname <span class="comment">#hostnameè¿”å›å½“å‰å€¼</span></span><br><span class="line">hao-xie-vm</span><br><span class="line">[hao.xie@vhao-xie-vm ~]$ more /proc/sys/kernel/hostname <span class="comment">#å½“å‰å€¼ï¼Œæˆ–è€…è¯´ä¿®æ”¹åç”Ÿæ•ˆ</span></span><br><span class="line">hao-xie-vm</span><br><span class="line">[hao.xie@hao-xie-vm ~]$ more /etc/sysconfig/network <span class="comment">#è¿™ä¸ªæ–‡ä»¶éœ€è¦é‡ç‚¹è¯´ä¸‹ï¼Œrebootçš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè¯»å–å®ƒï¼Œå¹¶ç»™hostnameèµ‹å€¼ï¼Œä½†æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹å®ƒä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œéœ€è¦é…åˆhostnameå‘½ä»¤ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="comment"># Created by anaconda</span></span><br></pre></td></tr></table></figure><ol start="2"><li>æ¥ç€ï¼Œjdkåˆå»æŸ¥äº†ç¼“å­˜çš„localhostä¿¡æ¯ï¼ˆ5sæœ‰æ•ˆçš„cacheï¼‰ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜æ‰å¼€å§‹å–address</li><li>å–Addressçš„æ–¹å¼æ˜¯<code>InetAddress.getAddressesFromNameService</code>ï¼ŒæŒ‰å­—é¢æ„æ€å°±æ˜¯å‘dnsæ¥åå‘æŸ¥è¯¢è‡ªå·±</li></ol><h3 id="InetAddress-getLocalHost-getHostNameè·å–hostname"><a href="#InetAddress-getLocalHost-getHostNameè·å–hostname" class="headerlink" title="InetAddress.getLocalHost.getHostNameè·å–hostname"></a><code>InetAddress.getLocalHost.getHostName</code>è·å–hostname</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Gets the host name <span class="keyword">for</span> this<span class="built_in"> IP </span>address.</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> this InetAddress was created with a host name, this host name will be remembered <span class="keyword">and</span> returned; otherwise, a reverse name lookup will be performed <span class="keyword">and</span> the result will be returned based on the<span class="built_in"> system </span>configured name lookup service. <span class="keyword">If</span> a lookup of the name<span class="built_in"> service </span>is required, call getCanonicalHostName.</span><br></pre></td></tr></table></figure><p>æè¿°å¾ˆæ¸…æ¥šï¼Œå°±æ˜¯å†é€šè¿‡ipåå‘æ¥æŸ¥hostnameï¼ŒåŸå› å’Œä¸Šé¢ä¸€æ ·ã€‚</p><h3 id="æˆ‘é‡åˆ°è¿‡çš„é—®é¢˜"><a href="#æˆ‘é‡åˆ°è¿‡çš„é—®é¢˜" class="headerlink" title="æˆ‘é‡åˆ°è¿‡çš„é—®é¢˜"></a>æˆ‘é‡åˆ°è¿‡çš„é—®é¢˜</h3><p>æˆ‘ä¹‹å‰åœ¨æœåŠ¡å™¨ä¸Šå‘ç°hostnameè¿”å›çš„æ˜¯<code>A</code>ï¼Œä½†æ˜¯<code>InetAddress.getLocalHost.getHostName</code>è¿”å›å¼‚å¸¸<code>unknown host name : host name B</code>ã€‚åŸå› å°±æ˜¯2æ¬¡dnsçš„ç»“æœå·®å¼‚é€ æˆ<code>hostname A -&gt; ip1ï¼›ip1 -&gt; B</code>è¿™ç§å°´å°¬çš„äº‹æƒ…ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦nslookupå·¥å…·æ¥æ£€æŸ¥ï¼Œæœ€ååœ¨dnsæœåŠ¡å™¨ä¸Šè¿›è¡Œä¿®æ”¹äº†ã€‚</p><h3 id="å¦‚ä½•åœ¨javaä»£ç ä¸­è·å–æœ¬æœºipï¼ˆé127-0-0-1ï¼‰"><a href="#å¦‚ä½•åœ¨javaä»£ç ä¸­è·å–æœ¬æœºipï¼ˆé127-0-0-1ï¼‰" class="headerlink" title="å¦‚ä½•åœ¨javaä»£ç ä¸­è·å–æœ¬æœºipï¼ˆé127.0.0.1ï¼‰"></a>å¦‚ä½•åœ¨javaä»£ç ä¸­è·å–æœ¬æœºipï¼ˆé127.0.0.1ï¼‰</h3><p>æœ‰ä¸€äº›æ¨èçš„æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡éå†ç½‘å¡æ¥é€‰æ‹©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InetAddress <span class="title">getLocalHostLANAddress</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException, SocketException </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">InetAddress candidateAddress = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">// Iterate all NICs (network interface cards)...</span></span><br><span class="line">Enumeration&lt;NetworkInterface&gt; ifaces = NetworkInterface.getNetworkInterfaces();</span><br><span class="line"><span class="keyword">while</span> (ifaces.hasMoreElements()) &#123;</span><br><span class="line">NetworkInterface iface = (NetworkInterface) ifaces.nextElement();</span><br><span class="line"><span class="keyword">for</span> (<span class="meta">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">Enumeration inetAddrs = iface.getInetAddresses(); inetAddrs.hasMoreElements();) &#123;</span><br><span class="line">InetAddress inetAddr = (InetAddress) inetAddrs.nextElement();</span><br><span class="line"><span class="keyword">if</span> (!inetAddr.isLoopbackAddress()) &#123;</span><br><span class="line"><span class="keyword">if</span> (inetAddr.isSiteLocalAddress()) &#123;</span><br><span class="line"><span class="keyword">return</span> inetAddr;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (candidateAddress == <span class="keyword">null</span>) &#123;</span><br><span class="line">candidateAddress = inetAddr;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (candidateAddress != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> candidateAddress;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// At this point, we did not find a non-loopback address.</span></span><br><span class="line"><span class="comment">// Fall back to returning whatever InetAddress.getLocalHost()</span></span><br><span class="line"><span class="comment">// returns...</span></span><br><span class="line">InetAddress jdkSuppliedAddress = InetAddress.getLocalHost();</span><br><span class="line"><span class="keyword">if</span> (jdkSuppliedAddress == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UnknownHostException(<span class="string">"The JDK InetAddress.getLocalHost() method unexpectedly returned null."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> jdkSuppliedAddress;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">UnknownHostException unknownHostException = <span class="keyword">new</span> UnknownHostException(</span><br><span class="line"><span class="string">"Failed to determine LAN address: "</span> + e);</span><br><span class="line">unknownHostException.initCause(e);</span><br><span class="line"><span class="keyword">throw</span> unknownHostException;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…é€šè¿‡å»ºç«‹tcp socketæ¥åå‘è·å–æœ¬æœºip</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">trickyIp</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="keyword">final</span> Socket socket = <span class="keyword">new</span> Socket()) &#123;</span><br><span class="line">        socket.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"www.google.com"</span>, <span class="number">80</span>));</span><br><span class="line">        <span class="keyword">return</span> socket.getLocalAddress().getHostAddress();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨javaä»£ç ä¸­è·å¾—hostname"><a href="#åœ¨javaä»£ç ä¸­è·å¾—hostname" class="headerlink" title="åœ¨javaä»£ç ä¸­è·å¾—hostname"></a>åœ¨javaä»£ç ä¸­è·å¾—<a href="/2016/09/hostname">hostname</a></h3><p><code>hostname(1)</code>åº”è¯¥æ˜¯å”¯ä¸€çš„é€‰æ‹©ï¼ˆé”™è¯¯çš„ç½‘ç»œç¯å¢ƒé…ç½®å¯¼è‡´ä¸Šé¢çš„ä¾‹å­ï¼‰ï¼Œæ‰€ä»¥åœ¨javaä»£ç ä¸­å°±å˜æˆäº†å¦‚ä½•è°ƒç”¨ç³»ç»Ÿè°ƒç”¨äº†ï¼Œé€šè¿‡jniæˆ–è€…jnaéƒ½æ˜¯å¯ä»¥çš„ï¼Œæ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡jna</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">CLibrary</span> <span class="keyword">extends</span> <span class="title">Library</span> </span>&#123;</span><br><span class="line">    CLibrary INSTANCE = (CLibrary) Native.loadLibrary(<span class="string">"c"</span>, CLibrary<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">gethostname</span><span class="params">(<span class="keyword">byte</span>[] hostname, <span class="keyword">int</span> bufferSize)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">hostname</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Platform.isWindows()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Kernel32Util.getComputerName();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] hostnameBuffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">255</span>];</span><br><span class="line">            <span class="keyword">int</span> result = CLibrary.INSTANCE.gethostname(hostnameBuffer, hostnameBuffer.length);</span><br><span class="line">            <span class="keyword">if</span> (result != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> InetAddress.getLocalHost().getHostName();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Native.toString(hostnameBuffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨linuxæœåŠ¡å™¨ä¸Šï¼Œjavaç¨‹åºæœ‰æ—¶ä¼šé‡åˆ°&lt;code&gt;unknown host name&lt;/code&gt;çš„é—®é¢˜ã€‚é€šè¿‡è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘å‘ç°ææ¸…æ¥šjdkè·å–ipå’Œhostnameçš„æ–¹å¼ä»¥åŠlinuxæœºå™¨çš„çœŸå®ipã€hostnameæ˜¯å…³é”®ã€‚&lt;/p&gt;
&lt;p&gt;linuxä¸Šæœ‰å¾ˆå¤šå¸¸ç”¨å‘½ä»¤ä¼šæ¶‰åŠï¼Œè¯¸å¦‚ï¼šhostnamectlã€nslookupã€digã€ifconfigâ€¦â€¦ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹jdkå¦‚ä½•è·å–hostnameçš„&lt;br&gt;
    
    </summary>
    
    
      <category term="linux" scheme="https://xhao.io/tags/linux/"/>
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>mavenæ’ä»¶å¼€å‘</title>
    <link href="https://xhao.io/2016/02/maven-plugin/"/>
    <id>https://xhao.io/2016/02/maven-plugin/</id>
    <published>2016-02-15T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒ<a href="http://maven.apache.org/guides/plugin/guide-java-plugin-development.html" target="_blank" rel="noopener">mavenå®˜æ–¹æ–‡æ¡£</a><br><a id="more"></a><br>ä»¥æˆ‘ä¹‹å‰å†™mavenæ’ä»¶çš„ç»å†ï¼Œç®€å•èŠèŠè¿™è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œæ³¨æ„ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mojo</span>(name = <span class="string">"genThrift"</span>, requiresDependencyResolution = ResolutionScope.COMPILE_PLUS_RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThriftGenPlugin</span> <span class="keyword">extends</span> <span class="title">AbstractMojo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Parameter</span>(defaultValue = <span class="string">"$&#123;project&#125;"</span>, readonly = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> MavenProject project;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter</span>(property = <span class="string">"genThrift.outputDirectory"</span>, defaultValue = <span class="string">"./"</span>)</span><br><span class="line">    <span class="keyword">private</span> String outputDirectory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter</span>(property = <span class="string">"genThrift.services"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; services;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadProjectClass</span><span class="params">()</span> <span class="keyword">throws</span> MojoExecutionException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URLClassLoader sysloader = (URLClassLoader) ClassLoader.getSystemClassLoader();</span><br><span class="line">            Class&lt;?&gt; sysclass = URLClassLoader<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">            Method method = sysclass.getDeclaredMethod(<span class="string">"addURL"</span>, <span class="keyword">new</span> Class[] &#123; URL<span class="class">.<span class="keyword">class</span> &#125;)</span>;</span><br><span class="line">            method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            List&lt;String&gt; classpathElements = project.getCompileClasspathElements();</span><br><span class="line">            getLog().debug(<span class="string">"----------start laod projct classes----------"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; classpathElements.size(); ++i) &#123;</span><br><span class="line">                getLog().debug(classpathElements.get(i));</span><br><span class="line">                method.invoke(sysloader, <span class="keyword">new</span> File(classpathElements.get(i)).toURI().toURL());</span><br><span class="line">            &#125;</span><br><span class="line">            getLog().debug(<span class="string">"----------end laod projct classes----------"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MojoExecutionException(<span class="string">"Couldn't create a classloader."</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> MojoExecutionException, MojoFailureException </span>&#123;</span><br><span class="line">        loadProjectClass();</span><br><span class="line"><span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¼€å‘æ’ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨äº†<a href="http://maven.apache.org/plugin-tools/maven-plugin-plugin/examples/using-annotations.html" target="_blank" rel="noopener">annotation</a>ï¼Œå¹¶æ²¡æœ‰ç”¨javadocçš„æ–¹å¼ã€‚æˆ‘çš„ä¸€äº›é…ç½®åŒ…æ‹¬ï¼š</p><ul><li>@goalï¼šè¿™ä¸ªæ˜¯å¿…é¡»çš„ï¼Œæ ¹æ®mavençš„æœºåˆ¶life cycleæ˜¯ç»‘å®šäº†å¤šä¸ªgoalæ‰èƒ½èµ·ä½œç”¨ï¼›è€Œä¸”goalæœ¬èº«å¯ä»¥ç‹¬ç«‹life cycleç›´æ¥è¿è¡Œã€‚</li><li>@phaseï¼šä»goalçš„æè¿°çœ‹å‡ºï¼Œå®ƒä¸æ˜¯å¿…é¡»çš„ã€‚å› ä¸ºæˆ‘çš„æ’ä»¶æœ¬èº«æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŠŸèƒ½ï¼Œä¸éœ€è¦å’Œcompileæˆ–è€…packageç­‰phaseæ¥ç»‘å®šã€‚å¦‚æœç”¨æˆ·éœ€è¦ï¼Œå°±éœ€è¦è‡ªå·±å»pomä¸­é…ç½®äº†ã€‚æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘å¿½ç•¥äº†ã€‚</li><li>@requiresDependencyResolutionï¼šè¿™ä¸ªæ˜¯ç”±æ’ä»¶çš„ä½œç”¨å†³å®šçš„ï¼Œä¸æ˜¯å¿…é¡»çš„é€‰é¡¹ã€‚æˆ‘çš„æ’ä»¶åœ¨è¿è¡ŒæœŸï¼Œéœ€è¦åŠ è½½å½“å‰projectçš„ä»£ç åŠå…¶ä¾èµ–ã€‚</li><li>@Parameterï¼šå°±æ˜¯å¯ç”¨çš„å‚æ•°ã€‚æ³¨æ„è¿™é‡Œå¯ä»¥ä½¿ç”¨ä¸€äº›maven defaultçš„å€¼ï¼Œæ¯”å¦‚${project}ã€‚</li></ul><p>å…¶ä»–çš„é…ç½®ï¼Œå°±å‚è€ƒmavenå®˜æ–¹æä¾›çš„<a href="https://maven.apache.org/developers/mojo-api-specification.html#The_Descriptor_and_Annotations" target="_blank" rel="noopener">Annotationsçš„è§£é‡Š</a>å§ã€‚</p><p>å› ä¸ºè¿™ä¸ªæ’ä»¶æ˜¯ç”¨æ¥å°†javaä»£ç è½¬åŒ–ä¸ºthriftçš„ï¼Œæ‰€ä»¥æ’ä»¶æœ¬èº«éœ€è¦è¯»å–å½“å‰è½¬åŒ–projectçš„ä»£ç ã€‚åŸºäºmavençš„<a href="http://maven.apache.org/guides/mini/guide-maven-classloading.html" target="_blank" rel="noopener">classloaderæœºåˆ¶</a>ï¼Œclassloaderä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚æ¢å¥è¯è¯´ï¼Œæ’ä»¶è¿è¡ŒæœŸçš„classloaderæ˜¯ä¸èƒ½å¤©ç„¶ä½¿ç”¨projectä¸­ä»£ç çš„ï¼Œæ‰€ä»¥éœ€è¦ä¸€äº›æ‰‹æ®µäº†ã€‚ç›®å‰æˆ‘æƒ³åˆ°çš„æ˜¯åˆ©ç”¨åå°„æœºåˆ¶ã€‚é¦–å…ˆï¼Œæˆ‘åˆ©ç”¨MavenProjectè¿™ä¸ªå¯¹è±¡ï¼Œè·å–å®ƒçš„classpathï¼ˆå…¶å®å°±æ˜¯æœ¬åœ°mavenä»“åº“ï¼ŒjaråŒ…çš„åœ°å€ï¼‰ï¼Œç„¶åé€šè¿‡<code>URLClassLoader</code>çš„<code>addURL</code>è¿™ä¸ªæ–¹æ³•ï¼Œå°†jaråŒ…éƒ½æ·»åŠ åˆ°å½“å‰çš„<code>ClassLoader.getSystemClassLoader()</code>ä¸­æ¥ã€‚å®Œæˆè¿™2æ­¥ï¼Œå°±èƒ½è¾¾åˆ°è¯»å–projectçš„ç›®çš„ã€‚</p><p><code>execute</code>æ–¹æ³•å°±æ˜¯å…¥å£ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŠ›å‡º2ç§exceptionï¼Œ<code>MojoExecutionException</code>å’Œ<code>MojoFailureException</code>ï¼Œå®ƒä»¬çš„å«ä¹‰ä¹Ÿä¸å®Œå…¨ç›¸åŒï¼Œå‰è€…æ˜¯unexpectedçš„å¼‚å¸¸ï¼Œåè€…æ˜¯æ‰§è¡Œä¸­çš„å¼‚å¸¸ï¼ˆåŒ…æ‹¬é…ç½®é”™è¯¯ç­‰ç­‰ï¼‰ã€‚æ­¤å¤–ï¼Œæ’ä»¶è¿˜å¯ä»¥æœ‰logï¼Œä½¿ç”¨æ–¹æ³•æ˜¯<code>getLog().debug(&quot;xxx&quot;)</code>ï¼›mavenä½¿ç”¨äº†è‡ªå·±çš„iocæ¡†æ¶ï¼Œå…·ä½“çš„é…ç½®éƒ½åœ¨${MAVEN_HOME}/confä¸‹é¢èƒ½çœ‹åˆ°ï¼Œlogç”¨çš„æ˜¯slf4jã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‚è€ƒ&lt;a href=&quot;http://maven.apache.org/guides/plugin/guide-java-plugin-development.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;mavenå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>javaä¸­å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ï¼ˆäºŒï¼‰â€”â€”File</title>
    <link href="https://xhao.io/2016/01/java-file/"/>
    <id>https://xhao.io/2016/01/java-file/</id>
    <published>2016-01-01T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>è¿‘æœŸå› ä¸ºè¯¯ç”¨java System Propertyï¼Œå¯¼è‡´äº†ä¸€ä¸ªfileç›¸å…³çš„bugã€‚èŠ±äº†ä¸€ç‚¹æ—¶é—´ç ”ç©¶ä¹‹åï¼Œç»ˆäºæ‰¾åˆ°äº†æ ¹æºâ€”â€”ä¸€åˆ‡éƒ½æ˜¯user.diræƒ¹çš„é¬¼ã€‚<br><a id="more"></a></p><h2 id="java-io-File"><a href="#java-io-File" class="headerlink" title="java.io.File"></a>java.io.File</h2><p>è¿™ä¸ªç±»åº”è¯¥æ˜¯ä»jdk1.xç‰ˆæœ¬å°±å­˜åœ¨äº†ï¼Œæ˜¯jdkæœ€æ—©çš„æ¨¡å—ä¹‹ä¸€ã€‚æˆ‘ä»¬éƒ½çŸ¥é“çš„æ˜¯<code>new File(&quot;path&quot;)</code>ï¼Œpathå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹è·¯å¾„æ˜¯ä»¥working dirä¸ºèµ·ç‚¹çš„ï¼Œæˆ–è€…æ›´ç®€å•ä¸€ç‚¹å°±æ˜¯<code>System.getProperty(&quot;user.dir&quot;)</code>ã€‚è¿™æ˜¯æœ€åŸºæœ¬çš„ç†è§£ï¼Œæ¯‹åº¸ç½®ç–‘çš„ã€‚ä½†æ˜¯å‘¢ï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†user.dirå‘¢ï¼Ÿ</p><p>ä¸ºæ­¤ï¼Œæˆ‘å†™äº†ä¸€ä¸ªæµ‹è¯•ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åå°„è·å–fileçš„ä¸€äº›å±æ€§</span></span><br><span class="line">Field field = File.class.getDeclaredField("fs");</span><br><span class="line">field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object fs = field.get(<span class="keyword">new</span> File(<span class="string">"."</span>).getParentFile());</span><br><span class="line">Method method = fs.getClass().getDeclaredMethod(<span class="string">"getBooleanAttributes"</span>, File<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶å¤¹</span></span><br><span class="line">System.setProperty(<span class="string">"user.dir"</span>, <span class="string">"/Users/xiehao/Documents/workspace/tmp/tmp/11111111111111111"</span>);</span><br><span class="line">System.out.println(<span class="string">"user dir : "</span> + System.getProperty(<span class="string">"user.dir"</span>));</span><br><span class="line">System.out.println(<span class="string">"file(.) path "</span> + <span class="keyword">new</span> File(<span class="string">"."</span>).getAbsolutePath());</span><br><span class="line"></span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">"Now make dir"</span>);</span><br><span class="line">System.out.println(<span class="string">"----------------------------------"</span>);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// ä¸€ç§ä½¿ç”¨mkdir</span></span><br><span class="line"><span class="comment">// new File("a").mkdir();</span></span><br><span class="line"><span class="comment">//File dir = new File("a/b");</span></span><br><span class="line"><span class="comment">//dir.mkdir();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ç§ä½¿ç”¨mkdirs</span></span><br><span class="line">File dir = <span class="keyword">new</span> File(<span class="string">"a/b"</span>);</span><br><span class="line">dir.mkdirs();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"file unix system status : "</span> + method.invoke(fs, dir));</span><br><span class="line">System.out.println(<span class="string">"dir is exist after creating : "</span> + dir.exists() + <span class="string">", is Directory : "</span> + dir.isDirectory());</span><br><span class="line"></span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">"Now make file"</span>);</span><br><span class="line">System.out.println(<span class="string">"----------------------------------"</span>);</span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">"a/b/c.txt"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"file absolute path : "</span> + file.getAbsolutePath());</span><br><span class="line">System.out.println(<span class="string">"file parent unix system status : "</span> + method.invoke(fs, file.getParentFile()));</span><br><span class="line">System.out.println(<span class="string">"file parent exists : "</span> + file.getParentFile().exists());</span><br><span class="line"></span><br><span class="line">file.createNewFile();</span><br><span class="line">System.out.println(<span class="string">"file unix system status : "</span> + method.invoke(fs, file));</span><br><span class="line">System.out.println(<span class="string">"file exists : "</span> + file.exists());</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"file exists (new file with abs path) : "</span> + <span class="keyword">new</span> File(file.getAbsolutePath()).exists());</span><br><span class="line">System.out.println(<span class="string">"file exists (file getAbsoluteFile) : "</span> + file.getAbsoluteFile().exists());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>jdkæä¾›äº†2ä¸ªåˆ›å»ºæ–‡ä»¶å¤¹çš„æ–¹æ³•ï¼š<code>mkdir</code>å’Œ<code>mkdirs</code>ï¼Œè¿è¡Œæ—¶ä¸åŒçš„é€‰æ‹©ä¼šå¯¼è‡´ä¸åŒçš„ç»“æœ</p><ul><li><p><code>mkdir</code></p><ul><li>æ–‡ä»¶å¤¹çš„ç›¸å¯¹ä½ç½®å’Œuser.diræ²¡æœ‰å…³ç³»ï¼Œåªå’Œjavaå¯åŠ¨çš„ä½ç½®ç›¸å…³ã€‚</li><li>ä½†æ˜¯<code>getAbsolutePath()</code>è¿”å›çš„å´æ˜¯<code>user.dir + relative_path</code>çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯æœ€å2è¡Œå¯èƒ½è¿”å›ç›¸åçš„ç»“æœã€‚</li></ul></li><li><p><code>mkdirs</code></p><ul><li>é€’å½’åœ°åˆ›å»ºæ–‡ä»¶å¤¹</li><li>å¦‚æœä½ çš„javaå¯åŠ¨ä½ç½®<code>CWD</code>ä¸æ˜¯user.dirï¼Œé‚£ä¹ˆå¯èƒ½<code>throw IOException</code></li></ul></li></ul><p>ç”±æ­¤ï¼Œæˆ‘å‘ç°äº†2ä¸ªä»¥å‰å¿½ç•¥çš„é—®é¢˜</p><ol><li><p>å¦‚æœSystem Property <code>user.dir</code>è¢«ä¿®æ”¹ï¼Œçœ‹èµ·æ¥ä½ç½®å˜äº†ï¼Œä½†æ˜¯çœŸæ­£åˆ›å»ºï¼ˆjavaçš„ioç›¸å½“äºåœ¨appå’Œosä¹‹å‰åŠ äº†ä¸€ä¸ªä¸­é—´å±‚ï¼‰æ–‡ä»¶çš„æ—¶å€™ï¼Œosä»ç„¶ä½¿ç”¨äº†javaåº”ç”¨çœŸæ­£å¯åŠ¨çš„å½“å‰ç›®å½•ã€‚è¿™ä¸ªé—®é¢˜åœ¨javaçš„bugåº“ä¸­æ‰¾åˆ°äº†<a href="http://bugs.java.com/view_bug.do?bug_id=4045688" target="_blank" rel="noopener">è¯´æ˜</a>ï¼ŒåŸæ¥system propertiesä¸­çš„<code>user.dir</code>æˆ–è€…è¯´å¯åŠ¨æ—¶ä¼ çš„<code>-Duser.dir</code>ä¸åº”è¯¥è¢«ä¿®æ”¹ï¼Œä»–ä»¬åº”è¯¥æ˜¯readonlyå±æ€§ï¼ˆè™½ç„¶jdkæ²¡æœ‰åšå¼ºåˆ¶çš„çº¦æŸï¼Œåªæ˜¯å£å¤´ä¸Šçš„è§„çº¦ï¼‰ã€‚è¿™æ˜¯å› ä¸ºjvmå¯åŠ¨æ—¶å€™ï¼Œå¯¹äºosæ¥è¯´å·²ç»è®°å½•äº†ä¸€ä¸ª<code>CWD</code>ï¼Œåé¢ç®€å•åœ°ä¿®æ”¹å®ƒï¼Œæ˜¯ä¸ä¼šå½±å“os kernelçš„ï¼Œå¹¶ä¸”ä¹Ÿä¸åº”è¯¥å½±å“ï¼ˆJNIå¯ä»¥ï¼Œä½†æ˜¯jdkå®˜æ–¹ä¹Ÿä¸å»ºè®®è¿™ä¹ˆåšï¼‰ã€‚</p></li><li><p>å¦ä¸€ä¸ªé—®é¢˜ï¼Œmkdirå’Œmkdirsä¸åŒã€‚ä»å­—é¢æ„æ€çœ‹ï¼Œmkdiråªèƒ½åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚æœçˆ¶ç›®å½•è¿˜ä¸å­˜åœ¨ï¼Œå°±ä¼šæœ‰<code>IOException</code>ï¼›mkdirsæ˜¯é€’å½’åœ°æŠŠçˆ¶ç›®å½•éƒ½åˆ›å»ºã€‚è¿˜æœ‰ä¸€ä¸ªå…³é”®ï¼Œmkdirsåœ¨åˆ›å»ºçˆ¶ç›®å½•æ—¶å€™ï¼Œç”Ÿæˆäº†ç»å¯¹è·¯å¾„(ç”¨åˆ°äº†æˆ‘ä»¬çš„user.dir)ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªç»å¯¹è·¯å¾„æ‰€ä»£è¡¨çš„fileå¯¹è±¡ä¼ ç»™äº†nativeï¼Œæ‰€ä»¥mkdirsä¼šæŒ‰ç…§æˆ‘ä»¬è®¾è®¡çš„user.diræ¥åˆ›å»ºæ–‡ä»¶å¤¹ã€‚</p></li></ol><p>è¿™é‡Œæœ‰ä¸ªå¤§å‘ï¼Œå°±æ˜¯ä½ ä»¥ä¸ºjavaæ˜¯æŒ‰ç…§ç›¸å¯¹è·¯å¾„(CWD)æ¥åˆ›å»ºçš„ï¼Œå¹¶ä¸”çˆ¶ç›®å½•æœ‰äº†ï¼Œå­æ–‡ä»¶åº”è¯¥ä¸€å®šèƒ½ç”Ÿæˆå§ï¼Ÿï¼Ÿæœ‰å¯èƒ½å¤±è´¥ï¼Œåªè¦ä½ user.dirå’ŒCWDä¸åŒï¼Œå¹¶ä¸”æŠ¥é”™ä¿¡æ¯å°±æ˜¯â€œä½ åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨â€ã€‚æˆ‘è§‰å¾—è¿™æ˜¯jdkåœ¨è®¾è®¡ä¸Šæœ‰ä¸è¶³ä¹‹å¤„ï¼Œå°±æ˜¯æ˜æ˜æˆ‘ç”Ÿæˆäº†æ–‡ä»¶å¤¹ï¼Œä¸ºä»€ä¹ˆè¿˜æç¤ºæ–‡ä»¶å¤¹ä¸å­˜åœ¨å‘¢ï¼Ÿ</p><p>åªèƒ½å¼ºè¡Œåœ†ä¸€ä¸‹è¿™ä¸ªè®¾è®¡ï¼š<code>new File(path)</code>ä¸­çš„ç›¸å¯¹è·¯å¾„æ˜¯pathï¼Œosè®¤ä¸ºçš„çˆ¶ç›®å½•æ˜¯CWD+pathï¼Œè¿™ä¸ªç›®å½•æœ‰å¯èƒ½ä¸å­˜åœ¨ï¼Œosä¼šæŠ›é”™åˆ°jdkå±‚ï¼ŒjdkçŸ¥é“æ˜¯ç”±äºçˆ¶ç›®å½•æ²¡æœ‰ï¼Œä½†æ˜¯ä»–ä¹Ÿä¸çŸ¥é“çˆ¶ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œè€Œæ˜¯ç”¨user.dir+pathã€‚è¿™2è€…ä¹‹é—´äº§ç”Ÿäº†è¯¯å·®ï¼Œä¼šå¼•å‘ä¸ä¸€è‡´æ€§ã€‚Ohï¼MyGodï¼æ‰€ä»¥è¿˜æ˜¯ä¸è¦ä¿®æ”¹user.dirå§</p><p>PS: æœ€åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œjvmå¯ä»¥ä¸»åŠ¨è§¦å‘äº§ç”Ÿå¦ä¸€ä¸ªjvmè¿›ç¨‹ï¼Œå³<code>Runtime.getRuntime().exec(String[] cmdarray, String[] envp, File dir)</code>è¿™é‡Œçš„dirå°±æ˜¯å­jvmæ‰€ä½¿ç”¨çš„CWDï¼Œå¦‚æœnullçš„è¯ï¼Œä»–ä¼šå°è¯•ç”¨å½“å‰jvmçš„CWDæ¥ä»£æ›¿ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿‘æœŸå› ä¸ºè¯¯ç”¨java System Propertyï¼Œå¯¼è‡´äº†ä¸€ä¸ªfileç›¸å…³çš„bugã€‚èŠ±äº†ä¸€ç‚¹æ—¶é—´ç ”ç©¶ä¹‹åï¼Œç»ˆäºæ‰¾åˆ°äº†æ ¹æºâ€”â€”ä¸€åˆ‡éƒ½æ˜¯user.diræƒ¹çš„é¬¼ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>jdkæä¾›çš„å·¥å…·ç±»</title>
    <link href="https://xhao.io/2015/09/java-performance/"/>
    <id>https://xhao.io/2015/09/java-performance/</id>
    <published>2015-09-04T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ€§èƒ½å¼‚å¸¸ï¼Œé€šè¿‡é‡å¯ç­‰ä¸´æ—¶æ–¹æ¡ˆå¯ä»¥æš‚æ—¶è®©ç¨‹åºç»§ç»­è·‘ä¸‹å»ï¼Œç›´åˆ°ä¸‹æ¬¡é—®é¢˜å†å‡ºç°ã€‚æƒ³è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œå¿…é¡»èƒ½å®šä½å®ƒçš„ä½ç½®ã€‚è€Œæ€§èƒ½ç›¸å…³çš„ä»£ç ï¼Œé€šå¸¸å¯èƒ½æ˜¯é”ç«äº‰ï¼Œçº¿ç¨‹æ± /è¿æ¥æ± ä¸è¿‡ï¼Œfull GCï¼Œè¿‡åº¦åƒcpuèµ„æºï¼Œæ­»é”ç­‰ï¼Œè¿™äº›é—®é¢˜é€šå¸¸å‘ç”Ÿåœ¨ç‰¹å®šç¯å¢ƒä¸­ï¼ˆæ¯”å¦‚æœ‰å¯¹èµ„æºçš„ç«äº‰ï¼‰ï¼Œåˆ†æä»£ç ä¸èƒ½å¿«é€Ÿå®šä½ã€‚è¿™æ—¶å°±éœ€è¦åˆ©ç”¨jdkæä¾›çš„æ€§èƒ½ç›‘æ§å·¥å…·ã€‚<br><a id="more"></a></p><h2 id="jps-Java-Virtual-Machine-Process-Status-Tool"><a href="#jps-Java-Virtual-Machine-Process-Status-Tool" class="headerlink" title="jps (Java Virtual Machine Process Status Tool)"></a>jps (Java Virtual Machine Process Status Tool)</h2><p>è¿™ä¸ªå‘½ä»¤å¾ˆç®€å•ï¼Œå¯ä»¥çœ‹åˆ°jvmä¸­è¿è¡Œçš„è¿›ç¨‹åŠç›¸å…³ä¿¡æ¯</p><ul><li>jps [options] [hostid]<br>hostidé»˜è®¤æ˜¯æœ¬æœºï¼Œä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹ä¸»æœºï¼Œå®Œæ•´çš„æ˜¯è¿™æ ·<code>[protocol:][[//]hostname][:port][/servername]</code></li></ul><p>å¯é€‰å‚æ•°ï¼š</p><ul><li>-q ä¸è¾“å‡ºç±»åã€Jaråå’Œä¼ å…¥mainæ–¹æ³•çš„å‚æ•°</li><li>-m è¾“å‡ºä¼ å…¥mainæ–¹æ³•çš„å‚æ•°</li><li>-l è¾“å‡ºmainç±»æˆ–Jarçš„å…¨é™å</li><li>-v è¾“å‡ºä¼ å…¥JVMçš„å‚æ•°</li></ul><h2 id="jstack-stack-trace"><a href="#jstack-stack-trace" class="headerlink" title="jstack (stack trace)"></a>jstack (stack trace)</h2><p>æŸ¥çœ‹å †æ ˆä¿¡æ¯<br>Usage:</p><ul><li>jstack [-l] &lt;pid&gt;</li><li>jstack -F [-m] [-l] &lt;pid&gt;</li><li>jstack [-m] [-l] &lt;executable&gt; &lt;core&gt;</li><li>jstack [-m] [-l] [server_id@]&lt;remote server IP or hostname&gt;</li></ul><p>Options:</p><ul><li>-F  to force a thread dump. Use when jstack &lt;pid&gt; does not respond (process is hung)</li><li>-m  to print both java and native frames (mixed mode)</li><li>-l  long listing. Prints additional information about locks</li><li>-h or -help to print this help message<br>jstack -l åœ¨å‘ç”Ÿæ­»é”æ—¶ï¼Œå¯ä»¥æ¥æŸ¥çœ‹é”çš„æŒæœ‰æƒ…å†µï¼›-m è¿˜ä¼šè¾“å‡ºNativeæ–¹æ³•ã€‚jstacké€šå¸¸ç”¨äºæ£€æŸ¥ç¨‹åºå¡åœ¨ä»€ä¹ˆåœ°æ–¹</li></ul><h2 id="jmap-memory-map"><a href="#jmap-memory-map" class="headerlink" title="jmap (memory map)"></a>jmap (memory map)</h2><p>æŸ¥çœ‹å†…å­˜ä½¿ç”¨<br>Usage:</p><ul><li>jmap [option] &lt;pid&gt;</li><li>jmap [option] &lt;executable &lt;core&gt;</li><li>jmap [option] [server_id@]&lt;remote server IP or hostname&gt;<br>Options:</li><li>-heap                to print java heap summary</li><li>-histo[:live]        to print histogram of java object heap; if the â€œliveâ€ suboption is specified, only count live objects</li><li>-clstats             to print class loader statistics</li><li>-finalizerinfo       to print information on objects awaiting finalization</li><li>-dump:&lt;dump-options&gt; to dump java heap in hprof binary format<br>dump-options:</li></ul><ol><li>live         dump only live objects; if not specified, all objects in the heap are dumped.</li><li>format=b     binary format</li><li>file=&lt;file&gt;  dump heap to &lt;file&gt;<br>é€šå¸¸æˆ‘ä»¬å¯ä»¥æŠŠå†…å­˜ä¿¡æ¯dumpä¸‹æ¥ï¼Œè¿™ä¸ªdumpæ–‡ä»¶å¯ä»¥è¢«visualVmæ¥è¯»å–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢æ‰€è¯´çš„jhatæ¥æŸ¥çœ‹</li></ol><h2 id="jhat-Java-Heap-Analysis-Tool"><a href="#jhat-Java-Heap-Analysis-Tool" class="headerlink" title="jhat (Java Heap Analysis Tool)"></a>jhat (Java Heap Analysis Tool)</h2><p>exampleï¼š<code>jhat -J-Xmx512m -port 9998 /tmp/dump.dat</code>å…¶ä¸­-JæŒ‡å®šæœ€å¤§å †å†…å­˜ï¼ˆå¦‚æœdumpæ–‡ä»¶è¿‡å¤§çš„è¯ï¼‰ï¼›æ•²å®Œè¿™ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨9998ç«¯å£æ¥åˆ†æäº†</p><h2 id="jstat-Java-Virtual-Machine-statistics-monitoring-tool"><a href="#jstat-Java-Virtual-Machine-statistics-monitoring-tool" class="headerlink" title="jstat (Java Virtual Machine statistics monitoring tool)"></a>jstat (Java Virtual Machine statistics monitoring tool)</h2><p>Usage:</p><ul><li>jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]<br>vmidæ˜¯Javaè™šæ‹ŸæœºIDï¼Œåœ¨Linux/Unixç³»ç»Ÿä¸Šä¸€èˆ¬å°±æ˜¯è¿›ç¨‹IDã€‚intervalæ˜¯é‡‡æ ·æ—¶é—´é—´éš”ã€‚countæ˜¯é‡‡æ ·æ•°ç›®ã€‚<br>jstatæ˜¯jvmç»Ÿè®¡å·¥å…·ï¼Œæ¯”å¦‚<code>jstat -gc 21711 250 4</code>å°±æ˜¯é‡‡æ ·æ—¶é—´é—´éš”ä¸º250msï¼Œé‡‡æ ·æ•°ä¸º4ï¼Œè¾“å‡ºGCä¿¡æ¯ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ€§èƒ½å¼‚å¸¸ï¼Œé€šè¿‡é‡å¯ç­‰ä¸´æ—¶æ–¹æ¡ˆå¯ä»¥æš‚æ—¶è®©ç¨‹åºç»§ç»­è·‘ä¸‹å»ï¼Œç›´åˆ°ä¸‹æ¬¡é—®é¢˜å†å‡ºç°ã€‚æƒ³è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œå¿…é¡»èƒ½å®šä½å®ƒçš„ä½ç½®ã€‚è€Œæ€§èƒ½ç›¸å…³çš„ä»£ç ï¼Œé€šå¸¸å¯èƒ½æ˜¯é”ç«äº‰ï¼Œçº¿ç¨‹æ± /è¿æ¥æ± ä¸è¿‡ï¼Œfull GCï¼Œè¿‡åº¦åƒcpuèµ„æºï¼Œæ­»é”ç­‰ï¼Œè¿™äº›é—®é¢˜é€šå¸¸å‘ç”Ÿåœ¨ç‰¹å®šç¯å¢ƒä¸­ï¼ˆæ¯”å¦‚æœ‰å¯¹èµ„æºçš„ç«äº‰ï¼‰ï¼Œåˆ†æä»£ç ä¸èƒ½å¿«é€Ÿå®šä½ã€‚è¿™æ—¶å°±éœ€è¦åˆ©ç”¨jdkæä¾›çš„æ€§èƒ½ç›‘æ§å·¥å…·ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
      <category term="performance" scheme="https://xhao.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>æ‰©å±•springçš„xml</title>
    <link href="https://xhao.io/2015/08/spring-extension/"/>
    <id>https://xhao.io/2015/08/spring-extension/</id>
    <published>2015-08-28T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.505Z</updated>
    
    <content type="html"><![CDATA[<p>springæ¡†æ¶åœ¨javaä¸–ç•Œåº”ç”¨å¹¿æ³›ï¼ŒIOCã€AOPï¼ŒåŒ…æ‹¬æœ€è¿‘çš„spring bootç­‰ï¼Œä½“ç³»åºå¤§ã€‚å¹³æ—¶springåº”ç”¨å¾ˆå°‘ï¼Œä¹Ÿæ²¡ç‰¹åˆ«çš„ç»éªŒè¦è¯´ã€‚ä½†åœ¨é€‚é…è‡ªå·±çš„æ¡†æ¶å’Œspringæ–¹é¢ï¼Œä¹Ÿæ‘¸ç´¢äº†å‡ å¤©ï¼Œæœ‰äº†ä¸€ç‚¹å¿ƒå¾—ã€‚æ‰€æœ‰çš„é€‚é…éƒ½æ˜¯åŸºäºspringæ¡†æ¶å¯¹å¤–å¼€æ”¾çš„é’©å­â€¦ä»Šå¤©è¦è¯´çš„æ¯”è¾ƒç®€å•ï¼Œæ˜¯å…³äºxmlçš„<br><a id="more"></a><br>å¼€å‘å‚è€ƒäº†<a href="http://docs.spring.io/autorepo/docs/spring/4.2.x/spring-framework-reference/html/" target="_blank" rel="noopener">spring doc</a></p><h3 id="xml-extension"><a href="#xml-extension" class="headerlink" title="xml extension"></a>xml extension</h3><p>è¿™éƒ¨åˆ†å¯èƒ½æ˜¯springæœ€ç®€å•å’Œæœ€å¸¸è§çš„æ‰©å±•äº†ï¼ŒåŸºæœ¬åŒ…å«äº†4ä¸ªæ­¥éª¤ï¼š</p><ul><li>Authoring an XML schema to describe your custom element(s).</li><li>Coding a custom NamespaceHandler implementation (this is an easy step, donâ€™t worry).</li><li>Coding one or more BeanDefinitionParser implementations (this is where the real work is done).</li><li>Registering the above artifacts with Spring (this too is an easy step).</li></ul><p>1.xmlæ‰©å±•é¦–å…ˆè¦åšçš„æ˜¯å®šä¹‰xsdï¼Œè¿™ä¸ªå¯ä»¥å‚è€ƒ<a href="http://www.w3schools.com/schema/" target="_blank" rel="noopener">è¯­æ³•</a>ã€‚ä½ å¿…é¡»å…ˆäº†è§£xsd schemaçš„è§„èŒƒï¼Œå½“ç„¶è¦ç©çš„æ›´å¥½ï¼Œè¿˜å¯ä»¥å¤šå­¦ä¹ ä¸‹spring xsdçš„å®šä¹‰ã€‚springçš„æ‰©å±•æ˜¯é€šè¿‡åœ¨META-INFä¸‹çš„2ä¸ªæ–‡ä»¶èµ·ä½œç”¨ï¼šspring.handlerså’Œspring.schemasã€‚</p><p>2.ä¸‹ä¸€æ­¥å°±æ˜¯æ³¨å†Œè§£æå™¨ï¼Œåœ¨NamespaceHandlerçš„initæ–¹æ³•ä¸­<code>registerBeanDefinitionParser(&quot;common&quot;, new DefinitionParser());</code>ã€‚</p><p>3.BeanDefinitionParserçš„å®ç°æ˜¯çœŸæ­£éœ€è¦ä¸‹åŠŸå¤«çš„åœ°æ–¹ï¼Œä¸è¿‡springä¹Ÿç»™æˆ‘ä»¬æä¾›äº†åŸºæœ¬çš„å®ç°AbstractSingleBeanDefinitionParserâ€“&gt;AbstractBeanDefinitionParserâ€“&gt;BeanDefinitionParserï¼Œè¿™3ä¸ªæ˜¯æˆ‘ç»å¸¸ç”¨åˆ°çš„ã€‚</p><p>4.å½“æˆ‘ä»¬éœ€è¦å¤„ç†elementä¸‹å¸¦æœ‰å­èŠ‚ç‚¹æ—¶ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å¢åŠ ä¸€ä¸ª<code>FactoryBean</code>ï¼Œè¿™ä¸ªç±»æ˜¯å’ŒbeanFactoryç›¸å…³è”çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComponentBeanDefinitionParser</span> <span class="keyword">extends</span> <span class="title">AbstractBeanDefinitionParser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AbstractBeanDefinition <span class="title">parseInternal</span><span class="params">(Element element, ParserContext parserContext)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> parseComponentElement(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> AbstractBeanDefinition <span class="title">parseComponentElement</span><span class="params">(Element element)</span> </span>&#123;</span><br><span class="line">BeanDefinitionBuilder factory = BeanDefinitionBuilder.rootBeanDefinition(ComponentFactoryBean<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">factory.addPropertyValue(<span class="string">"parent"</span>, parseComponent(element));</span><br><span class="line"></span><br><span class="line">List&lt;Element&gt; childElements = DomUtils.getChildElementsByTagName(element, <span class="string">"component"</span>);</span><br><span class="line"><span class="keyword">if</span> (childElements != <span class="keyword">null</span> &amp;&amp; childElements.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">parseChildComponents(childElements, factory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> factory.getBeanDefinition();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BeanDefinition <span class="title">parseComponent</span><span class="params">(Element element)</span> </span>&#123;</span><br><span class="line">BeanDefinitionBuilder component = BeanDefinitionBuilder.rootBeanDefinition(Component<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">component.addPropertyValue(<span class="string">"name"</span>, element.getAttribute(<span class="string">"name"</span>));</span><br><span class="line"><span class="keyword">return</span> component.getBeanDefinition();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseChildComponents</span><span class="params">(List&lt;Element&gt; childElements, BeanDefinitionBuilder factory)</span> </span>&#123;</span><br><span class="line">ManagedList&lt;BeanDefinition&gt; children = <span class="keyword">new</span> ManagedList&lt;BeanDefinition&gt;(childElements.size());</span><br><span class="line"><span class="keyword">for</span> (Element element : childElements) &#123;</span><br><span class="line">children.add(parseComponentElement(element));</span><br><span class="line">&#125;</span><br><span class="line">factory.addPropertyValue(<span class="string">"children"</span>, children);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComponentFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Component</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Component parent;</span><br><span class="line"><span class="keyword">private</span> List&lt;Component&gt; children;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(Component parent)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.parent = parent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setChildren</span><span class="params">(List&lt;Component&gt; children)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.children = children;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Component <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.children != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.children.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (Component child : children) &#123;</span><br><span class="line"><span class="keyword">this</span>.parent.addComponent(child);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.parent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class&lt;Component&gt; <span class="title">getObjectType</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Component<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™2æ®µä»£ç ä¸­è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œ<code>DomUtils.getChildElementsByTagName(element, &quot;component&quot;)</code>èƒ½å¤Ÿè·å¾—å­èŠ‚ç‚¹ï¼Œç„¶åå†æŒ‰ç…§è€æ–¹æ³•å»è§£æã€‚</p><p>5.å¦ä¸€ä¸ªé—®é¢˜æ˜¯idçš„é—®é¢˜ï¼Œæˆ‘ä»¬è™½ç„¶åœ¨xsdä¸­æ²¡æœ‰å®šä¹‰idå±æ€§ï¼Œä½†æ˜¯å½“é€šè¿‡BeanFactory.getBeanæ—¶ï¼Œä¾ç„¶ä¼šæç¤ºæˆ‘ä»¬top-levelå¿…é¡»æœ‰idå±æ€§ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ˜¾ç„¶æ˜¯å› ä¸ºspringé»˜è®¤beanæ˜¯è¦æœ‰idæ¥åŒºåˆ†çš„ã€‚ä½†æ˜¯æˆ‘ä»¬åˆä¸æ„¿æ„åœ¨è‡ªå·±çš„èŠ‚ç‚¹ä¸ŠåŠ è¿™ä¸ªå±æ€§ï¼Œè§£å†³åŠæ³•æ˜¯auto generate idã€‚åœ¨<code>AbstractBeanDefinitionParser</code>ä¸­æœ‰ä¸€ä¸ª<code>protected String resolveId(Element element, AbstractBeanDefinition definition, ParserContext parserContext) throws BeanDefinitionStoreException</code>æ–¹æ³•ï¼Œåªè¦é‡å†™å°±å¯ä»¥å®Œæˆï¼Œä½†æ˜¯å¿…é¡»è¦å°å¿ƒï¼Œè¿™ä¸ªidæ˜¯ä¸èƒ½å‡ºç°é‡å¤çš„ã€‚</p><p>å¦‚æœåšåˆ°è¿™äº›ï¼ŒåŸºæœ¬å°±å®Œæˆäº†spring xmlçš„æ‰©å±•ï¼Œå¹¶ä¸ç®—éš¾ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;springæ¡†æ¶åœ¨javaä¸–ç•Œåº”ç”¨å¹¿æ³›ï¼ŒIOCã€AOPï¼ŒåŒ…æ‹¬æœ€è¿‘çš„spring bootç­‰ï¼Œä½“ç³»åºå¤§ã€‚å¹³æ—¶springåº”ç”¨å¾ˆå°‘ï¼Œä¹Ÿæ²¡ç‰¹åˆ«çš„ç»éªŒè¦è¯´ã€‚ä½†åœ¨é€‚é…è‡ªå·±çš„æ¡†æ¶å’Œspringæ–¹é¢ï¼Œä¹Ÿæ‘¸ç´¢äº†å‡ å¤©ï¼Œæœ‰äº†ä¸€ç‚¹å¿ƒå¾—ã€‚æ‰€æœ‰çš„é€‚é…éƒ½æ˜¯åŸºäºspringæ¡†æ¶å¯¹å¤–å¼€æ”¾çš„é’©å­â€¦ä»Šå¤©è¦è¯´çš„æ¯”è¾ƒç®€å•ï¼Œæ˜¯å…³äºxmlçš„&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
      <category term="spring" scheme="https://xhao.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>javaä¸­å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ï¼ˆä¸€ï¼‰</title>
    <link href="https://xhao.io/2015/07/java-misuse/"/>
    <id>https://xhao.io/2015/07/java-misuse/</id>
    <published>2015-07-24T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="hashmap"><a href="#hashmap" class="headerlink" title="hashmap"></a>hashmap</h3><p>javaé‡Œçš„hashmapæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸€èˆ¬åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ConcurrentHashMapã€‚å› ä¸ºåœ¨å¹¶å‘æ¡ä»¶ä¸‹ï¼ŒHashMapçš„è¯¯ç”¨å¯èƒ½ä¸ä»…å¯¼è‡´æ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œè¿˜æœ‰å¯èƒ½å¼•å‘ä¸å¯ç½®ä¿¡çš„æ­»å¾ªç¯ã€‚å½“ç„¶ï¼Œjavadocé‡Œå·²ç»æ˜ç¡®å‘Šè¯«å¤§å®¶äº†ï¼š</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Note that this implementation <span class="literal">is</span><span class="built_in"> not</span> synchronized. If multiple threads access a hash <span class="keyword">map</span> concurrently, <span class="keyword">and</span> <span class="keyword">at</span> <span class="keyword">least</span> one <span class="keyword">of</span> the threads modifies the <span class="keyword">map</span> structurally, it must be synchronized externally. (A structural modification <span class="literal">is</span> any operation that adds <span class="keyword">or</span> deletes one <span class="keyword">or</span> more mappings; merely changing the <span class="keyword">value</span> associated with a<span class="built_in"> key</span> that an <span class="keyword">instance</span> already<span class="built_in"> contains</span> <span class="literal">is</span><span class="built_in"> not</span> a structural modification.) This <span class="literal">is</span> typically accomplished <span class="keyword">by</span> synchronizing on <span class="keyword">some</span> object that naturally encapsulates the <span class="keyword">map</span>. If no such object<span class="built_in"> exists</span>, the <span class="keyword">map</span> should be <span class="string">"wrapped"</span> using the Collections.synchronizedMap method. This <span class="literal">is</span> best done <span class="keyword">at</span> creation time, <span class="keyword">to</span> prevent accidental unsynchronized access <span class="keyword">to</span> the <span class="keyword">map</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé—®é¢˜æ˜¯åœ¨rehashæ—¶å€™è§¦å‘çš„å¾ªç¯é“¾è¡¨é€ æˆçš„ï¼Œä¹‹å‰sunå¯¹æ­¤çš„è§£é‡Šæ˜¯<strong>è¯·é€‰æ‹©ç”¨ConcurrentHashMap</strong></p><h3 id="SimpleDateFormat"><a href="#SimpleDateFormat" class="headerlink" title="SimpleDateFormat"></a>SimpleDateFormat</h3><p>SimpleDateFormatæ˜¯javaä¸­å¸¸ç”¨çš„æ—¶é—´formatæ‰‹æ®µã€‚å®ƒæœ¬èº«ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¹¶å‘å¤šçº¿ç¨‹æ¡ä»¶ä¸‹ï¼Œæ¯”è¾ƒå¥½çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ThreadLocalæˆ–è€…æ¯ä¸ªçº¿ç¨‹åˆ›å»ºå±äºè‡ªå·±çš„dateFormatã€‚</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Synchronization</span><br><span class="line">Date formats are <span class="keyword">not</span> synchronized. It is recommended <span class="built_in">to</span> <span class="built_in">create</span> separate <span class="built_in">format</span> instances <span class="keyword">for</span> <span class="keyword">each</span> thread. If multiple threads access <span class="keyword">a</span> <span class="built_in">format</span> concurrently, <span class="keyword">it</span> must be synchronized externally.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;hashmap&quot;&gt;&lt;a href=&quot;#hashmap&quot; class=&quot;headerlink&quot; title=&quot;hashmap&quot;&gt;&lt;/a&gt;hashmap&lt;/h3&gt;&lt;p&gt;javaé‡Œçš„hashmapæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸€èˆ¬åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”
      
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>java8ä¸­ä½¿ç”¨interfaceçš„defaultæ–¹æ³•</title>
    <link href="https://xhao.io/2015/07/methodHandles-lookup/"/>
    <id>https://xhao.io/2015/07/methodHandles-lookup/</id>
    <published>2015-07-06T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªæœ‰è¶£çš„åœºæ™¯ï¼Œç®€å•æè¿°å¦‚ä¸‹ï¼šæœ‰ä¸€ä¸ªinterface <code>Hello</code>ï¼Œå¸¦defaultå®ç°çš„æ–¹æ³•<code>hello()</code>ï¼›æƒ³è°ƒç”¨è¿™ä¸ª<code>Hello.hello()</code>ã€‚</p><p>é—®é¢˜æ˜¯è°ƒç”¨å®ä¾‹æ–¹æ³•æ˜¯éœ€è¦å®ä½“çš„ï¼Œè€Œä»…æœ‰interfaceå¹¶ä¸èƒ½æ„é€ ä¸€ä¸ªå®ä¾‹ã€‚å¼€å§‹æƒ³é€šè¿‡å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ï¼Œå‘ç°å›°éš¾æŒºå¤šçš„ï¼Œåœ¨ä¸æ–­å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†ä¸€ä¸ªæ–°çš„APIï¼š<code>MethodHandle</code>ã€‚<br><a id="more"></a></p><h3 id="Interface-default-method"><a href="#Interface-default-method" class="headerlink" title="Interface default method"></a>Interface default method</h3><p>java 8å¼•å…¥äº†ä¸€ä¸ªå¾ˆé‡è¦çš„è¯­è¨€ç‰¹æ€§ï¼šinterfaceå¯ä»¥æœ‰æ–¹æ³•çš„é»˜è®¤å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">default</span> String <span class="title">hello</span><span class="params">(String meta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span> + meta;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MethodHandle"><a href="#MethodHandle" class="headerlink" title="MethodHandle"></a>MethodHandle</h3><p>æœ‰äº†defaultå®ç°ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åœ¨æ²¡æœ‰å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨è¿™ä¸ªç±»å‘¢ï¼Ÿ</p><p><code>MethodHandle</code>è¦ä»jvmä¸Šçš„åŠ¨æ€ç±»å‹è¯­è¨€è¯´èµ·.<a href="http://www.infoq.com/cn/articles/jdk-dynamically-typed-language/" target="_blank" rel="noopener">infoq</a>çš„è¿™ç¯‡æ–‡ç« ä»‹ç»çš„ä¸é”™ã€‚methodHandleæ¥è‡ªäºJSR 292ï¼ŒåŒ…åæ˜¯java.lang.invokeã€‚ä¹‹å‰å•çº¯ä¾é ç¬¦å·å¼•ç”¨æ¥ç¡®å®šè°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ï¼Œjvmåœ¨åº•å±‚åˆæä¾›ä¸€ç§æ–°çš„åŠ¨æ€ç¡®å®šç›®æ ‡æ–¹æ³•çš„æœºåˆ¶ï¼Œç±»ä¼¼äºCçš„å‡½æ•°æŒ‡é’ˆçš„ï¼Œåœ¨æ€§èƒ½ä¸Šæ˜¯ä¼˜äºä¹‹å‰çš„åå°„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MethodHandle sayHelloHandle = MethodHandles.lookup().findVirtual( Hello.class, "hello", MethodType.methodType(String.class, String.class));</span><br><span class="line">sayHelloHandle.bindTo(<span class="keyword">new</span> Hello()).invokeWithArguments(<span class="string">"World"</span>);</span><br></pre></td></tr></table></figure><p>MehodHandleçš„ç”¨æ³•è¯´å®è¯ï¼Œå¥½éº»çƒ¦ï¼Œè¿™ä¸ªAPIè®¾è®¡çš„æ¯”è¾ƒéš¾ç”¨â€¦â€¦è¨€å½’æ­£ä¼ ï¼Œä¸Šé¢çš„è¿™æ®µä»£ç ç¦»è°ƒç”¨defaultå®ç°ä¸è¿œäº†ï¼Œé—®é¢˜åœ¨äºnew Hello()è¿™ä¸ªå¯¹äºæ¥å£æ˜¯ä¸èƒ½ç›´æ¥ç”¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç¥­å‡ºç¬¬2ä¸ªå¤§æ‹›â€Proxyâ€</p><h3 id="dynamic-proxy"><a href="#dynamic-proxy" class="headerlink" title="dynamic proxy"></a>dynamic proxy</h3><p>åŠ¨æ€ä»£ç†å¯¹äºå¤§å®¶å·²ç»ä¸é™Œç”Ÿäº†ï¼Œæˆ‘ç›´æ¥è´´å‡ºç”¨æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello target = (Hello) Proxy.newProxyInstance(<span class="keyword">this</span>.getClass().getClassLoader(), <span class="keyword">new</span> Class[] &#123; Hello<span class="class">.<span class="keyword">class</span> &#125;, (<span class="title">proxy</span>, <span class="title">method</span>, <span class="title">args</span>) -&gt; <span class="title">null</span>)</span>;</span><br></pre></td></tr></table></figure><p>æ˜¯çš„ï¼Œæˆ‘ä»¬è¿™é‡Œä»£ç†çš„å¯¹è±¡å…¶å®ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœç›´æ¥å»ä½¿ç”¨methodhandleä¼šè§¦å‘ä¸€ä¸ªé—®é¢˜:â€java.lang.IllegalAccessException: no private access for invokespecialâ€ï¼Œéå¸¸å¤´ç–¼ï¼</p><p>è§£å†³å®ƒçš„åŠæ³•æœ‰2ç§</p><ol><li><p>åœ¨debugçš„è¿‡ç¨‹ä¸­æ‰¾åˆ°çš„:<code>field = Lookup.class.getDeclaredField(&quot;allowedModes&quot;);field.setAccessible(true);</code>ï¼Œä¸é”™ï¼Œå°±æ˜¯è¿™ä¸ªcheckå¯¼è‡´çš„ï¼Œä½†æ˜¯åå°„å¯ä»¥åŠ¨æ€åœ°ä¿®æ”¹(åœ¨æˆ‘ä»¬invokeä¹‹å‰ä¿®æ”¹å³å¯)ã€‚</p></li><li><p>æœ€è¿‘åˆšçœ‹åˆ°çš„ï¼Œçœ‹èµ·æ¥æ¯”ä¸Šé¢çš„é‚£ä¸ªä¼˜é›…äº†ç‚¹(å…¶å®å·®ä¸å¤šâ€¦)ï¼Œè¯·çœ‹ä»£ç ï¼Œä¸å†ä»”ç»†åˆ†æâ€¦</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Hello target = (Hello) Proxy.newProxyInstance(<span class="keyword">this</span>.getClass().getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[] &#123; Hello<span class="class">.<span class="keyword">class</span> &#125;, (<span class="title">proxy</span>, <span class="title">method</span>, <span class="title">args</span>) -&gt; </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (method.isDefault()) &#123;</span><br><span class="line"><span class="keyword">final</span> Class&lt;?&gt; declaringClass = method.getDeclaringClass();</span><br><span class="line">Constructor&lt;MethodHandles.Lookup&gt; constructor = MethodHandles.Lookup<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>(<span class="title">Class</span>.<span class="title">class</span>, <span class="title">int</span>.<span class="title">class</span>)</span>;</span><br><span class="line">constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">return</span> constructor.newInstance(declaringClass, MethodHandles.Lookup.PRIVATE).unreflectSpecial(method, declaringClass).bindTo(proxy)</span><br><span class="line">.invokeWithArguments(args);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"..."</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line">target.hello(<span class="string">",World!"</span>);</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¤è¯†åˆ°2ä¸ªé—®é¢˜:</p><ol><li>methodhandleçš„ä½¿ç”¨;</li><li>åŠ¨æ€ä»£ç†å¯ä»¥è§£æå¹¶è°ƒç”¨interfaceä¸­çš„defaultæ–¹æ³•ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œjavaè¿˜æœ‰å¾ˆå¤šç¥å¥‡çš„åœ°æ–¹å€¼å¾—å­¦ä¹ ï¼</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€ä¸ªæœ‰è¶£çš„åœºæ™¯ï¼Œç®€å•æè¿°å¦‚ä¸‹ï¼šæœ‰ä¸€ä¸ªinterface &lt;code&gt;Hello&lt;/code&gt;ï¼Œå¸¦defaultå®ç°çš„æ–¹æ³•&lt;code&gt;hello()&lt;/code&gt;ï¼›æƒ³è°ƒç”¨è¿™ä¸ª&lt;code&gt;Hello.hello()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é—®é¢˜æ˜¯è°ƒç”¨å®ä¾‹æ–¹æ³•æ˜¯éœ€è¦å®ä½“çš„ï¼Œè€Œä»…æœ‰interfaceå¹¶ä¸èƒ½æ„é€ ä¸€ä¸ªå®ä¾‹ã€‚å¼€å§‹æƒ³é€šè¿‡å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ï¼Œå‘ç°å›°éš¾æŒºå¤šçš„ï¼Œåœ¨ä¸æ–­å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†ä¸€ä¸ªæ–°çš„APIï¼š&lt;code&gt;MethodHandle&lt;/code&gt;ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="java" scheme="https://xhao.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>javascriptä½œç”¨åŸŸ</title>
    <link href="https://xhao.io/2014/07/javascript-scope/"/>
    <id>https://xhao.io/2014/07/javascript-scope/</id>
    <published>2014-07-30T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p>javascriptçš„ä½œç”¨åŸŸå’Œç±»Cè¯­è¨€ç›¸æ¯”ï¼Œæœ‰ç‚¹ç‰¹æ®Šï¼Œå¯¹äºåˆå­¦è€…ï¼Œå®¹æ˜“æé”™ã€‚æ‰€ä»¥è¦ç‰¢è®°<strong>javascriptä¸­çš„å‡½æ•°è¿è¡Œåœ¨å®ƒä»¬è¢«å®šä¹‰çš„ä½œç”¨åŸŸé‡Œï¼Œè€Œä¸æ˜¯å®ƒä»¬è¢«æ‰§è¡Œçš„ä½œç”¨åŸŸé‡Œ</strong><br><a id="more"></a><br>å˜é‡çš„ä½œç”¨åŸŸå…³ç³»åˆ°å®ƒçš„å¯è§æ€§å’Œç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œè¶…å‡ºä½œç”¨åŸŸçš„ä½¿ç”¨èŒƒå›´ï¼Œä¼šå¸¦æ¥å¯æ€•çš„ç»“æœã€‚æ‰€ä»¥ï¼Œæ¯ä¸€é—¨å¼€å‘è¯­è¨€éƒ½ä¼šæä¾›ç›¸åº”çš„æœåŠ¡ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ç±»Cè¯­è¨€ï¼Œé‡‡ç”¨çš„æ˜¯å—çº§ä½œç”¨åŸŸï¼ˆé€šå¸¸å°±æ˜¯èŠ±æ‹¬å·ï¼‰ï¼Œåœ¨ä¸€ä¸ªä»£ç å—ä¸­å®šä¹‰çš„å˜é‡ï¼Œåœ¨å¤–éƒ¨æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œå¹¶ä¸”åœ¨ä»£ç å—çš„å†…éƒ¨ï¼Œå˜é‡è¿˜ä¼šè¦†ç›–å…¶åŒåçš„å¤–éƒ¨å˜é‡ï¼Œè€Œä¸€æ—¦è¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œå˜é‡å°±ä¼šå¤±æ•ˆï¼ˆè¶…å‡ºäº†å…¶ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚ä½†æ˜¯javascriptï¼ˆjsï¼‰é‡‡ç”¨äº†å¦å¤–çš„æ–¹å¼ï¼š<strong>åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å‚æ•°å’Œå˜é‡ï¼Œåœ¨å¤–éƒ¨æ˜¯çœ‹ä¸åˆ°çš„ï¼›å†…éƒ¨å‡½æ•°æ€»æ˜¯å¯ä»¥è®¿é—®å®ƒä»¬çš„å¤–éƒ¨å‚æ•°å’Œå˜é‡ã€‚è¿˜æ˜¯é‚£å¥è¯ï¼šjavascriptä¸­çš„å‡½æ•°è¿è¡Œåœ¨å®ƒä»¬è¢«å®šä¹‰çš„ä½œç”¨åŸŸé‡Œï¼Œè€Œä¸æ˜¯å®ƒä»¬è¢«æ‰§è¡Œçš„ä½œç”¨åŸŸé‡Œã€‚</strong>  </p><p>é¦–å…ˆï¼Œå‡½æ•°è§„å®šäº†ä½œç”¨åŸŸçš„å¯è§èŒƒå›´ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå‡½æ•°å¾ˆåƒCè¯­è¨€çš„èŠ±æ‹¬å·ã€‚ä½†æ˜¯ï¼Œå†…éƒ¨å‡½æ•°æ€»æ˜¯å¯ä»¥è®¿é—®å¤–éƒ¨å‚æ•°å’Œå˜é‡ï¼Œè¿™ä¸€ä¸‹å­ï¼Œå°±è®©å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ï¼ˆå› ä¸ºå¯ä»¥è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼‰ã€‚jsçš„å†…éƒ¨å‡½æ•°ä¸ä»…åŒ…å«äº†ä¸€ç»„æ–¹æ³•ï¼Œè¿˜èƒ½ç»‘å®šå‡½æ•°å¤–éƒ¨å®šä¹‰çš„ä¸€äº›å‚æ•°å’Œå˜é‡ï¼Œè€Œä¸”å®ƒä»¬è¿˜ä¸æ˜¯æ‹·è´ã€‚è¿™å°±æ˜¯jsçš„å¼ºå¤§ï¼Œå®ƒä½¿ç”¨å‡½æ•°å°±éå¸¸ç®€æ´åœ°å®Œæˆäº†æ•°æ®çš„å°è£…ã€ä»£ç çš„å¤ç”¨ã€æ¨¡å—åŒ–çš„è®¾è®¡ã€‚å¯¹äºç”¨æƒ¯äº†C++ã€javaçš„äººï¼Œå¾ˆå®¹æ˜“é™·å…¥è¯¯åŒºï¼Œç»å¸¸ç”¨é”™å˜é‡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥å»ä»”ç»†åœ°äº†è§£ä¸‹ï¼Œjsæ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚  </p><h2 id="é¢„è§£æ"><a href="#é¢„è§£æ" class="headerlink" title="é¢„è§£æ"></a>é¢„è§£æ</h2><p>jsæ˜¯è„šæœ¬è¯­è¨€ï¼Œå®ƒæ˜¯è§£é‡Šæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯ä»ä¸Šåˆ°ä¸‹é€è¡Œè¿›è¡Œç¿»è¯‘å¹¶æ‰§è¡Œã€‚ä½†æ˜¯å®ƒä¹Ÿä¼šé¢„è§£æï¼Œjså¼•æ“ä¼šå¤„ç†varå’Œfunction</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">1</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line">b=<span class="number">2</span>;</span><br><span class="line"><span class="comment">//b is not defined</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é¢„è§£æå¹¶ä¸æ¶‰åŠèµ‹å€¼æ“ä½œï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡ä¼šè¿”å›undefinedã€‚ç°åœ¨ï¼Œä¸å¦¨çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'hello'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     alert(name);</span><br><span class="line">     <span class="keyword">var</span> name = <span class="string">'hi'</span>;</span><br><span class="line">     alert(name);</span><br><span class="line">&#125;</span><br><span class="line">echo();</span><br></pre></td></tr></table></figure><p>é¦–å…ˆname=â€helloâ€æ˜¯echoå‡½æ•°å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè€Œåœ¨echoå‡½æ•°å†…éƒ¨è¿˜å­˜åœ¨ä¸€ä¸ªå±€éƒ¨å˜é‡name=â€hiâ€ï¼Œæ ¹æ®ä½œç”¨åŸŸçš„ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°å†…éƒ¨å®šä¹‰ä¼šéšè—å¤–éƒ¨å®šä¹‰ï¼Œè¿™ä¸æˆ‘ä»¬çš„å¸¸è¯†ç›¸ç¬¦ã€‚åŒæ—¶echoå‡½æ•°å†…éƒ¨çš„nameåœ¨å®Œæˆå®šä¹‰ï¼ˆèµ‹å€¼ï¼‰å‰ï¼Œå°±å·²ç»è¢«ä½¿ç”¨ï¼Œè¿™åœ¨jsé‡Œä¹Ÿæ˜¯å…è®¸çš„ï¼Œä½†å®ƒåº”è¯¥è¿”å›undefinedã€‚æ‰€ä»¥è¿™é‡Œçš„ç»“æœåº”è¯¥æ˜¯â€œundefined hiâ€ï¼Œå¼¹2æ¬¡å¯¹è¯æ¡†ã€‚è¿™ä¸ªä¾‹å­è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè‡³å°‘æˆ‘ä»¬è¿˜èƒ½ä¸€çœ¼çœ‹å‡ºå…¶ä¸­çš„å…³ç³»ã€‚å¦‚æœå†å¤æ‚å‘¢ï¼Ÿå¦‚ä½•è¿½æº¯åˆ°å˜é‡çš„å®šä¹‰ï¼Œä¼šå˜å¾—æ£˜æ‰‹èµ·æ¥ã€‚</p><h2 id="ä½œç”¨åŸŸé“¾"><a href="#ä½œç”¨åŸŸé“¾" class="headerlink" title="ä½œç”¨åŸŸé“¾"></a>ä½œç”¨åŸŸé“¾</h2><p>jså¼•æ“åœ¨å·¥ä½œçš„æ—¶å€™ï¼Œä¼šç»´æŠ¤ä¸€ä¸ªscope chainçš„å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨çš„å½¢å¼ã€‚ä»¥å‡½æ•°ä¸ºä¾‹ï¼Œfuncåœ¨å®šä¹‰çš„æ—¶å€™ï¼Œå®ƒçš„scope chainé“¾æ¥åˆ°funcçš„scopeå±æ€§ä¸Šï¼›funcæ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªactive objectå¹¶ä¸”åŠ å…¥åˆ°scope chainçš„æœ€é¡¶ç«¯ï¼Œargumentsã€å½¢å‚ï¼ˆè¿™é‡Œå½¢å‚ä¼šèµ‹å®å‚çš„å€¼ï¼‰ã€å†…éƒ¨å˜é‡ã€å†…éƒ¨å‡½æ•°éƒ½ä¼šä½œä¸ºè¿™ä¸ªAOçš„å±æ€§å­˜åœ¨ã€‚æ‹¿ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">num1,num2</span>) </span>&#123;</span><br><span class="line">       <span class="keyword">var</span> sum = num1 + num2;</span><br><span class="line">       <span class="keyword">return</span> sum;</span><br><span class="line">&#125;;</span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>åœ¨å®šä¹‰å‡½æ•°addçš„æ—¶å€™ï¼Œadd[scope]-&gt;[scope chain]-&gt;[global AO]ï¼šæ„æ€æ˜¯addå‡½æ•°æœ‰ä¸€ä¸ªå±æ€§æ˜¯scopeï¼Œå®ƒåŒ…å«äº†addå¯¹è±¡çš„ä½œç”¨åŸŸé“¾ï¼Œè€Œè¿™ä¸ªä½œç”¨åŸŸé“¾å…¶å®æ˜¯å‡½æ•°è¢«åˆ›å»ºæ—¶çš„ä½œç”¨åŸŸèŒƒå›´å†…çš„å¯¹è±¡é›†åˆï¼ˆåœ¨è¿™é‡Œåªæœ‰ä¸€ä¸ªglobalå¯¹è±¡windowï¼‰ã€‚å½“add(1,2)è¿è¡Œæ—¶ï¼Œåˆä¼šå¼•å…¥ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå‡½æ•°è¿è¡Œçš„ç¯å¢ƒï¼‰ï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ªä½œç”¨åŸŸé“¾ï¼Œå®ƒçš„ä½œç”¨åŸŸé“¾åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šä¼šåŠ å…¥ä¸€ä¸ªactive objectï¼ˆthisã€argumentsã€num1ã€num2ã€sumï¼‰ï¼Œå¹¶ä¸”è¢«æ¨åˆ°é“¾è¡¨çš„é¡¶ç«¯ã€‚ä½œç”¨åŸŸé“¾æŒ‡æ˜äº†å½“å‰å‡½æ•°æ‰§è¡Œæ—¶æ‰€èƒ½è®¿é—®çš„æ•°æ®ï¼Œé¡¾åæ€ä¹‰ï¼Œå‡½æ•°ä¼šæŒ‰ç…§è¿™ä¸ªé“¾æ¥çš„é¡ºåºä¸€è·¯æœç´¢ç›´åˆ°globalå¯¹è±¡ã€‚è¿™å°±æ˜¯jsæ„é€ ä½œç”¨åŸŸé“¾çš„è¿‡ç¨‹ã€‚  </p><p>jsä¸­çš„withå’Œcatchä¼šç ´åæ™®é€šçš„ä½œç”¨åŸŸé“¾ï¼Œé¢å¤–åŠ å…¥ä¸€ä¸ªä¸´æ—¶å¯¹è±¡withObjectæˆ–è€…æ˜¯catchObjectåˆ°é“¾è¡¨å¤´éƒ¨ï¼Œä»è€Œå½±å“ä½œç”¨åŸŸé“¾ã€‚  </p><h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p>åœ¨å‰é¢å·²ç»è¯´åˆ°funcçš„[scope]ï¼Œå®ƒæ˜¯åœ¨å‡½æ•°å®šä¹‰æ—¶è¢«åˆ›å»ºçš„ï¼Œå¹¶ä¸”ä¸€ç›´å­˜åœ¨ã€‚æ‰€ä»¥é—­åŒ…å®é™…å°±æ˜¯å‡½æ•°+[scope]ï¼Œå®ƒæ—¢æ‹¥æœ‰äº†å‡½æ•°çš„è¯­å¥ï¼Œä¹Ÿæ‹¥æœ‰å‡½æ•°å®šä¹‰æ—¶çš„å¯è®¿é—®å¯¹è±¡çš„é›†åˆã€‚åœ¨æ‰§è¡Œé—­åŒ…ï¼ˆå‡½æ•°ï¼‰æ—¶ï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡=[scope]+AOã€‚æ‰€ä»¥ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(x);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">20</span>; <span class="comment">//æ³¨æ„x=20å¹¶ä¸åœ¨fooçš„AOé‡Œï¼Œè¯·ä»”ç»†è¯»ä¸‹AOæ‰€åŒ…å«çš„å†…å®¹</span></span><br><span class="line">  foo(); <span class="comment">// 10, å¦‚æœæ²¡æœ‰å®šä¹‰var x=10ï¼Œä¼šx is not definedå³xè¿˜æ²¡æœ‰å£°æ˜ã€‚</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x=<span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="built_in">Function</span>(<span class="string">'alert(x);alert(y);'</span>);</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br><span class="line">fo();<span class="comment">//ReferenceError: y is not defined</span></span><br></pre></td></tr></table></figure><p>å®ƒå‘Šè¯‰æˆ‘ä»¬çš„æ„æ€æ˜¯å¦‚æœç”¨äº†Functionæ¥æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆ[scope]æ€»æ˜¯å…¨å±€å¯¹è±¡globalï¼Œåœ¨è¿™é‡Œå…¨å±€å¯¹è±¡åªåŒ…å«x=10ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ”¹æˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x=<span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    y = <span class="number">20</span>;<span class="comment">//yä¹Ÿæˆä¸ºäº†å…¨å±€å˜é‡</span></span><br><span class="line">    <span class="keyword">var</span> foo = <span class="built_in">Function</span>(<span class="string">'alert(x);alert(y);'</span>);</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br><span class="line">fo();<span class="comment">//é‚£ä¹ˆä¸€åˆ‡OK.</span></span><br></pre></td></tr></table></figure><p>åœ¨ä½œç”¨åŸŸé“¾ä¸­å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹è±¡ï¼Œé‚£ä¹ˆjsä¼šç»§ç»­æŸ¥æ‰¾ï¼Œè¿™ä¸ªæ—¶å€™å®ƒçš„ç›®å…‰æ”¾åœ¨äº†åŸå‹é“¾ä¸Šï¼ˆAOåº”è¯¥æ˜¯æ²¡æœ‰åŸå‹çš„ï¼‰ï¼Œç›´åˆ°object.prototyã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.prototype.x = <span class="number">10</span>;</span><br><span class="line">foo(); <span class="comment">// 10</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æœ‰å…³jsä½œç”¨åŸŸç›¸å…³çš„è¯é¢˜ï¼Œé€šè¿‡ç®€çŸ­çš„æè¿°ï¼Œè¿˜æ˜¯èƒ½æ¸…æ™°åœ°çœ‹åˆ°å®ƒçš„åŸç†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;javascriptçš„ä½œç”¨åŸŸå’Œç±»Cè¯­è¨€ç›¸æ¯”ï¼Œæœ‰ç‚¹ç‰¹æ®Šï¼Œå¯¹äºåˆå­¦è€…ï¼Œå®¹æ˜“æé”™ã€‚æ‰€ä»¥è¦ç‰¢è®°&lt;strong&gt;javascriptä¸­çš„å‡½æ•°è¿è¡Œåœ¨å®ƒä»¬è¢«å®šä¹‰çš„ä½œç”¨åŸŸé‡Œï¼Œè€Œä¸æ˜¯å®ƒä»¬è¢«æ‰§è¡Œçš„ä½œç”¨åŸŸé‡Œ&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="https://xhao.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>use liquibase</title>
    <link href="https://xhao.io/2014/05/liquibase-usage/"/>
    <id>https://xhao.io/2014/05/liquibase-usage/</id>
    <published>2014-05-12T16:00:00.000Z</published>
    <updated>2020-07-23T15:25:07.501Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.liquibase.org/" target="_blank" rel="noopener">liquibase</a>æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå®ƒå’Œrailsä¸–ç•Œä¸­çš„migrationæ¯”è¾ƒæ¥è¿‘ï¼Œè¿™å¯¹å¤§å‹çš„j2eeé¡¹ç›®å¼€å‘æ¥è¯´ï¼Œå¯è°“æ˜¯ä¼˜è´¨çš„è¾…åŠ©ã€‚å¯¹äºä¸€ä¸ªå¥å£®çš„j2eeå¹³å°è€Œè¨€ï¼Œç¨³å®šçš„æ•°æ®åº“ç³»ç»Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ä¹‹å‰åœ¨é¡¹ç›®ä¸­é€šè¿‡äººå·¥çš„æ–¹å¼å®¡æ ¸ï¼Œå¹¶ä¸”æœ‰ä¸“é—¨çš„æ•°æ®å¯¼å…¥å¯¼å‡ºç¯å¢ƒã€‚ä½†æ˜¯è¿™æ ·æœ‰å¾ˆå¤šä¸è¶³ï¼Œæ¯”å¦‚ï¼šå¯¹äºä¸€ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬æ— æ³•çŸ¥é“å“ªäº›è„šæœ¬æ‰§è¡Œè¿‡ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ææ¸…æ¥šå½“å‰æ•°æ®åº“æ‰€å¤„çš„ç‰ˆæœ¬ï¼ˆå¯¹åº”äºä»£ç æµï¼‰ã€‚liquibaseæ­£å¥½æä¾›äº†ä¸€ä¸ªè§£å†³æ€è·¯ã€‚ä¸ºäº†åº”å¯¹æ­å»ºæ•°æ®åº“çš„ä¸ä¾¿ï¼Œæˆ‘ä»¬ç›®å‰é‡‡ç”¨äº†InitialDB+liquibaseçš„æœºåˆ¶ï¼Œè¿™å°†æå¤§åœ°æ–¹ä¾¿æˆ‘ä»¬åœ¨ä¸åŒçš„å¼€å‘äº§å“çº¿ä¹‹é—´åˆ‡æ¢ã€‚<br><a id="more"></a><br>ä½¿ç”¨liquibaseï¼Œé¦–å…ˆçœ‹çœ‹ç®€å•çš„ä¾‹å­ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseChangeLog</span> <span class="attr">xmlns</span>=<span class="string">"http://www.liquibase.org/xml/ns/dbchangelog"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">changeSet</span> <span class="attr">author</span>=<span class="string">"xxxx (generated)"</span> <span class="attr">id</span>=<span class="string">"1399880011956-1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">createTable</span> <span class="attr">remarks</span>=<span class="string">"fee_name"</span> <span class="attr">tableName</span>=<span class="string">"T_BCP_FEE_TYPE_NAME"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"ID"</span> <span class="attr">remarks</span>=<span class="string">"pk"</span> <span class="attr">type</span>=<span class="string">"NUMBER(10, 0)"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">constraints</span> <span class="attr">nullable</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"FEE_TYPE"</span> <span class="attr">remarks</span>=<span class="string">"fee type"</span> <span class="attr">type</span>=<span class="string">"NUMBER(20, 0)"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"FEE_NAME"</span> <span class="attr">remarks</span>=<span class="string">"fee name"</span> <span class="attr">type</span>=<span class="string">"VARCHAR2(60)"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">createTable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">changeSet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseChangeLog</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­é‡Œæ–°å»ºäº†ä¸€å¼ è¡¨T_BCP_FEE_TYPE_NAMEï¼Œæœ‰3ä¸ªåˆ—åˆ†åˆ«æ˜¯IDã€FEE_TYPEã€FEE_NAMEã€‚å®ƒçš„åŸºæœ¬å…ƒç´ æ˜¯changeSetï¼Œä»£è¡¨ç€æ•°æ®åº“çš„ä¸€æ¬¡ä¿®æ”¹ã€‚liquibaseé€šå¸¸ä¼šå°†æ¯ä¸ªchangeSetæ”¾åœ¨ä¸€ä¸ªtransactionä¸­æ‰§è¡Œï¼Œæ‰€ä»¥æ¯”è¾ƒå¥½çš„åšæ³•æ˜¯æ¯ä¸ªchangeSetå°½é‡åªå«æœ‰ä¸€ä¸ªæ•°æ®åº“ç»“æ„çš„æ”¹åŠ¨ã€‚</p><p>liquibaseè¿˜æ”¯æŒrollbackï¼Œåªéœ€è¦åœ¨changeSetä¸­åŠ å…¥rollbackæ ‡ç­¾ï¼ˆæŸäº›changeï¼Œliquibaseå¯ä»¥è‡ªåŠ¨rollbackï¼‰ã€‚å‰é¢çš„ä¾‹å­å¯ä»¥æ”¹æˆ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">changeSet</span> <span class="attr">author</span>=<span class="string">"hao.xie (generated)"</span> <span class="attr">id</span>=<span class="string">"1399880011956-1"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">createTable</span> <span class="attr">remarks</span>=<span class="string">"fee_name"</span> <span class="attr">tableName</span>=<span class="string">"T_BCP_FEE_TYPE_NAME"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"ID"</span> <span class="attr">remarks</span>=<span class="string">"pk"</span> <span class="attr">type</span>=<span class="string">"NUMBER(10, 0)"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">constraints</span> <span class="attr">nullable</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">column</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"FEE_TYPE"</span> <span class="attr">remarks</span>=<span class="string">"fee_type"</span> <span class="attr">type</span>=<span class="string">"NUMBER(20, 0)"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"FEE_NAME"</span> <span class="attr">remarks</span>=<span class="string">"fee name"</span> <span class="attr">type</span>=<span class="string">"VARCHAR2(60)"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">createTable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rollback</span>&gt;</span></span><br><span class="line">drop table T_BCP_FEE_TYPE_NAME</span><br><span class="line"><span class="tag">&lt;/<span class="name">rollback</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;rollback&gt;&lt;dropTable tableName="T_BCP_FEE_TYPE_NAME"/&gt;&lt;/rollback&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;rollback changeSetId="xx" changeSetAuthor="xx"/&gt; --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">changeSet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢ç”¨äº†3ç§æ–¹å¼æ¥å†™ï¼Œéƒ½æ˜¯å¯è¡Œçš„ã€‚åŠ å…¥äº†rollbackçš„æœºåˆ¶ï¼Œä»æŸç§æ„ä¹‰ä¸Šè®²ï¼Œä½¿å¾—DBçš„è¿ç§»ä¹Ÿæœ‰äº†ç‰ˆæœ¬çš„æ¦‚å¿µï¼ˆä¸ä¸€å®šæ­£ç¡®ï¼Œä½†åº”è¯¥ä¾¿äºç†è§£ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©rollbackåˆ°æŸä¸€ç‚¹ï¼Œä¹Ÿå¯ä»¥å†é‡æ–°updateåˆ°æœ€æ–°çš„æ•°æ®åº“ç‰ˆæœ¬ã€‚ä»¥ä¸‹æ˜¯liquibaseæ”¯æŒçš„å‡ ç§â€œRoll Back Toâ€ Modes.</p><table border="1"><br>    <tbody><br>        <tr><th>Modes</th><th>Description</th></tr><br>        <tr><td>Tag</td><td>Specifying a tag to rollback to will roll back all change-sets that were executed against the target database after the given tag was applied</td></tr><br>        <tr><td>Number of Change Sets</td><td>You can specify the number of change-sets to rollback</td></tr><br>        <tr><td>Date</td><td>You can specify the date to roll back to</td></tr><br>    </tbody><br></table><p>ä¸‹é¢è¦æçš„è¿™ä¸ªï¼Œæˆ‘è§‰å¾—ä¹Ÿæœ‰ç‰ˆæœ¬çš„æ„å‘³â€”â€”Diffã€‚åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæ¯”è¾ƒä¸åŒç‰ˆæœ¬ä¹‹é—´çš„ä»£ç ã€‚è€ƒè™‘åˆ°æ•°æ®åº“çš„å¼€å‘ï¼Œliquibaseä¹Ÿæ”¯æŒäº†è¿™ç§compareã€‚å¦‚æœä½¿ç”¨commandï¼Œå°±æ˜¯è¿™æ ·</p><pre><code>liquibase.sh --driver=oracle.jdbc.OracleDriver \    --url=jdbc:oracle:thin:@testdb:1521:test \    --username=bob \    --password=bob \diff \    --referenceUrl=jdbc:oracle:thin:@localhost/XE \    --referenceUsername=bob \    --referencePassword=bob</code></pre><p>liquibaseé€šè¿‡diffçš„äº§å‡ºåˆ†ä¸ºæŠ¥è¡¨å’ŒchangeLogè¿™2ç§å½¢å¼ï¼Œå‰è€…ä¾¿äºé˜…è¯»ï¼Œåè€…ä¾¿äºliquibaseç›´æ¥æ‰§è¡Œï¼ˆä½¿å¾—2ä¸ªæ•°æ®åº“mergeåˆ°åŒä¸€ä¸ªç‰ˆæœ¬ï¼‰ã€‚æˆ‘æ›´å€¾å‘äºåè€…ã€‚åœ¨è¿™é‡Œå®ƒä½¿ç”¨äº†é»˜è®¤çš„diffTypesæ¥æ¯”è¾ƒ2ä¸ªæ•°æ®åº“ï¼Œç°åœ¨liquibaseæ”¯æŒçš„æ¯”è¾ƒç±»å‹æ˜¯ï¼š</p><ul><li>tables [DEFAULT]</li><li>columns [DEFAULT]</li><li>views [DEFAULT]</li><li>primaryKeys [DEFAULT]</li><li>indexes [DEFAULT]</li><li>foreignKeys [DEFAULT]</li><li>sequences [DEFAULT]</li><li>data    </li></ul><p><em>tipï¼šæˆ‘å‘ç°è¿™ä¸ªæ“ä½œä¹Ÿæ˜¯å¾ˆæ¶ˆè€—å†…å­˜çš„ï¼Œå»ºè®®åœ¨æ‰§è¡Œå‰ï¼Œæ‰‹åŠ¨è®¾ç½®jvm heapçš„å¤§å°ã€‚</em></p><p>æ€»è€Œè¨€ä¹‹ï¼Œliquibaseä½¿æ•°æ®åº“çš„å¼€å‘å˜å¾—åƒä»£ç çš„ç‰ˆæœ¬ç®¡ç†ã€‚å®ƒæœ€å¤§çš„å¥½å¤„æ˜¯æ–¹ä¾¿äº†æ•°æ®åº“çš„è¿ç§»å’Œç®¡ç†ï¼Œå¹¶ä¸”è¿˜æ”¯æŒäº†commandã€antã€mavenç­‰å¤šç§æ ¼å¼ï¼Œéå¸¸é€‚åˆåœ¨javaä¸–ç•Œä½¿ç”¨ã€‚æ­£å¦‚æˆ‘å¼€å¤´æ‰€è¯´ï¼Œå®ƒå°±æ˜¯javaä¸–ç•Œçš„migrationï¼ˆrailsï¼‰å·¥å…·ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://www.liquibase.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;liquibase&lt;/a&gt;æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå®ƒå’Œrailsä¸–ç•Œä¸­çš„migrationæ¯”è¾ƒæ¥è¿‘ï¼Œè¿™å¯¹å¤§å‹çš„j2eeé¡¹ç›®å¼€å‘æ¥è¯´ï¼Œå¯è°“æ˜¯ä¼˜è´¨çš„è¾…åŠ©ã€‚å¯¹äºä¸€ä¸ªå¥å£®çš„j2eeå¹³å°è€Œè¨€ï¼Œç¨³å®šçš„æ•°æ®åº“ç³»ç»Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ä¹‹å‰åœ¨é¡¹ç›®ä¸­é€šè¿‡äººå·¥çš„æ–¹å¼å®¡æ ¸ï¼Œå¹¶ä¸”æœ‰ä¸“é—¨çš„æ•°æ®å¯¼å…¥å¯¼å‡ºç¯å¢ƒã€‚ä½†æ˜¯è¿™æ ·æœ‰å¾ˆå¤šä¸è¶³ï¼Œæ¯”å¦‚ï¼šå¯¹äºä¸€ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬æ— æ³•çŸ¥é“å“ªäº›è„šæœ¬æ‰§è¡Œè¿‡ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ææ¸…æ¥šå½“å‰æ•°æ®åº“æ‰€å¤„çš„ç‰ˆæœ¬ï¼ˆå¯¹åº”äºä»£ç æµï¼‰ã€‚liquibaseæ­£å¥½æä¾›äº†ä¸€ä¸ªè§£å†³æ€è·¯ã€‚ä¸ºäº†åº”å¯¹æ­å»ºæ•°æ®åº“çš„ä¸ä¾¿ï¼Œæˆ‘ä»¬ç›®å‰é‡‡ç”¨äº†InitialDB+liquibaseçš„æœºåˆ¶ï¼Œè¿™å°†æå¤§åœ°æ–¹ä¾¿æˆ‘ä»¬åœ¨ä¸åŒçš„å¼€å‘äº§å“çº¿ä¹‹é—´åˆ‡æ¢ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="liquibase" scheme="https://xhao.io/tags/liquibase/"/>
    
      <category term="sql" scheme="https://xhao.io/tags/sql/"/>
    
  </entry>
  
</feed>
