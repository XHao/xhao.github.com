---
layout: post
title: Sql Antipattern:属性
category: sql
excerpt: 
tags: [sql,design,学习笔记]
---
{% include JB/setup %}

在日常生活中会遇到一种场景——多值属性，比如电话号码，手机、工作的、家庭的、小灵通、IP电话...一个人可能拥有其中一种或者每一种。如果将这些值存储在一列中，势必又要用到分隔符，这会导致sql操作的复杂、也无法确保数据的正确性。如果用多列去存储，也不优雅。因为每次查询一个人的电话时，需要扫描每一列；每当增加或者删除一种通讯工具时，需要重构整张表；数据库中可能存在更多的null列。不过，当我们在设计数据库时，就能确定某一属性需要多列存储，而这些列是可预知且不会随意变化的，那不妨就采用多列存储好了。  
但是通常，解决办法是创建另一张表，将多列属性转化为多行存储。举个例子（可能不是最恰当的）
	
	create table communication (	
		employee_id int,
		tag varchar(20),
		content varchar(20),
		primary key (employee_id, tag),
		foreign key (employee_id) references employee (id)
	)
利用标签将不同的值分在多行存储起来，多列——>多行；同时又有外键关联，将人和信息联系在一起；同时查询、更新、删除都变得简单；支持或取消对某种通讯工具的支持（增加或删除某种通讯工具），也同样不需要重构数据库，只需要来个遍历，删除相应的行即可。  
其实，我觉得吧，这是一种思考方式，当一张数据表的列表达出现困难时，就应该转嫁其风险，或者增加一张新表，将这些列从主表中移除出去；或者干脆思考清楚这些列属性的意义，是不是一种设计的冗余。总之，要谨慎地设计每一列。
